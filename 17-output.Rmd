
# Detailed output {#output}

## Prerequisites

In this chapter we will focus on how to set and get EnergyPlus simulation outputs using the eplusr package. We will illustrate the manipulation of simulation data using tidyverse, and use ggplot2 to visualize the simulation data

```{r, message=FALSE}
library(eplusr)
library(tidyverse)
library(ggplot2)
library(here)
```

We will be working with the IDF and EPW file that pertains to the U.S. Department of Energy (DOE) Commercial Reference Building and Chicago's TMY3 respectively.
```{r, message=FALSE}
path_idf <- here("data", "idf", "RefBldgMediumOfficeNew2004_Chicago.idf")
model <- read_idf(path_idf)

path_epw <- here("data", "epw", "USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.epw")
epw <- read_epw(path_epw)
```




## Meters

EnergyPlus allows you to specify meters to retrieve the simulation outputs. However, to know what meters are available (for output) in your model, you must first run the simulation. You can then retrieve the list of available meters with the function `read_mdd()`, which returns a five column `data.table`.

```{r}
mdd <- job$read_mdd()
mdd
```

After



## Variables


```{r}
preprocess_idf <- function(idf, meters, variables) {
    # make sure weather file input is respected
    idf$SimulationControl$Run_Simulation_for_Weather_File_Run_Periods <- "Yes"

    # make sure energy consumption is presented in kWh
    if (is.null(idf$OutputControl_Table_Style)) {
        idf$add(OutputControl_Table_Style = list("HTML", "JtoKWH"))
    }else{
        idf$OutputControl_Table_Style$Unit_Conversion <- "JtoKWH"
    }

    # remove all existing meter and variable outputs
    if(!is.null(idf$`Output:Meter`)){
        idf$Output_Meter <- NULL
    }
    
    # remove all existing meter and variable outputs
    if(!is.null(idf$`Output:Table:Monthly`)){
        idf$`Output:Table:Monthly` <- NULL
    }

    if(!is.null(idf$`Output:Variable`)){
        idf$Output_Variable <- NULL
    }

    # add meter outputs to get hourly time-series energy consumption
    idf$add(Output_Meter := meters)

    # add variable outputs to get hourly zone air temperature
    idf$add(Output_Variable := variables)

    # make sure the modified model is returned
    return(idf)
}
```


```{r}
meters <- list(
    key_name = c(
        "Cooling:Electricity",
        "Heating:NaturalGas",
        "Heating:Electricity",
        "InteriorLights:Electricity",
        "ExteriorLights:Electricity",
        "InteriorEquipment:Electricity",
        "Fans:Electricity",
        "Pumps:Electricity",
        "WaterSystems:NaturalGas"
    ),
    Reporting_Frequency = "Hourly"
)

variables <- list(
    key_value = "*",
    Variable_Name = c(
        "Zone Mean Air Temperature"
    ),
    Reporting_Frequency = "Hourly"
)

#model <- preprocess_idf(model, meters, variables)

#model$save(here("data/idf/model_preprocessed.idf"), overwrite = TRUE)
#job <- model$run(path_epw)
```





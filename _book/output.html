<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 15 Detailed output | R for Building Energy Simulation</title>
<meta name="author" content="Adrian Chong">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Building Energy Simulation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">R Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="basics.html"><span class="header-section-number">2</span> Basics</a></li>
<li><a class="" href="datetime.html"><span class="header-section-number">3</span> Dates and Times</a></li>
<li><a class="" href="importing-data.html"><span class="header-section-number">4</span> Importing Data</a></li>
<li><a class="" href="regex.html"><span class="header-section-number">5</span> Regular expressions</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">6</span> Functions</a></li>
<li><a class="" href="manipulate.html"><span class="header-section-number">7</span> Manipulating Data</a></li>
<li class="book-part">Get Started</li>
<li><a class="" href="get-started.html"><span class="header-section-number">8</span> Introduction</a></li>
<li><a class="" href="parse.html"><span class="header-section-number">9</span> Parse then simulate</a></li>
<li><a class="" href="summary.html"><span class="header-section-number">10</span> Summary reports</a></li>
<li><a class="" href="visualize.html"><span class="header-section-number">11</span> Visualize</a></li>
<li class="book-part">Inputs and Outputs</li>
<li><a class="" href="input-output.html"><span class="header-section-number">12</span> Introduction</a></li>
<li><a class="" href="input.html"><span class="header-section-number">13</span> Model Input Structure</a></li>
<li><a class="" href="modify.html"><span class="header-section-number">14</span> Modify model inputs</a></li>
<li><a class="active" href="output.html"><span class="header-section-number">15</span> Detailed output</a></li>
<li><a class="" href="explore.html"><span class="header-section-number">16</span> Model Exploration</a></li>
<li class="book-part">Program</li>
<li><a class="" href="program.html"><span class="header-section-number">17</span> Introduction</a></li>
<li><a class="" href="energy-efficient-measures.html"><span class="header-section-number">18</span> Energy Efficient Measures</a></li>
<li><a class="" href="parametric-simulations.html"><span class="header-section-number">19</span> Parametric simulations</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="advanced.html"><span class="header-section-number">20</span> Introduction</a></li>
<li><a class="" href="sensitivity-analysis.html"><span class="header-section-number">21</span> Sensitivity analysis</a></li>
<li><a class="" href="optimization.html"><span class="header-section-number">22</span> Optimization</a></li>
<li><a class="" href="calibration.html"><span class="header-section-number">23</span> Calibration</a></li>
<li class="book-part">Reproduce</li>
<li><a class="" href="reproduce.html"><span class="header-section-number">24</span> Introduction</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">25</span> R Markdown</a></li>
<li><a class="" href="containers.html"><span class="header-section-number">26</span> Containers</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="output" class="section level1" number="15">
<h1>
<span class="header-section-number">15</span> Detailed output<a class="anchor" aria-label="anchor" href="#output"><i class="fas fa-link"></i></a>
</h1>
<div id="prerequisites-12" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites-12"><i class="fas fa-link"></i></a>
</h2>
<p>In this chapter we will focus on how to set and get EnergyPlus simulation outputs using the eplusr package. We will illustrate the manipulation of simulation data using tidyverse, and use ggplot2 to visualize the simulation data</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hongyuanjia.github.io/eplusr/">eplusr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></code></pre></div>
<p>We will be working with the IDF and EPW file that pertains to the U.S. Department of Energy (DOE) Commercial Reference Building and Chicago’s TMY3 respectively.</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path_idf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"idf"</span>, <span class="st">"RefBldgMediumOfficeNew2004_Chicago.idf"</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hongyuanjia.github.io/eplusr/reference/read_idf.html">read_idf</a></span><span class="op">(</span><span class="va">path_idf</span><span class="op">)</span>

<span class="va">path_epw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"epw"</span>, <span class="st">"USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.epw"</span><span class="op">)</span>
<span class="va">epw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hongyuanjia.github.io/eplusr/reference/read_epw.html">read_epw</a></span><span class="op">(</span><span class="va">path_epw</span><span class="op">)</span></code></pre></div>
</div>
<div id="variable-dictionary-reports" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Variable dictionary reports<a class="anchor" aria-label="anchor" href="#variable-dictionary-reports"><i class="fas fa-link"></i></a>
</h2>
<p>The variable dictionary reports are one of the most important outputs when working with EnergyPlus simulations. These reports inform EnergyPlus users the outputs that are available for a specific EnergyPlus simulation. Knowing the outputs that are available in your model would allow users to identify and subsequently specify relevant outputs for further analysis. Two data dictionary reports are produced and they are the <strong>m</strong>eter <strong>d</strong>ata <strong>d</strong>ictionary (<code>.mdd</code>) file and the <strong>r</strong>eport <strong>d</strong>ata <strong>d</strong>ictionary (<code>.rdd</code>) file. The <code>.mdd</code> file lists the names of the output meters while the <code>.rdd</code> file lists the names of the output variables that are available for the simulation. However, you must first run the simulation before the available variables and meters can be known. By setting <code>weather = NULL</code>, a design day simulation will be run, allowing us to obtain the <code>.rdd</code> and <code>.mdd</code> file without running an annual simulation that can be time consuming for complex models.</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">job</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>weather <span class="op">=</span> <span class="cn">NULL</span>, dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## Replace the existing IDF located at /private/var/folders/6l/8dz74knn0yd02c_bt8fl1pk80000gn/T/RtmpvR9Eai/RefBldgMediumOfficeNew2004_Chicago.idf.</span>
<span class="co">## EnergyPlus Starting</span>
<span class="co">## EnergyPlus, Version 9.4.0-998c4b761e, YMD=2021.10.13 23:08</span>
<span class="co">## </span>
<span class="co">## Could not find platform independent libraries &lt;prefix&gt;</span>
<span class="co">## Could not find platform dependent libraries &lt;exec_prefix&gt;</span>
<span class="co">## Consider setting $PYTHONHOME to &lt;prefix&gt;[:&lt;exec_prefix&gt;]</span>
<span class="co">## Initializing Response Factors</span>
<span class="co">## Calculating CTFs for "STEEL FRAME NON-RES EXT WALL"</span>
<span class="co">## Calculating CTFs for "IEAD NON-RES ROOF"</span>
<span class="co">## Calculating CTFs for "EXT-SLAB"</span>
<span class="va">....</span></code></pre></div>
<p>You can then retrieve the list of available variables and meters with the function <code><a href="https://hongyuanjia.github.io/eplusr/reference/rdd.html">read_rdd()</a></code> and the <code><a href="https://hongyuanjia.github.io/eplusr/reference/rdd.html">read_mdd()</a></code> function respectively. Both functions return a five column <code>data.table</code>.</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdd</span> <span class="op">&lt;-</span> <span class="va">job</span><span class="op">$</span><span class="fu">read_mdd</span><span class="op">(</span><span class="op">)</span>
<span class="va">mdd</span>
<span class="co">## ══ EnergyPlus Meter Data Dictionary File ═══════════════════════════════════════</span>
<span class="co">##   * EnergyPlus version: 9.4.0 (998c4b761e)</span>
<span class="co">##   * Simulation started: 2021-10-13 23:08:00</span>
<span class="co">## </span>
<span class="co">## ── Details ─────────────────────────────────────────────────────────────────────</span>
<span class="co">##      index reported_time_step report_type</span>
<span class="co">##   1:     1               Zone       Meter</span>
<span class="co">##   2:     2               Zone       Meter</span>
<span class="co">##   3:     3               Zone       Meter</span>
<span class="co">##   4:     4               Zone       Meter</span>
<span class="va">....</span></code></pre></div>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rdd</span> <span class="op">&lt;-</span> <span class="va">job</span><span class="op">$</span><span class="fu">read_rdd</span><span class="op">(</span><span class="op">)</span>
<span class="va">rdd</span>
<span class="co">## ══ EnergyPlus Report Data Dictionary File ══════════════════════════════════════</span>
<span class="co">##   * EnergyPlus version: 9.4.0 (998c4b761e)</span>
<span class="co">##   * Simulation started: 2021-10-13 23:08:00</span>
<span class="co">## </span>
<span class="co">## ── Details ─────────────────────────────────────────────────────────────────────</span>
<span class="co">##      index reported_time_step report_type</span>
<span class="co">##   1:     1               Zone     Average</span>
<span class="co">##   2:     2               Zone     Average</span>
<span class="co">##   3:     3               Zone     Average</span>
<span class="co">##   4:     4               Zone     Average</span>
<span class="va">....</span></code></pre></div>
<p>To specify an output variable of interest, you can add the name of the variable and the corresponding reporting frequency to the <code>Output:Variable</code> object. To avoid a long list of redundant and unnecessary output variables, you should first remove all of them.</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="va">Output_Variable</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">model</span><span class="op">$</span><span class="va">Output_Meter</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></code></pre></div>
<p>You can then use the <code>$add()</code> method to add your variable output of interest. The first argument to the <code>$add()</code> method is a list of EnergyPlus object definitions where each list is named with a valid class name. In this case, the relevant EnergyPlus objects for defining output meters (<code>.mdd</code>) and variables (<code>.rdd</code>) are the <code>Output:Meter</code> and the <code>Output:Variable</code> objects respectively.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    Output_Variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        key_value <span class="op">=</span> <span class="st">"*"</span>,
        Variable_Name <span class="op">=</span> <span class="st">"Site Outdoor Air Drybulb Temperature"</span>,
        Reporting_Frequency <span class="op">=</span> <span class="st">"Hourly"</span><span class="op">)</span>,
    Output_Variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        key_value <span class="op">=</span> <span class="st">"*"</span>,
        Variable_Name <span class="op">=</span> <span class="st">"Zone Mean Air Temperature"</span>,
        Reporting_Frequency <span class="op">=</span> <span class="st">"Hourly"</span><span class="op">)</span>,
    Output_Meter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        key_name <span class="op">=</span> <span class="st">"Cooling:Electricity"</span>,
        Reporting_Frequency <span class="op">=</span> <span class="st">"Hourly"</span><span class="op">)</span>,
    Output_Meter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        key_name <span class="op">=</span> <span class="st">"Heating:NaturalGas"</span>,
        Reporting_Frequency <span class="op">=</span> <span class="st">"Hourly"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">model</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">output_list</span><span class="op">)</span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Variable'&gt; [ID:682]</span>
<span class="co">## Class: &lt;Output:Variable&gt;</span>
<span class="co">## ├─ 1 : "*",                !- Key Value</span>
<span class="co">## │─ 2*: "Site Outdoor Air Drybulb Temperature",  !- Variable Name</span>
<span class="co">## └─ 3 : "Hourly";           !- Reporting Frequency</span>
<span class="co">## </span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Variable'&gt; [ID:683]</span>
<span class="co">## Class: &lt;Output:Variable&gt;</span>
<span class="va">....</span></code></pre></div>
<p>The above code to add meters and variables can become unnecessarily long if you are adding multiple objects of the same class (in the above example, the <code>Output:Meter</code> and <code>Output:Variable</code> class. You can take advantage of <code>data.table</code>’s <code>:=</code> operator to assign the object name by reference.</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    key_value <span class="op">=</span> <span class="st">"*"</span>,
    Variable_Name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"Site Outdoor Air Drybulb Temperature"</span>,
        <span class="st">"Zone Mean Air Temperature"</span>
    <span class="op">)</span>,
    Reporting_Frequency <span class="op">=</span> <span class="st">"Hourly"</span>
<span class="op">)</span>

<span class="va">model</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">Output_Variable</span> <span class="op">:=</span> <span class="va">variables</span><span class="op">)</span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Variable'&gt; [ID:686]</span>
<span class="co">## Class: &lt;Output:Variable&gt;</span>
<span class="co">## ├─ 1 : "*",                !- Key Value</span>
<span class="co">## │─ 2*: "Site Outdoor Air Drybulb Temperature",  !- Variable Name</span>
<span class="co">## └─ 3 : "Hourly";           !- Reporting Frequency</span>
<span class="co">## </span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Variable'&gt; [ID:687]</span>
<span class="co">## Class: &lt;Output:Variable&gt;</span>
<span class="va">....</span></code></pre></div>
<p>Likewise, you can use the <code>$add()</code> method to add your variable meter of interest.</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    key_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"Cooling:Electricity"</span>,
        <span class="st">"Heating:NaturalGas"</span>
    <span class="op">)</span>,
    Reporting_Frequency <span class="op">=</span> <span class="st">"Hourly"</span>
<span class="op">)</span>

<span class="co"># add meter outputs to get hourly time-series energy consumption</span>
<span class="va">model</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">Output_Meter</span> <span class="op">:=</span> <span class="va">meters</span><span class="op">)</span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Meter'&gt; [ID:688]</span>
<span class="co">## Class: &lt;Output:Meter&gt;</span>
<span class="co">## ├─ 1*: "Cooling:Electricity",  !- Key Name</span>
<span class="co">## └─ 2 : "Hourly";           !- Reporting Frequency</span>
<span class="co">## </span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Meter'&gt; [ID:689]</span>
<span class="co">## Class: &lt;Output:Meter&gt;</span>
<span class="co">## ├─ 1*: "Heating:NaturalGas",  !- Key Name</span>
<span class="va">....</span></code></pre></div>
<p>Here is a useful function <code>preprocess_idf()</code> that you can use to preprocess your EnergyPlus simulations so that it (1) uses the weather file for the simulation, (2) presents energy consumption outputs in kWh, and (3) remove all existing output meters and variables and add the list of meters and variables provided as arguments to the function.</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">preprocess_idf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">idf</span>, <span class="va">meters</span>, <span class="va">variables</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># make sure weather file input is respected</span>
    <span class="va">idf</span><span class="op">$</span><span class="va">SimulationControl</span><span class="op">$</span><span class="va">Run_Simulation_for_Weather_File_Run_Periods</span> <span class="op">&lt;-</span> <span class="st">"Yes"</span>
    
    <span class="co"># make sure simulation is not run for sizing periods</span>
    <span class="va">idf</span><span class="op">$</span><span class="va">SimulationControl</span><span class="op">$</span><span class="va">Run_Simulation_for_Sizing_Periods</span> <span class="op">&lt;-</span> <span class="st">"No"</span>

    <span class="co"># make sure energy consumption is presented in kWh</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">idf</span><span class="op">$</span><span class="va">OutputControl_Table_Style</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">idf</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span>OutputControl_Table_Style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"HTML"</span>, <span class="st">"JtoKWH"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
        <span class="va">idf</span><span class="op">$</span><span class="va">OutputControl_Table_Style</span><span class="op">$</span><span class="va">Unit_Conversion</span> <span class="op">&lt;-</span> <span class="st">"JtoKWH"</span>
    <span class="op">}</span>

    <span class="co"># remove all existing meter and variable outputs</span>
    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">idf</span><span class="op">$</span><span class="va">`Output:Meter`</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
        <span class="va">idf</span><span class="op">$</span><span class="va">Output_Meter</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
    <span class="op">}</span>
    
    <span class="co"># remove all existing meter and variable outputs</span>
    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">idf</span><span class="op">$</span><span class="va">`Output:Table:Monthly`</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
        <span class="va">idf</span><span class="op">$</span><span class="va">`Output:Table:Monthly`</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
    <span class="op">}</span>

    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">idf</span><span class="op">$</span><span class="va">`Output:Variable`</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
        <span class="va">idf</span><span class="op">$</span><span class="va">Output_Variable</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
    <span class="op">}</span>

    <span class="co"># add meter outputs to get hourly time-series energy consumption</span>
    <span class="va">idf</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">Output_Meter</span> <span class="op">:=</span> <span class="va">meters</span><span class="op">)</span>

    <span class="co"># add variable outputs to get hourly zone air temperature</span>
    <span class="va">idf</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">Output_Variable</span> <span class="op">:=</span> <span class="va">variables</span><span class="op">)</span>

    <span class="co"># make sure the modified model is returned</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">idf</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The following code demonstrates the use of the function <code>preprocess_idf()</code>.</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    key_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"Cooling:Electricity"</span>,
        <span class="st">"Heating:NaturalGas"</span>,
        <span class="st">"Heating:Electricity"</span>,
        <span class="st">"InteriorLights:Electricity"</span>,
        <span class="st">"ExteriorLights:Electricity"</span>,
        <span class="st">"InteriorEquipment:Electricity"</span>,
        <span class="st">"Fans:Electricity"</span>,
        <span class="st">"Pumps:Electricity"</span>,
        <span class="st">"WaterSystems:NaturalGas"</span>
    <span class="op">)</span>,
    Reporting_Frequency <span class="op">=</span> <span class="st">"Hourly"</span>
<span class="op">)</span>

<span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    key_value <span class="op">=</span> <span class="st">"*"</span>,
    Variable_Name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"Site Outdoor Air Drybulb Temperature"</span>,
        <span class="st">"Site Outdoor Air Relative Humidity"</span>
    <span class="op">)</span>,
    Reporting_Frequency <span class="op">=</span> <span class="st">"Hourly"</span>
<span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">preprocess_idf</span><span class="op">(</span><span class="va">model</span>, <span class="va">meters</span>, <span class="va">variables</span><span class="op">)</span></code></pre></div>
<p>Check if the output variables and meters have been correctly added</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="va">Output_Variable</span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Variable'&gt; [ID:691]</span>
<span class="co">## Class: &lt;Output:Variable&gt;</span>
<span class="co">## ├─ 1 : "*",                !- Key Value</span>
<span class="co">## │─ 2*: "Site Outdoor Air Drybulb Temperature",  !- Variable Name</span>
<span class="co">## └─ 3 : "Hourly";           !- Reporting Frequency</span>
<span class="co">## </span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Variable'&gt; [ID:692]</span>
<span class="co">## Class: &lt;Output:Variable&gt;</span>
<span class="va">....</span></code></pre></div>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="va">Output_Meter</span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Meter'&gt; [ID:682]</span>
<span class="co">## Class: &lt;Output:Meter&gt;</span>
<span class="co">## ├─ 1*: "Cooling:Electricity",  !- Key Name</span>
<span class="co">## └─ 2 : "Hourly";           !- Reporting Frequency</span>
<span class="co">## </span>
<span class="co">## $&lt;NA&gt;</span>
<span class="co">## &lt;IdfObject: 'Output:Meter'&gt; [ID:683]</span>
<span class="co">## Class: &lt;Output:Meter&gt;</span>
<span class="co">## ├─ 1*: "Heating:NaturalGas",  !- Key Name</span>
<span class="va">....</span></code></pre></div>
<p>Before you can explore the outputs, you have to first save the model and run the simulation.</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"idf"</span>, <span class="st">"model_preprocessed.idf"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">## Replace the existing IDF located at /Users/adrianchong/Documents/GitHub/r4bes/data/idf/model_preprocessed.idf.</span>
<span class="va">job</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="va">epw</span>, dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## EnergyPlus Starting</span>
<span class="co">## EnergyPlus, Version 9.4.0-998c4b761e, YMD=2021.10.13 23:08</span>
<span class="co">## </span>
<span class="co">## Could not find platform independent libraries &lt;prefix&gt;</span>
<span class="co">## Could not find platform dependent libraries &lt;exec_prefix&gt;</span>
<span class="co">## Consider setting $PYTHONHOME to &lt;prefix&gt;[:&lt;exec_prefix&gt;]</span>
<span class="co">## Initializing Response Factors</span>
<span class="co">## Calculating CTFs for "STEEL FRAME NON-RES EXT WALL"</span>
<span class="co">## Calculating CTFs for "IEAD NON-RES ROOF"</span>
<span class="co">## Calculating CTFs for "EXT-SLAB"</span>
<span class="va">....</span></code></pre></div>
<p>You will then be able to extract the output variables and meters that have just been specified.</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">report</span> <span class="op">&lt;-</span> <span class="va">job</span><span class="op">$</span><span class="fu">report_data</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">select</span><span class="op">(</span><span class="va">datetime</span>, <span class="va">name</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="va">variables</span><span class="op">$</span><span class="va">Variable_Name</span> <span class="op">|</span> <span class="va">name</span> <span class="op">%in%</span> <span class="va">meters</span><span class="op">$</span><span class="va">key_name</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">name</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">report</span><span class="op">)</span>
<span class="co">## # A tibble: 6 x 12</span>
<span class="co">##   datetime            `Site Outdoor Air D… `Site Outdoor Air … `InteriorLights:…</span>
<span class="co">##   &lt;dttm&gt;                             &lt;dbl&gt;               &lt;dbl&gt;             &lt;dbl&gt;</span>
<span class="co">## 1 2021-01-01 01:00:00                -7.82                72.6          9649498.</span>
<span class="co">## 2 2021-01-01 02:00:00               -11.9                 73            9649498.</span>
<span class="co">## 3 2021-01-01 03:00:00               -11.4                 73            9649498.</span>
<span class="co">## 4 2021-01-01 04:00:00               -11.1                 73            9649498.</span>
<span class="co">## 5 2021-01-01 05:00:00               -10.8                 73            9649498.</span>
<span class="co">## 6 2021-01-01 06:00:00               -10.6                 73            9649498.</span>
<span class="co">## # … with 8 more variables: InteriorEquipment:Electricity &lt;dbl&gt;,</span>
<span class="va">....</span></code></pre></div>
</div>
<div id="mtd-file" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> mtd file<a class="anchor" aria-label="anchor" href="#mtd-file"><i class="fas fa-link"></i></a>
</h2>
<p>You can also look at the mtd file to know what report variables are on which meters and vice versa</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="modify.html"><span class="header-section-number">14</span> Modify model inputs</a></div>
<div class="next"><a href="explore.html"><span class="header-section-number">16</span> Model Exploration</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#output"><span class="header-section-number">15</span> Detailed output</a></li>
<li><a class="nav-link" href="#prerequisites-12"><span class="header-section-number">15.1</span> Prerequisites</a></li>
<li><a class="nav-link" href="#variable-dictionary-reports"><span class="header-section-number">15.2</span> Variable dictionary reports</a></li>
<li><a class="nav-link" href="#mtd-file"><span class="header-section-number">15.3</span> mtd file</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Building Energy Simulation</strong>" was written by Adrian Chong. It was last built on 2021-10-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>

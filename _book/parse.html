<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Parse then simulate | R for Building Energy Simulation</title>
<meta name="author" content="Adrian Chong">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Building Energy Simulation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">R Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="basics.html"><span class="header-section-number">2</span> Basics</a></li>
<li><a class="" href="dates-and-times.html"><span class="header-section-number">3</span> Dates and Times</a></li>
<li><a class="" href="importing-data.html"><span class="header-section-number">4</span> Importing Data</a></li>
<li><a class="" href="regular-expressions.html"><span class="header-section-number">5</span> Regular expressions</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">6</span> Functions</a></li>
<li><a class="" href="manipulate.html"><span class="header-section-number">7</span> Manipulating Data</a></li>
<li class="book-part">Get Started</li>
<li><a class="" href="get-started.html"><span class="header-section-number">8</span> Introduction</a></li>
<li><a class="active" href="parse.html"><span class="header-section-number">9</span> Parse then simulate</a></li>
<li><a class="" href="summary.html"><span class="header-section-number">10</span> Summary reports</a></li>
<li><a class="" href="visualize.html"><span class="header-section-number">11</span> Visualize</a></li>
<li class="book-part">Inputs and Outputs</li>
<li><a class="" href="input-output.html"><span class="header-section-number">12</span> Introduction</a></li>
<li><a class="" href="input.html"><span class="header-section-number">13</span> Model Input Structure</a></li>
<li><a class="" href="modify.html"><span class="header-section-number">14</span> Modify model inputs</a></li>
<li><a class="" href="output.html"><span class="header-section-number">15</span> Detailed output</a></li>
<li><a class="" href="explore.html"><span class="header-section-number">16</span> Model Exploration</a></li>
<li class="book-part">Program</li>
<li><a class="" href="program.html"><span class="header-section-number">17</span> Introduction</a></li>
<li><a class="" href="energy-efficient-measures.html"><span class="header-section-number">18</span> Energy Efficient Measures</a></li>
<li><a class="" href="parametric-simulations.html"><span class="header-section-number">19</span> Parametric simulations</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="advanced.html"><span class="header-section-number">20</span> Introduction</a></li>
<li><a class="" href="sensitivity-analysis.html"><span class="header-section-number">21</span> Sensitivity analysis</a></li>
<li><a class="" href="optimization.html"><span class="header-section-number">22</span> Optimization</a></li>
<li><a class="" href="calibration.html"><span class="header-section-number">23</span> Calibration</a></li>
<li class="book-part">Reproduce</li>
<li><a class="" href="reproduce.html"><span class="header-section-number">24</span> Introduction</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">25</span> R Markdown</a></li>
<li><a class="" href="containers.html"><span class="header-section-number">26</span> Containers</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="parse" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Parse then simulate<a class="anchor" aria-label="anchor" href="#parse"><i class="fas fa-link"></i></a>
</h1>
<div id="prerequisites-7" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites-7"><i class="fas fa-link"></i></a>
</h2>
<p>In this chapter we will introduce the <strong>eplusr</strong> package that was designed to interface with EnergyPlus and ease the application of data driven analytics. If you like to learn more about the underlying theory of how data is structured under the hood, you might enjoy the <em>eplusr</em> paper published in the Journal Energy and Buildings <span class="citation">[<a href="containers.html#ref-jia_eplusr_2021" role="doc-biblioref">7</a>]</span>.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hongyuanjia.github.io/eplusr/">eplusr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></code></pre></div>
<p>In this book, you will learn using the U.S. Department of Energy (DOE) Commercial Reference Building for medium office energy model <span class="citation">[<a href="containers.html#ref-deru_us_2011" role="doc-biblioref">3</a>]</span>. We use the DOE reference building because it is well established and widely used. More importantly, it is publicly available and comes distributed with EnergyPlus as example files, making the examples and code in this book easier to follow and reproduce.</p>
<p>For your convenience, the model can be found at <code>./data/idf/RefBldgMediumOfficeNew2004_Chicago.idf</code> relative to the project root folder. Likewise, the weather file that we will be using can be found at <code>./data/epw/USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.epw</code> relative to the project root folder.</p>
</div>
<div id="key-energyplus-files" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Key EnergyPlus files<a class="anchor" aria-label="anchor" href="#key-energyplus-files"><i class="fas fa-link"></i></a>
</h2>
<p>Before starting to work with EnergyPlus, there are three main EnergyPlus files that you should know: the input data dictionary (IDD), the input data file (IDF), and the EnergyPlus weather file (EPW). All three files are ASCII files also know as text files. The IDD lists all possible objects in EnergyPlus along with their respective input requirements. The IDF provides a description of the building to be simulated. The EPW contains the hourly or sub-hourly weather data (i.e., the boundary conditions) needed for the simulation.</p>
</div>
<div id="parsing-the-model" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> Parsing the model<a class="anchor" aria-label="anchor" href="#parsing-the-model"><i class="fas fa-link"></i></a>
</h2>
<p>Before starting, you need to first tell R where EnergyPlus is located.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://hongyuanjia.github.io/eplusr/reference/use_eplus.html">use_eplus</a></span><span class="op">(</span><span class="st">"/Applications/EnergyPlus-9-4-0"</span><span class="op">)</span>
<span class="co">## Configure data of EnergyPlus v9.4.0 located at '/Applications/EnergyPlus-9-4-0' already exists. No Updating performed.</span></code></pre></div>
<p>To get started, you need to first be familiar with the three basic classes (<code>Idf</code>, <code>Epw</code>, and the <code>EplusJob</code>) of the eplusr package.</p>
<p>The <code>Idf</code> class is used to represent the EnergyPlus model. It contains methods that allows you to easily query and modify the model. You can use the <code><a href="https://hongyuanjia.github.io/eplusr/reference/read_idf.html">read_idf()</a></code> function to parse the EnergyPlus model into R by providing the file path to the EnergyPlus IDF file. You can use the function <code><a href="https://here.r-lib.org//reference/here.html">here()</a></code> to easily reference the file path relative to the project root folder.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path_idf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"idf"</span>, <span class="st">"RefBldgMediumOfficeNew2004_Chicago.idf"</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hongyuanjia.github.io/eplusr/reference/read_idf.html">read_idf</a></span><span class="op">(</span><span class="va">path_idf</span><span class="op">)</span>
<span class="co">## IDD v9.4.0 has not been parsed before.</span>
<span class="co">## Try to locate 'Energy+.idd' in EnergyPlus v9.4.0 installation folder '/Applications/EnergyPlus-9-4-0'.</span>
<span class="co">## IDD file found: '/Applications/EnergyPlus-9-4-0/Energy+.idd'.</span>
<span class="co">## Start parsing...</span>
<span class="co">## Parsing completed.</span></code></pre></div>
<p>The <code>Epw</code> class is used to represent the weather data that will be used for the simulation. You can use the <code><a href="https://hongyuanjia.github.io/eplusr/reference/read_epw.html">read_epw()</a></code> function to parse an EPW weather file into R by providing the file path to the EnergyPlus EPW file. Likewise, the function <code><a href="https://here.r-lib.org//reference/here.html">here()</a></code> is used to easily reference the file path relative to the project root folder.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path_epw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"epw"</span>, <span class="st">"USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.epw"</span><span class="op">)</span>
<span class="va">epw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hongyuanjia.github.io/eplusr/reference/read_epw.html">read_epw</a></span><span class="op">(</span><span class="va">path_epw</span><span class="op">)</span></code></pre></div>
<p>The <code>EplusJob</code> is used extract the simulation results. When you run the model, a <code>EplusJob</code> object is returned. One way to run the model is to use the <code>$run()</code> method of the <code>Idf</code> class, and provide the weather file in the form of an <code>epw</code> object.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">job</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">epw</span><span class="op">)</span></code></pre></div>
</div>
<div id="simulating-the-model" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> Simulating the model<a class="anchor" aria-label="anchor" href="#simulating-the-model"><i class="fas fa-link"></i></a>
</h2>
<p>You should check the SimulationControl and RunPeriod objects in EnergyPlus before simulating the model. The SimulationControl object allows the user to specify the type of simulations that will be performed. You can view this object in R by navigating to and opening the <code>RefBldgMediumOfficeNew2004_Chicago.idf</code> file in R followed by searching for the string <code>SimulationControl</code> (Figure <a href="parse.html#fig:sim-control">9.1</a>). If the value for the <code>Run Simulation for Weather File Run Periods</code> field is <code>NO</code> as illustrated in Figure <a href="parse.html#fig:sim-control">9.1</a>, the simulation will be <strong>not</strong> be run on for the weather file run periods (Figure <a href="parse.html#fig:run-period">9.2</a>). In other words, if you want to run the simulation based on the provided epw weather file for the period specify by the RunPeriod object, check that this field is set to <code>YES</code>.</p>
<div class="figure" style="text-align: center">
<span id="fig:sim-control"></span>
<img src="figures/sim_control.png" alt="SimulationControl object in EnergyPlus." width="80%"><p class="caption">
Figure 9.1: SimulationControl object in EnergyPlus.
</p>
</div>
<div class="figure" style="text-align: center">
<span id="fig:run-period"></span>
<img src="figures/run_period.png" alt="RunPeriod object in EnergyPlus." width="80%"><p class="caption">
Figure 9.2: RunPeriod object in EnergyPlus.
</p>
</div>
<p>You can use the <code>run()</code> method of the Idf class to run the simulation using EnergyPlus. You can choose the weather file to run the simulation by specifying an <code>Epw</code> object or a file path of an <code>.epw</code> file to the <code>weather</code> argument. You can also specify a directory to save the simulation results using the <code>dir</code> argument. By default, the folder of your Idf file is used to save the simulation results.</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">job</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">epw</span>,
                 dir <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"idf"</span>, <span class="st">"run"</span>, <span class="st">"test_run.idf"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>If you do not want to save the simulation results locally, you can save the simulation output files to a temporary directory by specifying <code>dir = tempdir()</code>.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">job</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="va">epw</span>, dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## EnergyPlus Starting</span>
<span class="co">## EnergyPlus, Version 9.4.0-998c4b761e, YMD=2021.09.06 10:34</span>
<span class="co">## </span>
<span class="co">## Could not find platform independent libraries &lt;prefix&gt;</span>
<span class="co">## Could not find platform dependent libraries &lt;exec_prefix&gt;</span>
<span class="co">## Consider setting $PYTHONHOME to &lt;prefix&gt;[:&lt;exec_prefix&gt;]</span>
<span class="co">## Initializing Response Factors</span>
<span class="co">## Calculating CTFs for "STEEL FRAME NON-RES EXT WALL"</span>
<span class="co">## Calculating CTFs for "IEAD NON-RES ROOF"</span>
<span class="co">## Calculating CTFs for "EXT-SLAB"</span>
<span class="va">....</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="get-started.html"><span class="header-section-number">8</span> Introduction</a></div>
<div class="next"><a href="summary.html"><span class="header-section-number">10</span> Summary reports</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#parse"><span class="header-section-number">9</span> Parse then simulate</a></li>
<li><a class="nav-link" href="#prerequisites-7"><span class="header-section-number">9.1</span> Prerequisites</a></li>
<li><a class="nav-link" href="#key-energyplus-files"><span class="header-section-number">9.2</span> Key EnergyPlus files</a></li>
<li><a class="nav-link" href="#parsing-the-model"><span class="header-section-number">9.3</span> Parsing the model</a></li>
<li><a class="nav-link" href="#simulating-the-model"><span class="header-section-number">9.4</span> Simulating the model</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Building Energy Simulation</strong>" was written by Adrian Chong. It was last built on 2021-09-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>

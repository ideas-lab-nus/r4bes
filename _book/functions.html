<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Functions | R for Building Energy Simulation</title>
<meta name="author" content="Adrian Chong">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Building Energy Simulation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">R Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="basics.html"><span class="header-section-number">2</span> Basics</a></li>
<li><a class="" href="dates-and-times.html"><span class="header-section-number">3</span> Dates and Times</a></li>
<li><a class="" href="importing-data.html"><span class="header-section-number">4</span> Importing Data</a></li>
<li><a class="" href="regular-expressions.html"><span class="header-section-number">5</span> Regular expressions</a></li>
<li><a class="active" href="functions.html"><span class="header-section-number">6</span> Functions</a></li>
<li><a class="" href="manipulate.html"><span class="header-section-number">7</span> Manipulating Data</a></li>
<li class="book-part">Get Started</li>
<li><a class="" href="get-started.html"><span class="header-section-number">8</span> Introduction</a></li>
<li><a class="" href="parse.html"><span class="header-section-number">9</span> Parse then simulate</a></li>
<li><a class="" href="summary.html"><span class="header-section-number">10</span> Summary reports</a></li>
<li><a class="" href="visualize.html"><span class="header-section-number">11</span> Visualize</a></li>
<li class="book-part">Inputs and Outputs</li>
<li><a class="" href="input-output.html"><span class="header-section-number">12</span> Introduction</a></li>
<li><a class="" href="input.html"><span class="header-section-number">13</span> Model Input Structure</a></li>
<li><a class="" href="modify.html"><span class="header-section-number">14</span> Modify model inputs</a></li>
<li><a class="" href="output.html"><span class="header-section-number">15</span> Detailed output</a></li>
<li><a class="" href="explore.html"><span class="header-section-number">16</span> Model Exploration</a></li>
<li class="book-part">Program</li>
<li><a class="" href="program.html"><span class="header-section-number">17</span> Introduction</a></li>
<li><a class="" href="energy-efficient-measures.html"><span class="header-section-number">18</span> Energy Efficient Measures</a></li>
<li><a class="" href="parametric-simulations.html"><span class="header-section-number">19</span> Parametric simulations</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="advanced.html"><span class="header-section-number">20</span> Introduction</a></li>
<li><a class="" href="sensitivity-analysis.html"><span class="header-section-number">21</span> Sensitivity analysis</a></li>
<li><a class="" href="optimization.html"><span class="header-section-number">22</span> Optimization</a></li>
<li><a class="" href="calibration.html"><span class="header-section-number">23</span> Calibration</a></li>
<li class="book-part">Reproduce</li>
<li><a class="" href="reproduce.html"><span class="header-section-number">24</span> Introduction</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">25</span> R Markdown</a></li>
<li><a class="" href="containers.html"><span class="header-section-number">26</span> Containers</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="functions" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Functions<a class="anchor" aria-label="anchor" href="#functions"><i class="fas fa-link"></i></a>
</h1>
<p>Writing functions is a simple way to automate commonly used code in a more general way. Therefore, you should write a function when you realized that you are copying and pasting a code block more than once. Particularly, you will see the power of functions as we start writing functions to define building energy efficient measures that we wish to apply to the building energy simulation.</p>
<p>Additionally, using functions helps you to avoid making mistakes that happen all too often when copying and pasting code. Additionally, as your requirements change, you only need to update the code in one place (i.e., within the function) instead of searching and updating pieces of code, which is again error-prone.</p>
<div id="prerequisites-5" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites-5"><i class="fas fa-link"></i></a>
</h2>
<p>We will use base R code to illustrate creating user-defined functions. Therefore, no additional packages are required.</p>
</div>
<div id="user-defined-function" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> User-defined function<a class="anchor" aria-label="anchor" href="#user-defined-function"><i class="fas fa-link"></i></a>
</h2>
<p>The code block below shows the syntax for creating an R user-defined function using the <code>function</code> keyword. In general, a function
* Function name (<code>function_name</code>): This is the name of the function that you will be creating and the name that you will use to call the function. Following section <a href="#style"><strong>??</strong></a>, function names will use <code>snake_case</code> and be reflective of what it does.
* Function arguments (<code>arg1</code>, <code>arg2</code>, <code>...</code>): These are inputs to the function that will be used by the code that you place inside the function.
* Function body: You place your code inside the body of a function that is enclosed by braces <code>{Function body}</code>
* Return statement: Unlike other programming languages, it is not necessary to include the <code><a href="https://rdrr.io/r/base/function.html">return()</a></code> statement in R. R automatically returns the last line of the body of the function.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="functions.html#cb70-1" aria-hidden="true" tabindex="-1"></a>function_name <span class="ot">&lt;-</span> <span class="cf">function</span>(arg1, arg2, ...){</span>
<span id="cb70-2"><a href="functions.html#cb70-2" aria-hidden="true" tabindex="-1"></a>  Function body</span>
<span id="cb70-3"><a href="functions.html#cb70-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="examples" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Examples<a class="anchor" aria-label="anchor" href="#examples"><i class="fas fa-link"></i></a>
</h2>
<p>The Coefficient of Variation of the Root-Mean-Square Error (CVRMSE) (equation <a href="functions.html#eq:cvrmse">(6.1)</a>) and Normalized mean bias error (NMBE) (equation <a href="functions.html#eq:nmbe">(6.2)</a>) are two of the most widely used indices when evaluating how well an energy models describes the variability in measured data <span class="citation">[<a href="containers.html#ref-ashrae_ashrae_2014" role="doc-biblioref">6</a>]</span>. As an example, we demonstrate how these equations would translate to a user-defined function in R.</p>
<p><span class="math display" id="eq:cvrmse">\[\begin{equation} 
  \sqrt{\frac{\sum_{i=1}^{n} \left(y_i - \hat{y}_i\right)}{(n-p)}} \Big/ \bar{y}
  \tag{6.1}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:nmbe">\[\begin{equation} 
  \frac{\sum_{i=1}^{n} \left(y_i - \hat{y}_i\right)}{(n-p)\times\bar{y}}
  \tag{6.2}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(n\)</span> is the number of observations; <span class="math inline">\(y_i\)</span> is the <span class="math inline">\(i\)</span>th observation; <span class="math inline">\(\hat{y_i}\)</span> is the <span class="math inline">\(i\)</span>th prediction; <span class="math inline">\(\bar{y}\)</span> is the mean of the observed values.</p>
<p>You can use a function to compute CVRMSE as follows:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cvrmse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">meas</span>, <span class="va">pred</span>, <span class="va">p</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">se</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">meas</span> <span class="op">-</span> <span class="va">pred</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">meas</span><span class="op">)</span> <span class="co"># last line automatically returned</span>
<span class="op">}</span>

<span class="fu">cvrmse</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>
<span class="co">## [1] 1.322876</span></code></pre></div>
<p>You can use a function to compute NMBE as follows:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nmbe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">meas</span>, <span class="va">pred</span>, <span class="va">p</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">be</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">meas</span> <span class="op">-</span> <span class="va">pred</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span>
  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">meas</span><span class="op">)</span> <span class="co"># last line automatically returned</span>
<span class="op">}</span>
<span class="fu">nmbe</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>
<span class="co">## [1] -1.5</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="regular-expressions.html"><span class="header-section-number">5</span> Regular expressions</a></div>
<div class="next"><a href="manipulate.html"><span class="header-section-number">7</span> Manipulating Data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#functions"><span class="header-section-number">6</span> Functions</a></li>
<li><a class="nav-link" href="#prerequisites-5"><span class="header-section-number">6.1</span> Prerequisites</a></li>
<li><a class="nav-link" href="#user-defined-function"><span class="header-section-number">6.2</span> User-defined function</a></li>
<li><a class="nav-link" href="#examples"><span class="header-section-number">6.3</span> Examples</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Building Energy Simulation</strong>" was written by Adrian Chong. It was last built on 2021-09-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>

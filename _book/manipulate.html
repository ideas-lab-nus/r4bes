<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Manipulating Data | R for Building Energy Simulation</title>
<meta name="author" content="Adrian Chong">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Building Energy Simulation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">R Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="basics.html"><span class="header-section-number">2</span> Basics</a></li>
<li><a class="" href="dates-and-times.html"><span class="header-section-number">3</span> Dates and Times</a></li>
<li><a class="" href="importing-data.html"><span class="header-section-number">4</span> Importing Data</a></li>
<li><a class="" href="regular-expressions.html"><span class="header-section-number">5</span> Regular expressions</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">6</span> Functions</a></li>
<li><a class="active" href="manipulate.html"><span class="header-section-number">7</span> Manipulating Data</a></li>
<li class="book-part">Get Started</li>
<li><a class="" href="get-started.html"><span class="header-section-number">8</span> Introduction</a></li>
<li><a class="" href="parse.html"><span class="header-section-number">9</span> Parse then simulate</a></li>
<li><a class="" href="summary.html"><span class="header-section-number">10</span> Summary reports</a></li>
<li><a class="" href="visualize.html"><span class="header-section-number">11</span> Visualize</a></li>
<li class="book-part">Inputs and Outputs</li>
<li><a class="" href="input-output.html"><span class="header-section-number">12</span> Introduction</a></li>
<li><a class="" href="input.html"><span class="header-section-number">13</span> Model Input Structure</a></li>
<li><a class="" href="modify.html"><span class="header-section-number">14</span> Modify model inputs</a></li>
<li><a class="" href="output.html"><span class="header-section-number">15</span> Detailed output</a></li>
<li><a class="" href="explore.html"><span class="header-section-number">16</span> Model Exploration</a></li>
<li class="book-part">Program</li>
<li><a class="" href="program.html"><span class="header-section-number">17</span> Introduction</a></li>
<li><a class="" href="energy-efficient-measures.html"><span class="header-section-number">18</span> Energy Efficient Measures</a></li>
<li><a class="" href="parametric-simulations.html"><span class="header-section-number">19</span> Parametric simulations</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="advanced.html"><span class="header-section-number">20</span> Introduction</a></li>
<li><a class="" href="sensitivity-analysis.html"><span class="header-section-number">21</span> Sensitivity analysis</a></li>
<li><a class="" href="optimization.html"><span class="header-section-number">22</span> Optimization</a></li>
<li><a class="" href="calibration.html"><span class="header-section-number">23</span> Calibration</a></li>
<li class="book-part">Reproduce</li>
<li><a class="" href="reproduce.html"><span class="header-section-number">24</span> Introduction</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">25</span> R Markdown</a></li>
<li><a class="" href="containers.html"><span class="header-section-number">26</span> Containers</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="manipulate" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Manipulating Data<a class="anchor" aria-label="anchor" href="#manipulate"><i class="fas fa-link"></i></a>
</h1>
<p>Data-preprocessing is an important step in any data science process. Rarely will you receive data that is in the exact form that you need. More often than not, you would need to pre-process the data by transforming and manipulating them so that they are easier to work with. This will be the focus in this chapter.</p>
<div id="prerequisites-6" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites-6"><i class="fas fa-link"></i></a>
</h2>
<p>In this chapter we focus on the use of the <strong>dplyr</strong> package that forms a core part of the <strong>tidyverse</strong> package. <strong>dplyr</strong> provides function that alleviates the challenges of data manipulation.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></code></pre></div>
<p>To explore the basic data manipulation capabilities of dplyr package, we will use the <code>building_meter</code> dataset. If the following code returns <code>FALSE</code>, you should refer to the section <a href="importing-data.html#finding-your-file">Finding your file</a> in the <a href="index.html#preface">Preface</a> on where you can download the datasets.</p>
<p>that can be downloaded from XXX. This dataset contains 8,760 time-series observations of typical building meter measurements that is simulated using the Department of Energy’s (DOE) reference building energy model for medium sized offices <span class="citation">[<a href="containers.html#ref-deru_us_2011" role="doc-biblioref">3</a>]</span>.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bldg</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"building_meter.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## </span>
<span class="co">## ── Column specification ────────────────────────────────────────────────────────</span>
<span class="co">## cols(</span>
<span class="co">##   `Date/Time` = col_datetime(format = ""),</span>
<span class="co">##   `Cooling:Electricity [J](Hourly)` = col_double(),</span>
<span class="co">##   `Heating:NaturalGas [J](Hourly)` = col_double(),</span>
<span class="co">##   `Heating:Electricity [J](Hourly)` = col_double(),</span>
<span class="co">##   `InteriorLights:Electricity [J](Hourly)` = col_double(),</span>
<span class="co">##   `ExteriorLights:Electricity [J](Hourly)` = col_double(),</span>
<span class="co">##   `InteriorEquipment:Electricity [J](Hourly)` = col_double(),</span>
<span class="co">##   `Fans:Electricity [J](Hourly)` = col_double(),</span>
<span class="co">##   `Pumps:Electricity [J](Hourly)` = col_double(),</span>
<span class="co">##   `WaterSystems:NaturalGas [J](Hourly)` = col_double()</span>
<span class="co">## )</span>
<span class="va">bldg</span>
<span class="co">## # A tibble: 8,760 x 10</span>
<span class="co">##    `Date/Time`         `Cooling:Electrici… `Heating:NaturalG… `Heating:Electric…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00                   0          13517796.         182286476.</span>
<span class="co">##  2 2020-01-01 02:00:00                   0          17717617.         177367416.</span>
<span class="co">##  3 2020-01-01 03:00:00                   0          25310615.         235785509 </span>
<span class="co">##  4 2020-01-01 04:00:00                   0          20001989.         184762495.</span>
<span class="co">##  5 2020-01-01 05:00:00                   0          27925599.         245249657.</span>
<span class="co">##  6 2020-01-01 06:00:00                   0          21886933.         190670331.</span>
<span class="co">##  7 2020-01-01 07:00:00                   0          29745424.         252272477.</span>
<span class="va">....</span></code></pre></div>
<p>Spaces make it difficult to</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_name</span> <span class="op">&lt;-</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bldg</span><span class="op">)</span>, <span class="st">"\\W\\W?"</span>, <span class="st">"_"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bldg</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">str_remove_all</span><span class="op">(</span><span class="va">new_name</span>, <span class="st">"_Hourly_"</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-transformation" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Data transformation<a class="anchor" aria-label="anchor" href="#data-transformation"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf">cheat sheet for dplyr</a> provides a good summary of data transformation functions covered in this chapter.</p>
<ul>
<li>
<code>select()</code>: To select columns based on their names.</li>
<li>
<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>: To subset rows based on their values.</li>
<li>
<code>mutate()</code>: To add new variables whose values are a function of existing variables.</li>
<li>
<code>arrange()</code>: To sort the dataset based on the values of selected columns</li>
<li>
<code>summarise()</code>:</li>
<li>
<code>join.R</code>: generic functions that joins two tables together</li>
</ul>
<div id="select" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> <code>select()</code><a class="anchor" aria-label="anchor" href="#select"><i class="fas fa-link"></i></a>
</h3>
<p>You can use the function <code>select()</code> to choose the variables to retain in the dataset based on their names. It is not uncommon to get datasets with hundred or thousands of variables. An example is when working with data from the building management system. Under these scenarios, it is often very useful to narrow down the dataset to contain only the variables of interest. <code>select()</code> allows you to do this very easily, to zoom in on the variables or columns of interest.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">select</span><span class="op">(</span><span class="va">bldg</span>, <span class="va">Date_Time</span>, <span class="va">Cooling_Electricity_J</span>, <span class="va">Heating_Electricity_J</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 3</span>
<span class="co">##    Date_Time           Cooling_Electricity_J Heating_Electricity_J</span>
<span class="co">##    &lt;dttm&gt;                              &lt;dbl&gt;                 &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00                     0            182286476.</span>
<span class="co">##  2 2020-01-01 02:00:00                     0            177367416.</span>
<span class="co">##  3 2020-01-01 03:00:00                     0            235785509 </span>
<span class="co">##  4 2020-01-01 04:00:00                     0            184762495.</span>
<span class="co">##  5 2020-01-01 05:00:00                     0            245249657.</span>
<span class="co">##  6 2020-01-01 06:00:00                     0            190670331.</span>
<span class="co">##  7 2020-01-01 07:00:00                     0            252272477.</span>
<span class="va">....</span></code></pre></div>
<p>You can also optionally rename columns with the <code>select()</code> function.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">select</span><span class="op">(</span><span class="va">bldg</span>,
  datetime <span class="op">=</span> <span class="va">Date_Time</span>,
  cooling <span class="op">=</span> <span class="va">Cooling_Electricity_J</span>,
  heating <span class="op">=</span> <span class="va">Heating_Electricity_J</span>
<span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 3</span>
<span class="co">##    datetime            cooling    heating</span>
<span class="co">##    &lt;dttm&gt;                &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00       0 182286476.</span>
<span class="co">##  2 2020-01-01 02:00:00       0 177367416.</span>
<span class="co">##  3 2020-01-01 03:00:00       0 235785509 </span>
<span class="co">##  4 2020-01-01 04:00:00       0 184762495.</span>
<span class="co">##  5 2020-01-01 05:00:00       0 245249657.</span>
<span class="co">##  6 2020-01-01 06:00:00       0 190670331.</span>
<span class="co">##  7 2020-01-01 07:00:00       0 252272477.</span>
<span class="va">....</span></code></pre></div>
<p>Additionally, tidyverse provides helper functions that lets you select columns by matching patterns in their names. For the following selection helper functions, a character vector is provided for the match. If <code><a href="https://rdrr.io/r/base/length.html">length()</a></code> of the character vector is larger than 1, the logical union (OR <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> operator) is taken.</p>
<ul>
<li>
<code>starts_with()</code>: Select columns that starts with a specific character vector</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">select</span><span class="op">(</span><span class="va">bldg</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Heating"</span>, <span class="st">"Cooling"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 3</span>
<span class="co">##    Heating_NaturalGas_J Heating_Electricity_J Cooling_Electricity_J</span>
<span class="co">##                   &lt;dbl&gt;                 &lt;dbl&gt;                 &lt;dbl&gt;</span>
<span class="co">##  1            13517796.            182286476.                     0</span>
<span class="co">##  2            17717617.            177367416.                     0</span>
<span class="co">##  3            25310615.            235785509                      0</span>
<span class="co">##  4            20001989.            184762495.                     0</span>
<span class="co">##  5            27925599.            245249657.                     0</span>
<span class="co">##  6            21886933.            190670331.                     0</span>
<span class="co">##  7            29745424.            252272477.                     0</span>
<span class="va">....</span></code></pre></div>
<ul>
<li>
<code>ends_with()</code>: Select columns that ends with a specific character vector</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">select</span><span class="op">(</span><span class="va">bldg</span>, <span class="fu">ends_with</span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 1</span>
<span class="co">##    Date_Time          </span>
<span class="co">##    &lt;dttm&gt;             </span>
<span class="co">##  1 2020-01-01 01:00:00</span>
<span class="co">##  2 2020-01-01 02:00:00</span>
<span class="co">##  3 2020-01-01 03:00:00</span>
<span class="co">##  4 2020-01-01 04:00:00</span>
<span class="co">##  5 2020-01-01 05:00:00</span>
<span class="co">##  6 2020-01-01 06:00:00</span>
<span class="co">##  7 2020-01-01 07:00:00</span>
<span class="va">....</span></code></pre></div>
<ul>
<li>
<code>contains()</code>: Select columns that contains a specific character vector</li>
</ul>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">select</span><span class="op">(</span>
  <span class="va">bldg</span>,
  <span class="fu">contains</span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      <span class="st">"Time"</span>,
      <span class="st">"electricity"</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 8</span>
<span class="co">##    Date_Time           Cooling_Electrici… Heating_Electrici… InteriorLights_Ele…</span>
<span class="co">##    &lt;dttm&gt;                           &lt;dbl&gt;              &lt;dbl&gt;               &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00                  0         182286476.            9649498.</span>
<span class="co">##  2 2020-01-01 02:00:00                  0         177367416.            9649498.</span>
<span class="co">##  3 2020-01-01 03:00:00                  0         235785509             9649498.</span>
<span class="co">##  4 2020-01-01 04:00:00                  0         184762495.            9649498.</span>
<span class="co">##  5 2020-01-01 05:00:00                  0         245249657.            9649498.</span>
<span class="co">##  6 2020-01-01 06:00:00                  0         190670331.            9649498.</span>
<span class="co">##  7 2020-01-01 07:00:00                  0         252272477.            9649498.</span>
<span class="va">....</span></code></pre></div>
<ul>
<li>
<code>matches()</code>: Select columns that matches a regular expression. <code>rename()</code> is a dplyr function that allows you to change the names of individual columns using <code>new_name</code> = <code>old_name</code>.</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg_ex</span> <span class="op">&lt;-</span> <span class="st">"[dD]ate.?[tT]ime"</span>

<span class="fu">select</span><span class="op">(</span><span class="va">bldg</span>, <span class="fu">matches</span><span class="op">(</span><span class="va">reg_ex</span>, ignore.case <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 1</span>
<span class="co">##    Date_Time          </span>
<span class="co">##    &lt;dttm&gt;             </span>
<span class="co">##  1 2020-01-01 01:00:00</span>
<span class="co">##  2 2020-01-01 02:00:00</span>
<span class="co">##  3 2020-01-01 03:00:00</span>
<span class="co">##  4 2020-01-01 04:00:00</span>
<span class="co">##  5 2020-01-01 05:00:00</span>
<span class="co">##  6 2020-01-01 06:00:00</span>
<span class="co">##  7 2020-01-01 07:00:00</span>
<span class="va">....</span>

<span class="va">bldg_rename_a</span> <span class="op">&lt;-</span> <span class="fu">rename</span><span class="op">(</span><span class="va">bldg</span>, `Date/Time` <span class="op">=</span> <span class="va">`Date_Time`</span><span class="op">)</span>
<span class="fu">select</span><span class="op">(</span><span class="va">bldg_rename_a</span>, <span class="fu">matches</span><span class="op">(</span><span class="va">reg_ex</span>, ignore.case <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 1</span>
<span class="co">##    `Date/Time`        </span>
<span class="co">##    &lt;dttm&gt;             </span>
<span class="co">##  1 2020-01-01 01:00:00</span>
<span class="co">##  2 2020-01-01 02:00:00</span>
<span class="co">##  3 2020-01-01 03:00:00</span>
<span class="co">##  4 2020-01-01 04:00:00</span>
<span class="co">##  5 2020-01-01 05:00:00</span>
<span class="co">##  6 2020-01-01 06:00:00</span>
<span class="co">##  7 2020-01-01 07:00:00</span>
<span class="va">....</span>


<span class="va">bldg_rename_b</span> <span class="op">&lt;-</span> <span class="fu">rename</span><span class="op">(</span><span class="va">bldg</span>, `datetime` <span class="op">=</span> <span class="va">`Date_Time`</span><span class="op">)</span>
<span class="fu">select</span><span class="op">(</span><span class="va">bldg_rename_b</span>, <span class="fu">matches</span><span class="op">(</span><span class="va">reg_ex</span>, ignore.case <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 1</span>
<span class="co">##    datetime           </span>
<span class="co">##    &lt;dttm&gt;             </span>
<span class="co">##  1 2020-01-01 01:00:00</span>
<span class="co">##  2 2020-01-01 02:00:00</span>
<span class="co">##  3 2020-01-01 03:00:00</span>
<span class="co">##  4 2020-01-01 04:00:00</span>
<span class="co">##  5 2020-01-01 05:00:00</span>
<span class="co">##  6 2020-01-01 06:00:00</span>
<span class="co">##  7 2020-01-01 07:00:00</span>
<span class="va">....</span></code></pre></div>
<ul>
<li>
<code>all_of()</code> and <code>any_of()</code>: You can also select variables from a character vector using the selection helper functions <code>all_of()</code> and <code>any_of()</code>. The key difference is that <code>all_of()</code> is used for strict selection where an error is thrown for variable names that do not exist. In contrast, <code>any_of()</code> does not check for missing variable names, and thus is often used to ensure a specific column is removed.</li>
</ul>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Heating_NaturalGas_J"</span>, <span class="st">"WaterSystems_NaturalGas_J"</span><span class="op">)</span>
<span class="fu">select</span><span class="op">(</span><span class="va">bldg</span>, <span class="fu">all_of</span><span class="op">(</span><span class="va">vars</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 2</span>
<span class="co">##    Heating_NaturalGas_J WaterSystems_NaturalGas_J</span>
<span class="co">##                   &lt;dbl&gt;                     &lt;dbl&gt;</span>
<span class="co">##  1            13517796.                    72000 </span>
<span class="co">##  2            17717617.                    72000 </span>
<span class="co">##  3            25310615.                  3970732.</span>
<span class="co">##  4            20001989.                    72000 </span>
<span class="co">##  5            27925599.                  3970995.</span>
<span class="co">##  6            21886933.                    72000 </span>
<span class="co">##  7            29745424.                  3970782.</span>
<span class="va">....</span>

<span class="fu">select</span><span class="op">(</span><span class="va">bldg</span>, <span class="op">-</span><span class="fu">any_of</span><span class="op">(</span><span class="va">vars</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 8</span>
<span class="co">##    Date_Time           Cooling_Electrici… Heating_Electrici… InteriorLights_Ele…</span>
<span class="co">##    &lt;dttm&gt;                           &lt;dbl&gt;              &lt;dbl&gt;               &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00                  0         182286476.            9649498.</span>
<span class="co">##  2 2020-01-01 02:00:00                  0         177367416.            9649498.</span>
<span class="co">##  3 2020-01-01 03:00:00                  0         235785509             9649498.</span>
<span class="co">##  4 2020-01-01 04:00:00                  0         184762495.            9649498.</span>
<span class="co">##  5 2020-01-01 05:00:00                  0         245249657.            9649498.</span>
<span class="co">##  6 2020-01-01 06:00:00                  0         190670331.            9649498.</span>
<span class="co">##  7 2020-01-01 07:00:00                  0         252272477.            9649498.</span>
<span class="va">....</span></code></pre></div>
<ul>
<li>
<code>where()</code> is a very useful selection helper function when you want to apply a function (that returns <code>TRUE</code> or <code>FALSE</code>) to all columns and select only those columns where the function returns <code>TRUE</code>.</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">select</span><span class="op">(</span><span class="va">bldg</span>, <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 9</span>
<span class="co">##    Cooling_Electrici… Heating_NaturalGa… Heating_Electrici… InteriorLights_Elec…</span>
<span class="co">##                 &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;                &lt;dbl&gt;</span>
<span class="co">##  1                  0          13517796.         182286476.             9649498.</span>
<span class="co">##  2                  0          17717617.         177367416.             9649498.</span>
<span class="co">##  3                  0          25310615.         235785509              9649498.</span>
<span class="co">##  4                  0          20001989.         184762495.             9649498.</span>
<span class="co">##  5                  0          27925599.         245249657.             9649498.</span>
<span class="co">##  6                  0          21886933.         190670331.             9649498.</span>
<span class="co">##  7                  0          29745424.         252272477.             9649498.</span>
<span class="va">....</span></code></pre></div>
<p>You can also define the function to be applied within <code>where()</code></p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">select</span><span class="op">(</span>
  <span class="va">bldg</span>,
  <span class="fu">where</span><span class="op">(</span>
    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 9</span>
<span class="co">##    Cooling_Electrici… Heating_NaturalGa… Heating_Electrici… InteriorLights_Elec…</span>
<span class="co">##                 &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;                &lt;dbl&gt;</span>
<span class="co">##  1                  0          13517796.         182286476.             9649498.</span>
<span class="co">##  2                  0          17717617.         177367416.             9649498.</span>
<span class="co">##  3                  0          25310615.         235785509              9649498.</span>
<span class="co">##  4                  0          20001989.         184762495.             9649498.</span>
<span class="co">##  5                  0          27925599.         245249657.             9649498.</span>
<span class="co">##  6                  0          21886933.         190670331.             9649498.</span>
<span class="co">##  7                  0          29745424.         252272477.             9649498.</span>
<span class="va">....</span></code></pre></div>
</div>
<div id="filter" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> <code>filter()</code><a class="anchor" aria-label="anchor" href="#filter"><i class="fas fa-link"></i></a>
</h3>
<p>You can use <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> to subset rows based on their values. dplyr’s <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function retains rows that return <code>TRUE</code> for all the conditions specified. The first argument is the data frame and the subsequent arguments are the conditions that are used to subset the observations. In other words, multiple arguments to <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> are combined by the <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> (and) logical operator. To work with other logical operators such as <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> (or) and <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> (not), you would have to combine them within a single argument.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">bldg</span>, <span class="va">Cooling_Electricity_J</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">## # A tibble: 2,678 x 10</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-02-11 15:00:00            4354833.                  0          91807743.</span>
<span class="co">##  2 2020-02-11 16:00:00            2387624.                  0          94118327.</span>
<span class="co">##  3 2020-02-23 09:00:00            7606370.                  0         102607149.</span>
<span class="co">##  4 2020-02-23 10:00:00           21074975.                  0          76304715.</span>
<span class="co">##  5 2020-02-23 11:00:00           23052733.                  0          63182232.</span>
<span class="co">##  6 2020-02-23 12:00:00           23185185.                  0          53130886.</span>
<span class="co">##  7 2020-02-23 13:00:00           20501352.                  0          68037068.</span>
<span class="va">....</span>
<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">bldg</span>, <span class="va">InteriorLights_Electricity_J</span> <span class="op">&gt;</span> <span class="fl">100000000</span><span class="op">)</span>
<span class="co">## # A tibble: 2,520 x 10</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-02 09:00:00                   0         128483630.         473529413.</span>
<span class="co">##  2 2020-01-02 10:00:00                   0         109562756.         398893378.</span>
<span class="co">##  3 2020-01-02 11:00:00                   0          88363562.         350234124.</span>
<span class="co">##  4 2020-01-02 12:00:00                   0          75198754.         305357974 </span>
<span class="co">##  5 2020-01-02 13:00:00                   0          70573992.         300958898.</span>
<span class="co">##  6 2020-01-02 14:00:00                   0          84277786.         249050033.</span>
<span class="co">##  7 2020-01-02 15:00:00                   0          99713290.         238506555.</span>
<span class="va">....</span>

<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span>
  <span class="va">bldg</span>, <span class="va">Cooling_Electricity_J</span> <span class="op">!=</span> <span class="fl">0</span>,
  <span class="va">Cooling_Electricity_J</span> <span class="op">&lt;</span> <span class="fl">4000000</span> <span class="op">|</span>
    <span class="va">Cooling_Electricity_J</span> <span class="op">&gt;</span> <span class="fl">22000000</span>,
<span class="op">)</span>
<span class="co">## # A tibble: 2,428 x 10</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-02-11 16:00:00            2387624.                  0          94118327.</span>
<span class="co">##  2 2020-02-23 11:00:00           23052733.                  0          63182232.</span>
<span class="co">##  3 2020-02-23 12:00:00           23185185.                  0          53130886.</span>
<span class="co">##  4 2020-02-23 20:00:00            1387715.                  0         101207501.</span>
<span class="co">##  5 2020-03-10 12:00:00           25148879.                  0          17802883.</span>
<span class="co">##  6 2020-03-10 13:00:00           31261163.                  0          15048079.</span>
<span class="co">##  7 2020-03-10 14:00:00           30172661.                  0           1791300.</span>
<span class="va">....</span></code></pre></div>
<p>Often, the ability to subset observations based on their timestamp is a very useful feature when working with timeseries data</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">bldg</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/day.html">day</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">## # A tibble: 24 x 10</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00                   0          13517796.         182286476.</span>
<span class="co">##  2 2020-01-01 02:00:00                   0          17717617.         177367416.</span>
<span class="co">##  3 2020-01-01 03:00:00                   0          25310615.         235785509 </span>
<span class="co">##  4 2020-01-01 04:00:00                   0          20001989.         184762495.</span>
<span class="co">##  5 2020-01-01 05:00:00                   0          27925599.         245249657.</span>
<span class="co">##  6 2020-01-01 06:00:00                   0          21886933.         190670331.</span>
<span class="co">##  7 2020-01-01 07:00:00                   0          29745424.         252272477.</span>
<span class="va">....</span>
<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">bldg</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/day.html">day</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">## # A tibble: 287 x 10</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00                   0          13517796.         182286476.</span>
<span class="co">##  2 2020-01-01 02:00:00                   0          17717617.         177367416.</span>
<span class="co">##  3 2020-01-01 03:00:00                   0          25310615.         235785509 </span>
<span class="co">##  4 2020-01-01 04:00:00                   0          20001989.         184762495.</span>
<span class="co">##  5 2020-01-01 05:00:00                   0          27925599.         245249657.</span>
<span class="co">##  6 2020-01-01 06:00:00                   0          21886933.         190670331.</span>
<span class="co">##  7 2020-01-01 07:00:00                   0          29745424.         252272477.</span>
<span class="va">....</span>
<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">bldg</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">4</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span>
<span class="co">## # A tibble: 3,672 x 10</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-05-01 00:00:00                  0                   0                 0 </span>
<span class="co">##  2 2020-05-01 01:00:00                  0                   0                 0 </span>
<span class="co">##  3 2020-05-01 02:00:00                  0                   0                 0 </span>
<span class="co">##  4 2020-05-01 03:00:00                  0                   0                 0 </span>
<span class="co">##  5 2020-05-01 04:00:00                  0                   0                 0 </span>
<span class="co">##  6 2020-05-01 05:00:00                  0                   0                 0 </span>
<span class="co">##  7 2020-05-01 06:00:00                  0                   0         252935532.</span>
<span class="va">....</span>
<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">bldg</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span>
<span class="co">## # A tibble: 3,672 x 10</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-05-01 00:00:00                  0                   0                 0 </span>
<span class="co">##  2 2020-05-01 01:00:00                  0                   0                 0 </span>
<span class="co">##  3 2020-05-01 02:00:00                  0                   0                 0 </span>
<span class="co">##  4 2020-05-01 03:00:00                  0                   0                 0 </span>
<span class="co">##  5 2020-05-01 04:00:00                  0                   0                 0 </span>
<span class="co">##  6 2020-05-01 05:00:00                  0                   0                 0 </span>
<span class="co">##  7 2020-05-01 06:00:00                  0                   0         252935532.</span>
<span class="va">....</span></code></pre></div>
<p>You can also combine <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> with <code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code> to subset rows using regular expressions.</p>
</div>
<div id="arrange" class="section level3" number="7.2.3">
<h3>
<span class="header-section-number">7.2.3</span> <code>arrange()</code><a class="anchor" aria-label="anchor" href="#arrange"><i class="fas fa-link"></i></a>
</h3>
<p>You can use <code>arrange()</code> to sort the dataset based on the values of selected columns. The first argument is the data frame and the second is the column name to sort the data frame by. If more than one column name is provided, subsequent column names will be used to break ties in the preceeding columns.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">arrange</span><span class="op">(</span><span class="va">bldg</span>, <span class="va">Cooling_Electricity_J</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 10</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00                   0          13517796.         182286476.</span>
<span class="co">##  2 2020-01-01 02:00:00                   0          17717617.         177367416.</span>
<span class="co">##  3 2020-01-01 03:00:00                   0          25310615.         235785509 </span>
<span class="co">##  4 2020-01-01 04:00:00                   0          20001989.         184762495.</span>
<span class="co">##  5 2020-01-01 05:00:00                   0          27925599.         245249657.</span>
<span class="co">##  6 2020-01-01 06:00:00                   0          21886933.         190670331.</span>
<span class="co">##  7 2020-01-01 07:00:00                   0          29745424.         252272477.</span>
<span class="va">....</span></code></pre></div>
<p>You can use <code>desc()</code> to order a column in descending order</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">arrange</span><span class="op">(</span><span class="va">bldg</span>, <span class="fu">desc</span><span class="op">(</span><span class="va">Cooling_Electricity_J</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 10</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-07-19 16:00:00          356330907.                  0                  0</span>
<span class="co">##  2 2020-07-19 15:00:00          349038364.                  0                  0</span>
<span class="co">##  3 2020-07-18 16:00:00          339376366.                  0                  0</span>
<span class="co">##  4 2020-07-19 17:00:00          338918865.                  0                  0</span>
<span class="co">##  5 2020-07-17 15:00:00          337245696.                  0                  0</span>
<span class="co">##  6 2020-07-18 14:00:00          336127683.                  0                  0</span>
<span class="co">##  7 2020-07-17 16:00:00          335013419.                  0                  0</span>
<span class="va">....</span></code></pre></div>
</div>
<div id="mutate" class="section level3" number="7.2.4">
<h3>
<span class="header-section-number">7.2.4</span> <code>mutate()</code><a class="anchor" aria-label="anchor" href="#mutate"><i class="fas fa-link"></i></a>
</h3>
<p>You can use <code>mutate()</code> to add new variables whose values are a function of existing variables (Note that you can also refer to newly created variables). The newly created variables will be added to the end of the dataset.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mutate</span><span class="op">(</span><span class="va">bldg</span>,
  Total_Heating_J <span class="op">=</span> <span class="va">Heating_NaturalGas_J</span> <span class="op">+</span> <span class="va">Heating_Electricity_J</span>,
  Cooling_Heating_kWh <span class="op">=</span> <span class="op">(</span><span class="va">Total_Heating_J</span> <span class="op">+</span> <span class="va">Cooling_Electricity_J</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2.77778e-7</span>
<span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 12</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00                   0          13517796.         182286476.</span>
<span class="co">##  2 2020-01-01 02:00:00                   0          17717617.         177367416.</span>
<span class="co">##  3 2020-01-01 03:00:00                   0          25310615.         235785509 </span>
<span class="co">##  4 2020-01-01 04:00:00                   0          20001989.         184762495.</span>
<span class="co">##  5 2020-01-01 05:00:00                   0          27925599.         245249657.</span>
<span class="co">##  6 2020-01-01 06:00:00                   0          21886933.         190670331.</span>
<span class="co">##  7 2020-01-01 07:00:00                   0          29745424.         252272477.</span>
<span class="va">....</span></code></pre></div>
<p>You can use <code>transmute()</code> if you only want to keep the new variables in your dataset.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">transmute</span><span class="op">(</span><span class="va">bldg</span>,
  Total_Heating_J <span class="op">=</span> <span class="va">Heating_NaturalGas_J</span> <span class="op">+</span> <span class="va">Heating_Electricity_J</span>,
  Cooling_Heating_kWh <span class="op">=</span> <span class="op">(</span><span class="va">Total_Heating_J</span> <span class="op">+</span> <span class="va">Cooling_Electricity_J</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2.77778e-7</span>
<span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 2</span>
<span class="co">##    Total_Heating_J Cooling_Heating_kWh</span>
<span class="co">##              &lt;dbl&gt;               &lt;dbl&gt;</span>
<span class="co">##  1      195804272.                54.4</span>
<span class="co">##  2      195085034.                54.2</span>
<span class="co">##  3      261096124.                72.5</span>
<span class="co">##  4      204764484.                56.9</span>
<span class="co">##  5      273175257.                75.9</span>
<span class="co">##  6      212557265.                59.0</span>
<span class="co">##  7      282017901.                78.3</span>
<span class="va">....</span></code></pre></div>
<p>Useful mutate functions include
- Arithmetic operators (<code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>, *<code>,</code>/<code>, etc.) and logarithms (</code>log()<code>,</code>log2()<code>, etc.) -</code>lead()<code>and</code>lag()<code>, allowing you to create lead and lag variables that are useful especially when working with timeseries data. -</code>if_else()<code>and</code>case_when()`</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">heat</span> <span class="op">&lt;-</span> <span class="fu">transmute</span><span class="op">(</span><span class="va">bldg</span>,
  Total_Heating_J <span class="op">=</span> <span class="va">Heating_NaturalGas_J</span> <span class="op">+</span> <span class="va">Heating_Electricity_J</span>
<span class="op">)</span>

<span class="fu">mutate</span><span class="op">(</span>
  <span class="va">heat</span>,
  lag_1 <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/shift.html">lag</a></span><span class="op">(</span><span class="va">Total_Heating_J</span><span class="op">)</span>,
  lag_2 <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/shift.html">lag</a></span><span class="op">(</span><span class="va">lag_1</span><span class="op">)</span>,
  lag_3 <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/shift.html">lag</a></span><span class="op">(</span><span class="va">Total_Heating_J</span>, <span class="fl">3</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 4</span>
<span class="co">##    Total_Heating_J      lag_1      lag_2      lag_3</span>
<span class="co">##              &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">##  1      195804272.        NA         NA         NA </span>
<span class="co">##  2      195085034. 195804272.        NA         NA </span>
<span class="co">##  3      261096124. 195085034. 195804272.        NA </span>
<span class="co">##  4      204764484. 261096124. 195085034. 195804272.</span>
<span class="co">##  5      273175257. 204764484. 261096124. 195085034.</span>
<span class="co">##  6      212557265. 273175257. 204764484. 261096124.</span>
<span class="co">##  7      282017901. 212557265. 273175257. 204764484.</span>
<span class="va">....</span></code></pre></div>
<p>TODO: Example of use of <code>if_else()</code> and <code>case_when()</code> in <code>mutate()</code> pipe</p>
</div>
<div id="summarise-and-group_by" class="section level3" number="7.2.5">
<h3>
<span class="header-section-number">7.2.5</span> <code>summarise()</code> and <code>group_by()</code><a class="anchor" aria-label="anchor" href="#summarise-and-group_by"><i class="fas fa-link"></i></a>
</h3>
<p><code>summarise()</code> or <code>summarize()</code> collapse a data frame into one row for each combination of grouping variables. Therefore, it is not very useful by itself.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">summarise</span><span class="op">(</span><span class="va">bldg</span>,
  Heating_Total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Heating_Electricity_J</span><span class="op">)</span>,
  Heating_Avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Heating_Electricity_J</span><span class="op">)</span>,
  Heating_Peak <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Heating_Electricity_J</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">## # A tibble: 1 x 3</span>
<span class="co">##   Heating_Total Heating_Avg Heating_Peak</span>
<span class="co">##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;</span>
<span class="co">## 1 508713824519.   58072354.   1002989103</span></code></pre></div>
<p>However, <code>summarise()</code> combined with <code>group_by()</code> will allow you to easily summarise data based on individual groups.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bldg_month</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">bldg</span>,
  Year <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span>,
  Month <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">bldg_by_month</span> <span class="op">&lt;-</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">bldg_month</span>, <span class="va">Year</span>, <span class="va">Month</span><span class="op">)</span>

<span class="fu">summarise</span><span class="op">(</span><span class="va">bldg_by_month</span>,
  Heating_Total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Heating_Electricity_J</span><span class="op">)</span>,
  Heating_Avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Heating_Electricity_J</span><span class="op">)</span>,
  Heating_Peak <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Heating_Electricity_J</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">## `summarise()` has grouped output by 'Year'. You can override using the `.groups` argument.</span>
<span class="co">## # A tibble: 13 x 5</span>
<span class="co">## # Groups:   Year [2]</span>
<span class="co">##     Year Month Heating_Total Heating_Avg Heating_Peak</span>
<span class="co">##    &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;</span>
<span class="co">##  1  2020     1 124527837066.  167601396.   978585992.</span>
<span class="co">##  2  2020     2  89836688374.  133486907.  1002989103 </span>
<span class="co">##  3  2020     3  55674915533.   74932592.   795581602.</span>
<span class="co">##  4  2020     4  32036849861.   44495625.   639342141.</span>
<span class="co">##  5  2020     5   7726081874.   10384519.   252935532.</span>
<span class="co">##  6  2020     6    624415414.     867244.    39920827.</span>
<span class="va">....</span></code></pre></div>
</div>
<div id="across" class="section level3" number="7.2.6">
<h3>
<span class="header-section-number">7.2.6</span> <code>across()</code><a class="anchor" aria-label="anchor" href="#across"><i class="fas fa-link"></i></a>
</h3>
<p><code>across()</code> makes it possible to apply functions across multiple columns within the functions <code>summarise()</code> and <code>mutate()</code>, using the semantics in <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> (see section <a href="manipulate.html#select">7.2.1</a>) that makes it easy to refer to columns based on their names.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">mutate</span><span class="op">(</span><span class="va">bldg</span>,
  total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">## # A tibble: 8,760 x 11</span>
<span class="co">##    Date_Time           Cooling_Electricit… Heating_NaturalGa… Heating_Electrici…</span>
<span class="co">##    &lt;dttm&gt;                            &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span>
<span class="co">##  1 2020-01-01 01:00:00                   0          13517796.         182286476.</span>
<span class="co">##  2 2020-01-01 02:00:00                   0          17717617.         177367416.</span>
<span class="co">##  3 2020-01-01 03:00:00                   0          25310615.         235785509 </span>
<span class="co">##  4 2020-01-01 04:00:00                   0          20001989.         184762495.</span>
<span class="co">##  5 2020-01-01 05:00:00                   0          27925599.         245249657.</span>
<span class="co">##  6 2020-01-01 06:00:00                   0          21886933.         190670331.</span>
<span class="co">##  7 2020-01-01 07:00:00                   0          29745424.         252272477.</span>
<span class="va">....</span></code></pre></div>
<p>You may also pass a list of functions to be applied to each of the selected columns.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">summarise</span><span class="op">(</span>
  <span class="va">bldg_by_month</span>,
  <span class="fu">across</span><span class="op">(</span>
    <span class="fu">contains</span><span class="op">(</span><span class="st">"electricity"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Total <span class="op">=</span> <span class="va">sum</span>, Avg <span class="op">=</span> <span class="va">mean</span>, Peak <span class="op">=</span> <span class="va">max</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">## `summarise()` has grouped output by 'Year'. You can override using the `.groups` argument.</span>
<span class="co">## # A tibble: 13 x 23</span>
<span class="co">## # Groups:   Year [2]</span>
<span class="co">##     Year Month Cooling_Electricity_J… Cooling_Electricity… Cooling_Electricity_…</span>
<span class="co">##    &lt;dbl&gt; &lt;dbl&gt;                  &lt;dbl&gt;                &lt;dbl&gt;                 &lt;dbl&gt;</span>
<span class="co">##  1  2020     1                     0                    0                     0 </span>
<span class="co">##  2  2020     2             181014017.              268966.             23185185.</span>
<span class="co">##  3  2020     3             775169988.             1043297.             79053134.</span>
<span class="co">##  4  2020     4           11551697867.            16044025.            226399417.</span>
<span class="co">##  5  2020     5           22952133253.            30849641.            191404162.</span>
<span class="co">##  6  2020     6           53405646191.            74174509.            302585966 </span>
<span class="va">....</span></code></pre></div>
</div>
</div>
<div id="pipes" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Pipes<a class="anchor" aria-label="anchor" href="#pipes"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>%&gt;%</code> is a forward pipe operator from the <code>magrittr</code> package that comes loaded with the <code>tidyverse</code> package. The pipe operator <code>%&gt;%</code> is a very handy that allows operations to be performed sequentially. In general, you can think of it as sending the output of one function as an input to the next .</p>
<p>With the pipe operator,</p>
<p>Instead of many intermediary steps</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">first_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/last.html">first</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
<span class="va">second_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/second.html">second</a></span><span class="op">(</span><span class="va">first_output</span><span class="op">)</span>
<span class="va">final_result</span> <span class="op">&lt;-</span> <span class="fu">third</span><span class="op">(</span><span class="va">second_output</span><span class="op">)</span></code></pre></div>
<p>You can connect multiple operators sequentially using the pipe operator</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">final_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/last.html">first</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="http://lubridate.tidyverse.org/reference/second.html">second</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">third</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Figure <a href="manipulate.html#fig:pipe">7.1</a> shows what is happening graphically.</p>
<div class="figure" style="text-align: center">
<span id="fig:pipe"></span>
<img src="figures/pipe.png" alt="Piping data from one function to the next sequentially" width="70%"><p class="caption">
Figure 7.1: Piping data from one function to the next sequentially
</p>
</div>
<p>An example using the <code>bldg</code> dataset.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">bldg</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">Date_Time</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"Heating"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    Month <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">Date_Time</span><span class="op">)</span>,
    Total_Heating_J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">Month</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>
    <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Total <span class="op">=</span> <span class="va">sum</span>, Peak <span class="op">=</span> <span class="va">max</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 12 x 7</span>
<span class="co">##    Month Heating_NaturalG… Heating_NaturalG… Heating_Electric… Heating_Electric…</span>
<span class="co">##    &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;</span>
<span class="co">##  1     1      59660445562.        527825997.     124648935250.        978585992.</span>
<span class="co">##  2     2      41029360544.        530570172.      89836688374.       1002989103 </span>
<span class="co">##  3     3       9377325423.        230991815.      55674915533.        795581602.</span>
<span class="co">##  4     4       3352997015.        156525821       32036849861.        639342141.</span>
<span class="co">##  5     5          2144014.          2144014.       7726081874.        252935532.</span>
<span class="co">##  6     6                0                 0         624415414.         39920827.</span>
<span class="co">##  7     7                0                 0         128302310.         16757642 </span>
<span class="va">....</span></code></pre></div>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="functions.html"><span class="header-section-number">6</span> Functions</a></div>
<div class="next"><a href="get-started.html"><span class="header-section-number">8</span> Introduction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#manipulate"><span class="header-section-number">7</span> Manipulating Data</a></li>
<li><a class="nav-link" href="#prerequisites-6"><span class="header-section-number">7.1</span> Prerequisites</a></li>
<li>
<a class="nav-link" href="#data-transformation"><span class="header-section-number">7.2</span> Data transformation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#select"><span class="header-section-number">7.2.1</span> select()</a></li>
<li><a class="nav-link" href="#filter"><span class="header-section-number">7.2.2</span> filter()</a></li>
<li><a class="nav-link" href="#arrange"><span class="header-section-number">7.2.3</span> arrange()</a></li>
<li><a class="nav-link" href="#mutate"><span class="header-section-number">7.2.4</span> mutate()</a></li>
<li><a class="nav-link" href="#summarise-and-group_by"><span class="header-section-number">7.2.5</span> summarise() and group_by()</a></li>
<li><a class="nav-link" href="#across"><span class="header-section-number">7.2.6</span> across()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#pipes"><span class="header-section-number">7.3</span> Pipes</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Building Energy Simulation</strong>" was written by Adrian Chong. It was last built on 2021-08-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>

% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={R for Building Energy Simulation},
  pdfauthor={Adrian Chong},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{plainnat}

\title{R for Building Energy Simulation}
\author{Adrian Chong}
\date{2021-08-21}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}
\addcontentsline{toc}{chapter}{Preface}

\hypertarget{introduction}{%
\section*{Introduction}\label{introduction}}
\addcontentsline{toc}{section}{Introduction}

This is the book for the module \textbf{PF4213--Building Energy Analysis and Simulation} at the Department of the Built Environment, National University of Singapore. This book will introduce you to building energy simulation and how to perform data analytics with energy models using R. You will learn how to get your model into R, simulate it, transform the inputs and outputs, and visualize and explore them. This book is designed to be interactive and for you to \textbf{learn by doing}. It is highly recommended that you do not copy and paste all the code in this book but instead type them out. Copying and pasting snippets of code isn't the best way to learn because more often than not you are just reading the code at an abstract level without understanding what it does. In contrast, typing the code forces you to try to understand what the code is doing.

The online version of this book is free to use, and is licensed under the \href{https://creativecommons.org/licenses/by-nc-sa/4.0/}{Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License}.

\emph{Note that this book is still work in progress and some chapters in the book are currently just placeholders that will be completed over time.}

\hypertarget{structure-of-this-book}{%
\section*{Structure of this book}\label{structure-of-this-book}}
\addcontentsline{toc}{section}{Structure of this book}

The book is divided into six parts. The code in each chapter is self-containing. Each chapter will contain all the packages and objects needed to run the code and objects created in previous chapters need not be carried over for them to work.

\protect\hyperlink{r-basics}{Part I} introduces R's basic syntax, which should be sufficient to get most readers started on the subsequent parts of the book. \protect\hyperlink{get-started}{Part II} introduces the basic usage and will show you how to get your EnergyPlus model into R, run the simulation, extract the predefined reports and visuaize them. \protect\hyperlink{input-output}{Part III} provide details on extracting and modifying various model inputs/outputs, and provide examples of data exploration that can be applied to the model inputs/outputs. \protect\hyperlink{program}{Part IV} shows how to programmatically define energy efficient measures using functions and demonstrates the process of performing parametric simulation and it's analysis. \protect\hyperlink{advanced}{Part V} shows example application of advanced techniques such as sensitivity analysis, optimization, and Bayesian calibration to building energy simulation. \protect\hyperlink{reproduce}{Part VI} introduces workflows and tools for reproducing building energy simulation using R.

\hypertarget{prerequisites}{%
\section*{Prerequisites}\label{prerequisites}}
\addcontentsline{toc}{section}{Prerequisites}

This book assumes some theoretical knowledge of building physics and building energy simulation. Some programming experience is preferred but not necessary. To run the code in this book, you will need to install \textbf{EnergyPlus}, \textbf{R}, \textbf{RStudio}, and a handful of R packages that we will introduce as we go along in this book.

\hypertarget{r-and-rstudio}{%
\subsection*{R and RStudio}\label{r-and-rstudio}}
\addcontentsline{toc}{subsection}{R and RStudio}

To download and install the most recent version of R, I would recommend the precompiled binary distribution of the base system and contributed packages that you will find at the top of R's project webpage at \url{https://cloud.r-project.org}. R Studio is an Integrated Development Environment (IDE) for R.

R Studio increases your productivity when working with the R programming language by combining different features such as syntax highlighting and auto-completion into a single application. You can download and install RStudio from \url{https://www.rstudio.com/products/rstudio/download}.

Once you have downloaded and installed RStudio, you will see a similar window to that shown in image below that comprises of:

\begin{itemize}
\item
  Console window: This is the window where you type in R code, press enter, and the results are returned.
\item
  Workspace window: The \emph{Environment} tab in this window is where all the objects that you have created will show.
\item
  Results window: This window is typically used for visualizing graphs (\emph{Plots} tab) and for getting help by accessing the documentation pages for R (\emph{Help} tab).
\end{itemize}

\begin{center}\includegraphics[width=1\linewidth]{figures/rstudio_console} \end{center}

\hypertarget{r-packages}{%
\subsection*{R Packages}\label{r-packages}}
\addcontentsline{toc}{subsection}{R Packages}

R has thousands of packages hosted on the \textbf{C}omprehensive \textbf{R} \textbf{A}rchieve \textbf{N}etwork (CRAN). These packages contains functions developed and shared by the community. In this book we will be using several R packages. The main packages include the \textbf{tidyverse} and \textbf{eplusr} package. We will introduce the other packages used in this book as we go along.

To install any R package, open R Studio and type

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"\textless{}package name\textgreater{}"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

For example, to install the tidyverse package

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note that you will not be able to use the R package until you load it into your environment using the \texttt{library()} function. To load both the tidyverse package, type

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(}\StringTok{"eplusr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{energyplus}{%
\subsection*{EnergyPlus}\label{energyplus}}
\addcontentsline{toc}{subsection}{EnergyPlus}

EnergyPlus is an open-source whole-building energy simulation engine that is widely used by the research community and industry practitioners. EnergyPlus is also the simulation engine supporting many energy simulation applications \citep{noauthor_best_nodate}, and it has been and continues to be supported by the U.S. Department of Energy (DOE) \citep{noauthor_energyplus_nodate}.

Different releases of EnergyPlus for different platforms (Windows, Linus, or Mac) can be downloaded from \url{https://energyplus.net/downloads}. In this book, we will be using EnergyPlus version 9.4.0.

You can also install EnergyPlus via RStudio using the eplusr package. First, install eplusr

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"eplusr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then load the library onto RStudio

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(eplusr)}
\end{Highlighting}
\end{Shaded}

You can then install EnergyPlus version 9.4.0 by typing

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install\_eplus}\NormalTok{(}\AttributeTok{ver =} \FloatTok{9.4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{conventions}{%
\section*{Conventions}\label{conventions}}
\addcontentsline{toc}{section}{Conventions}

In this book, code that you can type and run directly in R will appear within grey boxes \texttt{like\ this} or in the form of code blocks like this:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \SpecialCharTok{+} \DecValTok{1}
\DocumentationTok{\#\# [1] 2}
\end{Highlighting}
\end{Shaded}

When presenting R code, prompts \texttt{\textgreater{}} will not be added and the output from running the code will be commented out with \texttt{\#\#} as shown in the example above. This is for your convenience so that it is easy to type or copy the code so that you can run it yourself.

\hypertarget{before-you-begin}{%
\section*{Before you begin}\label{before-you-begin}}
\addcontentsline{toc}{section}{Before you begin}

\hypertarget{r-project}{%
\subsection*{R Project}\label{r-project}}
\addcontentsline{toc}{subsection}{R Project}

The Figure below shows the steps to create a project called \texttt{r4bes} that you will be using for this book. To create a project, select \texttt{File\ \textgreater{}\ New\ Project} from RStudio's menu bar. This launches a window that provides you with options for creating a project. Select the \texttt{New\ Directory} option followed by \texttt{New\ Project}. You can then specify the \texttt{Directory\ name} for your new project and the directory where it will reside. Notice the file with \texttt{.Rproj} extension that was created along with the project. This is the project file that you double-click to open a project. When you open a project, the current working directory is automatically set to the project directory.

\begin{center}\includegraphics[width=1\linewidth]{figures/create_project} \end{center}

Try it now! Quite RStuido and then navigate to and open the \texttt{r4bes.Rproj} file.

\hypertarget{scripting}{%
\subsection*{Scripting}\label{scripting}}
\addcontentsline{toc}{subsection}{Scripting}

Once the project folder is set up, you can create a new R Script with \texttt{File\ \textgreater{}\ New\ File\ \textgreater{}\ R\ Script}. An R Script is basically a text file with a \texttt{.R} extension that allows you to keep track and save your \texttt{R} code.

\begin{center}\includegraphics[width=1\linewidth]{figures/script} \end{center}

\hypertarget{example-files}{%
\subsection*{Example files}\label{example-files}}
\addcontentsline{toc}{subsection}{Example files}

To ensure the reproducibility of the examples in this book, you will download the data folder from \href{https://nusu.sharepoint.com/sites/RforBuildingEnergySimulation/Shared\%20Documents/General/data.zip}{this link} and place it in the project folder you have just created.

Your project folder should now have the following file structure.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{.}\SpecialCharTok{/}\NormalTok{r4bes}\SpecialCharTok{/}
  \SpecialCharTok{+{-}{-}}\NormalTok{ r4bes.Rproj}
  \SpecialCharTok{+{-}{-}}\NormalTok{ data}\SpecialCharTok{/}
      \SpecialCharTok{+{-}{-}}\NormalTok{ building\_meter.csv}
      \SpecialCharTok{+{-}{-}}\NormalTok{ building.csv}
      \SpecialCharTok{+{-}{-}}\NormalTok{ epw}
          \SpecialCharTok{+{-}{-}}\NormalTok{ USA\_IL\_Chicago}\SpecialCharTok{{-}}\NormalTok{OHare.Intl.AP}\FloatTok{.725300}\NormalTok{\_TMY3.epw}
      \SpecialCharTok{+{-}{-}}\NormalTok{ idf}
          \SpecialCharTok{+{-}{-}}\NormalTok{ RefBldgMediumOfficeNew2004\_Chicago.idf}
      \SpecialCharTok{+{-}{-}}\NormalTok{ iris.csv}
\end{Highlighting}
\end{Shaded}

\texttt{building\_meter.csv} is an example energy meter output file from the the U.S. DOE medium office energy model (i.e., \texttt{RefBldgMediumOfficeNew2004\_Chicago.idf}). The dataset has a temporal resolution of 1 hour and comprises of 10 variables (the Date/Time and 9 other energy meters) and 8760 observations.

\texttt{building.csv} is a timeseries dataset from an actual building consisting of 1324 observations and 2 variables (date/time and building electricity consumption). The dataset has a temporal resolution of 30 minutes.

\texttt{USA\_IL\_Chicago-OHare.Intl.AP.725300\_TMY3.epw} is the latest Typical Meteorological Year weather dataset for the Chicago Ohare International Airport.

\texttt{RefBldgMediumOfficeNew2004\_Chicago.idf} is a building energy model developed by the U.S. Department of Energy (DOE) to act as a Commercial Reference Building for medium offices \citep{deru_us_2011}. We use the DOE reference building because it is well established and widely used. More importantly, it is publicly available and comes distributed with EnergyPlus as example files, making the examples and code in this book easier to follow and reproduce.

\texttt{iris.csv} is a popular machine learning dataset about the Iris flower. The dataset consists of 50 observations and 5 variables.

Once you have downloaded the \texttt{data} folder into your R project directure, the following code should all return \texttt{TRUE}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(}\StringTok{"here"}\NormalTok{)}
\DocumentationTok{\#\# here() starts at /Users/adrianchong/Documents/GitHub/r4bes}

\FunctionTok{file.exists}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"iris.csv"}\NormalTok{))}
\DocumentationTok{\#\# [1] TRUE}
\FunctionTok{file.exists}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"building.csv"}\NormalTok{))}
\DocumentationTok{\#\# [1] TRUE}
\FunctionTok{file.exists}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"building\_meter.csv"}\NormalTok{))}
\DocumentationTok{\#\# [1] TRUE}
\FunctionTok{file.exists}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"idf"}\NormalTok{, }\StringTok{"RefBldgMediumOfficeNew2004\_Chicago.idf"}\NormalTok{))}
\DocumentationTok{\#\# [1] TRUE}
\FunctionTok{file.exists}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"epw"}\NormalTok{, }\StringTok{"USA\_IL\_Chicago{-}OHare.Intl.AP.725300\_TMY3.epw"}\NormalTok{))}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

\hypertarget{project-structure}{%
\subsection*{Project structure}\label{project-structure}}
\addcontentsline{toc}{subsection}{Project structure}

You should also create a new folder called \texttt{R} in the newly created R project. This folder will be used to house all \texttt{R} code that you will write as you go through this book. You can create a new folder in RStudio by navigating to the RStudio's results window, select the \texttt{Files} tab and click on \texttt{New\ Folder} and enter \texttt{R}.

Your project folder should now look like this.

\begin{center}\includegraphics[width=0.3\linewidth]{figures/file_structure} \end{center}

\hypertarget{style-guide}{%
\subsection*{Style guide}\label{style-guide}}
\addcontentsline{toc}{subsection}{Style guide}

We recommend using the \href{https://style.tidyverse.org/index.html}{Tidyverse Style Guide} by Hadley Wickham. To summarize we recommend the following

\begin{itemize}
\tightlist
\item
  R File names should be meaningful and end in \texttt{.R}. Avoid using special characters when naming files and use only \texttt{lowercase}, hyphens \texttt{-}, and underscores \texttt{\_}.
\item
  \texttt{snake\_case} (only lowercase letters, numbers, and \texttt{\_}) for all object and function names. Function names should also reflect what it does.
\item
  Use two white spaces when indenting your code
\end{itemize}

\begin{center}\includegraphics[width=0.7\linewidth]{figures/indent_space} \end{center}

\begin{itemize}
\tightlist
\item
  Line length should not exceed 80 characters
\end{itemize}

\begin{center}\includegraphics[width=0.7\linewidth]{figures/line_length} \end{center}

\hypertarget{part-r-basics}{%
\part{R Basics}\label{part-r-basics}}

\hypertarget{r-basics}{%
\chapter{Introduction}\label{r-basics}}

This part of the book is intended to provide a sufficient introduction to R to get you started on the subsequent parts of this book. For a more comprehensive treatment on the subject, I would recommend \href{https://r4ds.had.co.nz/index.html}{R for Data Science} by Hadley Wickham \& Garrett Grolemund \citep{wickham_r_2016}. The \href{https://r-graphics.org}{R Graphics Cookbook} by Winston Chang \citep{chang_r_2018} is also a useful reference that provides recipes that allows you to quickly generate plots in R using the ggplot2 package.

\hypertarget{basics}{%
\chapter{Basics}\label{basics}}

\hypertarget{prerequisites-1}{%
\section{Prerequisites}\label{prerequisites-1}}

We introduce the basics in R programming in this chapter. We will review the basic operators and data types in this chapter. We also provide an introduction to the basic R data structures (including tibbles and data tables).

Most of this chapter involves working with R basic operators and data types, which do not require any extra packages. We will also introduce the \textbf{tibble} package, which forms part of the tidyverse package in section \ref{tibbles}, and the \textbf{data.table} package in section \ref{data-table}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(data.table)}
\end{Highlighting}
\end{Shaded}

\hypertarget{basic-operators}{%
\section{Basic operators}\label{basic-operators}}

Basic arithmetic operators (\texttt{+}, \texttt{-}, \texttt{*}, \texttt{/}, \texttt{\^{}}, `\%') would work like your calculator

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{3} \SpecialCharTok{+} \DecValTok{2} \CommentTok{\# addition}
\DocumentationTok{\#\# [1] 5}
\DecValTok{3} \SpecialCharTok{{-}} \DecValTok{2} \CommentTok{\# subtraction}
\DocumentationTok{\#\# [1] 1}
\DecValTok{3} \SpecialCharTok{*} \DecValTok{2} \CommentTok{\# multiplication}
\DocumentationTok{\#\# [1] 6}
\DecValTok{3} \SpecialCharTok{/} \DecValTok{2} \CommentTok{\# division}
\DocumentationTok{\#\# [1] 1.5}
\DecValTok{3}\SpecialCharTok{\^{}}\DecValTok{2} \CommentTok{\# exponent}
\DocumentationTok{\#\# [1] 9}
\DecValTok{3} \SpecialCharTok{\%/\%} \DecValTok{2} \CommentTok{\# integer division}
\DocumentationTok{\#\# [1] 1}
\DecValTok{3} \SpecialCharTok{\%\%} \DecValTok{2} \CommentTok{\# mod (remainder of a division)}
\DocumentationTok{\#\# [1] 1}
\end{Highlighting}
\end{Shaded}

R uses the \texttt{\textless{}-} operator for assignments. You can read the following code as assigning the outcome of \texttt{2\ +\ 3}, \texttt{5}, and \texttt{3} to the object \texttt{value\_a},\texttt{value\_b}, and \texttt{value\_c} respectively, which stores it for later use.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{value\_a }\OtherTok{\textless{}{-}} \DecValTok{2} \SpecialCharTok{+} \DecValTok{3}
\NormalTok{value\_b }\OtherTok{\textless{}{-}} \DecValTok{5}
\NormalTok{value\_c }\OtherTok{\textless{}{-}} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

You can \texttt{print} what is stored in the object to console with

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(value\_a)}
\DocumentationTok{\#\# [1] 5}
\end{Highlighting}
\end{Shaded}

You can use relational operators to compare how one object relates to another.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{==} \DecValTok{5} \CommentTok{\# TRUE that 2 + 3 equals 5}
\DocumentationTok{\#\# [1] TRUE}
\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{!=} \DecValTok{5} \CommentTok{\# FALSE that 2 + 3 not equals to 5}
\DocumentationTok{\#\# [1] FALSE}
\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{\textless{}} \DecValTok{3} \CommentTok{\# FASLE that 2 + 3 is less than 3}
\DocumentationTok{\#\# [1] FALSE}
\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{3} \CommentTok{\# TRUE that 2 + 3 is more than 3}
\DocumentationTok{\#\# [1] TRUE}
\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{\textless{}=} \DecValTok{5} \CommentTok{\# TRUE that 2 + 3 is less than or equal to 5}
\DocumentationTok{\#\# [1] TRUE}
\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{\textgreater{}=} \DecValTok{5} \CommentTok{\# TRUE that 2 + 3 is more than or equal to 5}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

You can use logical operators to connect two or more expressions. For example, to connect the results of the comparisons made using relational operators.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{==} \DecValTok{5}\NormalTok{) }\SpecialCharTok{\&\&}\NormalTok{ (}\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{\textless{}} \DecValTok{3}\NormalTok{) }\CommentTok{\# logical AND operator}
\DocumentationTok{\#\# [1] FALSE}
\NormalTok{(}\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{==} \DecValTok{5}\NormalTok{) }\SpecialCharTok{||}\NormalTok{ (}\DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{\textgreater{}=} \DecValTok{3}\NormalTok{) }\CommentTok{\# logical OR operator}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

Note that the logical \texttt{\&\&} and \texttt{\textbar{}\textbar{}} only examines the first element of a vector.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)}
\NormalTok{x }\SpecialCharTok{\&\&}\NormalTok{ y}
\DocumentationTok{\#\# [1] FALSE}
\NormalTok{x }\SpecialCharTok{||}\NormalTok{ y}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

To perform element-wise logical operations, use \texttt{\&} and \texttt{\textbar{}} instead

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{\&}\NormalTok{ y}
\DocumentationTok{\#\# [1] FALSE  TRUE FALSE}
\NormalTok{x }\SpecialCharTok{|}\NormalTok{ y}
\DocumentationTok{\#\# [1]  TRUE  TRUE FALSE}
\SpecialCharTok{!}\NormalTok{y}
\DocumentationTok{\#\# [1]  TRUE FALSE  TRUE}
\end{Highlighting}
\end{Shaded}

\hypertarget{basic-data-types}{%
\section{Basic data types}\label{basic-data-types}}

There are basic data types (also known as atomic data types) in R in order to use them.

\begin{longtable}[]{@{}lll@{}}
\toprule
Data Type & Examples & Additional Information \\
\midrule
\endhead
Logical & \texttt{TRUE}, \texttt{FALSE} & Boolean values \\
Numeric & \texttt{1}, \texttt{999.9} & Default data type for numbers \\
Integer & \texttt{1L}, \texttt{999L} & \texttt{L} is used to denote an integer \\
Character & \texttt{"a"}, \texttt{"R\ for\ BES"} & Data type for one or more characters \\
Complex & \texttt{2\ +\ 3i} & Data type for numbers with a real and imaginary component \\
Raw & \texttt{charToRaw("R\ for\ BES")} & Not commonly used data type used to store raw bytes \\
\bottomrule
\end{longtable}

\hypertarget{basic-data-structures}{%
\section{Basic data structures}\label{basic-data-structures}}

The basic data structures in R include factors, atomic vectors, lists, matrices, and \texttt{data.frame}s

Factors are used in R to represent categorical variables. Although they appear similar to character vectors they are actually stored as integers. You can use the function \texttt{levels()} to output the categorical variables and \texttt{nlevels()} to check the number of categorical variables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eye\_color }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"brown"}\NormalTok{, }\StringTok{"black"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"brown"}\NormalTok{, }\StringTok{"black"}\NormalTok{, }\StringTok{"blue"}\NormalTok{))}
\FunctionTok{nlevels}\NormalTok{(eye\_color)}
\DocumentationTok{\#\# [1] 4}
\FunctionTok{levels}\NormalTok{(eye\_color)}
\DocumentationTok{\#\# [1] "black" "blue"  "brown" "green"}
\end{Highlighting}
\end{Shaded}

Atomic vectors or more frequently referred to as vectors are a data structure that is used to store multiple objects of the same data type (logical, numeric, integer, character, complex, or raw). Vectors are one-indexed (i.e., the first element is indexed using \texttt{{[}1{]}}) and you can get the number of elements in the vector using the function \texttt{length()}. The function \texttt{class()} can be used to reveal the class of any object in R.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vec\_num }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\FunctionTok{class}\NormalTok{(vec\_num)}
\DocumentationTok{\#\# [1] "numeric"}

\NormalTok{vec\_char }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"R"}\NormalTok{, }\StringTok{"for"}\NormalTok{, }\StringTok{"BES"}\NormalTok{)}
\FunctionTok{class}\NormalTok{(vec\_char)}
\DocumentationTok{\#\# [1] "character"}

\CommentTok{\# coercion if data types are mixed}
\NormalTok{vec\_mix }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"R"}\NormalTok{, }\DecValTok{4}\NormalTok{, }\StringTok{"BES"}\NormalTok{)}
\FunctionTok{class}\NormalTok{(vec\_mix)}
\DocumentationTok{\#\# [1] "character"}

\CommentTok{\# you can easily combine vectors using the c function}
\FunctionTok{c}\NormalTok{(vec\_char, vec\_mix)}
\DocumentationTok{\#\# [1] "R"   "for" "BES" "R"   "4"   "BES"}

\CommentTok{\# vector length}
\FunctionTok{length}\NormalTok{(vec\_num)}
\DocumentationTok{\#\# [1] 4}

\CommentTok{\# access first element of vector}
\NormalTok{vec\_num[}\DecValTok{1}\NormalTok{]}
\DocumentationTok{\#\# [1] 1}
\end{Highlighting}
\end{Shaded}

Lists are an ordered data structure that is used to store multiple R objects of different types. The function \texttt{list()} is used to create a list and a list in R can be accessed using a single \texttt{{[}{]}} or double brackets \texttt{{[}{[}{]}{]}}. Using \texttt{{[}{]}} returns a list of the selected element while using \texttt{{[}{[}{]}{]}} returns the selected element. Using the function \texttt{length()}, you can obtain the number of objects in a list.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_list }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{),}
  \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{),}
\NormalTok{  1L,}
  \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{)}
\NormalTok{)}

\NormalTok{my\_list\_a }\OtherTok{\textless{}{-}}\NormalTok{ my\_list[}\DecValTok{1}\NormalTok{]}
\FunctionTok{class}\NormalTok{(my\_list\_a)}
\DocumentationTok{\#\# [1] "list"}

\NormalTok{my\_list\_b }\OtherTok{\textless{}{-}}\NormalTok{ my\_list[[}\DecValTok{1}\NormalTok{]]}
\FunctionTok{class}\NormalTok{(my\_list\_b)}
\DocumentationTok{\#\# [1] "numeric"}

\FunctionTok{length}\NormalTok{(my\_list)}
\DocumentationTok{\#\# [1] 4}
\end{Highlighting}
\end{Shaded}

If you have named the elements in your list, you could also access them by specifying their names in the brackets or using the \texttt{\$} operator.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{named\_list }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{a =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{),}
  \AttributeTok{b =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{),}
  \AttributeTok{c =}\NormalTok{ 1L,}
  \AttributeTok{d =} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{)}
\NormalTok{)}

\FunctionTok{class}\NormalTok{(named\_list[}\StringTok{"a"}\NormalTok{])}
\DocumentationTok{\#\# [1] "list"}

\FunctionTok{class}\NormalTok{(named\_list[[}\StringTok{"a"}\NormalTok{]])}
\DocumentationTok{\#\# [1] "numeric"}

\FunctionTok{class}\NormalTok{(named\_list}\SpecialCharTok{$}\NormalTok{a)}
\DocumentationTok{\#\# [1] "numeric"}
\end{Highlighting}
\end{Shaded}

A matrix is a two dimensional data structure that is used to store multiple objects. You can use the function \texttt{matrix()} to create a matrix using the \texttt{ncol} and \texttt{nrow} argument to specify the number of columns and rows respectively, and the \texttt{byrow} argument to specify how the data in would be ordered.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{12}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{, }\AttributeTok{byrow =} \ConstantTok{FALSE}\NormalTok{)}
\DocumentationTok{\#\#      [,1] [,2] [,3]}
\DocumentationTok{\#\# [1,]    1    5    9}
\DocumentationTok{\#\# [2,]    2    6   10}
\DocumentationTok{\#\# [3,]    3    7   11}
\DocumentationTok{\#\# [4,]    4    8   12}

\FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{12}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{3}\NormalTok{, }\AttributeTok{byrow =} \ConstantTok{FALSE}\NormalTok{)}
\DocumentationTok{\#\#      [,1] [,2] [,3] [,4]}
\DocumentationTok{\#\# [1,]    1    4    7   10}
\DocumentationTok{\#\# [2,]    2    5    8   11}
\DocumentationTok{\#\# [3,]    3    6    9   12}

\FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{12}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{, }\AttributeTok{byrow =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#      [,1] [,2] [,3]}
\DocumentationTok{\#\# [1,]    1    2    3}
\DocumentationTok{\#\# [2,]    4    5    6}
\DocumentationTok{\#\# [3,]    7    8    9}
\DocumentationTok{\#\# [4,]   10   11   12}
\end{Highlighting}
\end{Shaded}

Aside from numeric data types, a matrix can also be used to store other data types as long as they are homogeneous. To store heterogeneous data types, you should use a data frame which is introduced next.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"brown"}\NormalTok{, }\StringTok{"black"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"brown"}\NormalTok{, }\StringTok{"black"}\NormalTok{, }\StringTok{"blue"}\NormalTok{), }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\#      [,1]    [,2]   }
\DocumentationTok{\#\# [1,] "brown" "brown"}
\DocumentationTok{\#\# [2,] "black" "black"}
\DocumentationTok{\#\# [3,] "green" "blue"}

\FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"TRUE"}\NormalTok{, }\StringTok{"TRUE"}\NormalTok{, }\StringTok{"FALSE"}\NormalTok{, }\StringTok{"FALSE"}\NormalTok{), }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\#      [,1]   [,2]   }
\DocumentationTok{\#\# [1,] "TRUE" "FALSE"}
\DocumentationTok{\#\# [2,] "TRUE" "FALSE"}

\FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(1L, 2L, 3L, 4L), }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\#      [,1] [,2]}
\DocumentationTok{\#\# [1,]    1    3}
\DocumentationTok{\#\# [2,]    2    4}
\end{Highlighting}
\end{Shaded}

A \texttt{data.frame} is a two-dimensional data structures that are used to store heterogeneous data types in R. As a result of it's convenience, data frames are a commonly used data structure in R. You can use the function \texttt{data.frame()} to create a data frame.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
  \AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"blue"}\NormalTok{),}
  \AttributeTok{z =} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{tibbles}{%
\section{Tibbles}\label{tibbles}}

Tibbles are basically a modified version of R's \texttt{data.frame}. You can create a tibble using the function \texttt{tibble()}. Alternatively, you can coerce a data frame into a tibble using \texttt{as\_tibble()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
  \AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"blue"}\NormalTok{),}
  \AttributeTok{z =} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 3 x 3}
\DocumentationTok{\#\#       x y     z    }
\DocumentationTok{\#\#   \textless{}dbl\textgreater{} \textless{}chr\textgreater{} \textless{}lgl\textgreater{}}
\DocumentationTok{\#\# 1     1 red   TRUE }
\DocumentationTok{\#\# 2     2 green FALSE}
\DocumentationTok{\#\# 3     3 blue  TRUE}

\FunctionTok{as\_tibble}\NormalTok{(iris)}
\DocumentationTok{\#\# \# A tibble: 150 x 5}
\DocumentationTok{\#\#    Sepal.Length Sepal.Width Petal.Length Petal.Width Species}
\DocumentationTok{\#\#           \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{} \textless{}fct\textgreater{}  }
\DocumentationTok{\#\#  1          5.1         3.5          1.4         0.2 setosa }
\DocumentationTok{\#\#  2          4.9         3            1.4         0.2 setosa }
\DocumentationTok{\#\#  3          4.7         3.2          1.3         0.2 setosa }
\DocumentationTok{\#\#  4          4.6         3.1          1.5         0.2 setosa }
\DocumentationTok{\#\#  5          5           3.6          1.4         0.2 setosa }
\DocumentationTok{\#\#  6          5.4         3.9          1.7         0.4 setosa }
\DocumentationTok{\#\#  7          4.6         3.4          1.4         0.3 setosa }
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

A key difference lies in how tibbles are printed. Printing a tibble only results in the first ten rows being displayed with an explicit reporting of each column's data type.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(iris)}
\FunctionTok{print}\NormalTok{(tb)}
\DocumentationTok{\#\# \# A tibble: 150 x 5}
\DocumentationTok{\#\#    Sepal.Length Sepal.Width Petal.Length Petal.Width Species}
\DocumentationTok{\#\#           \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{} \textless{}fct\textgreater{}  }
\DocumentationTok{\#\#  1          5.1         3.5          1.4         0.2 setosa }
\DocumentationTok{\#\#  2          4.9         3            1.4         0.2 setosa }
\DocumentationTok{\#\#  3          4.7         3.2          1.3         0.2 setosa }
\DocumentationTok{\#\#  4          4.6         3.1          1.5         0.2 setosa }
\DocumentationTok{\#\#  5          5           3.6          1.4         0.2 setosa }
\DocumentationTok{\#\#  6          5.4         3.9          1.7         0.4 setosa }
\DocumentationTok{\#\#  7          4.6         3.4          1.4         0.3 setosa }
\NormalTok{....}

\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(iris)}
\FunctionTok{print}\NormalTok{(df)}
\DocumentationTok{\#\#     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species}
\DocumentationTok{\#\# 1            5.1         3.5          1.4         0.2     setosa}
\DocumentationTok{\#\# 2            4.9         3.0          1.4         0.2     setosa}
\DocumentationTok{\#\# 3            4.7         3.2          1.3         0.2     setosa}
\DocumentationTok{\#\# 4            4.6         3.1          1.5         0.2     setosa}
\DocumentationTok{\#\# 5            5.0         3.6          1.4         0.2     setosa}
\DocumentationTok{\#\# 6            5.4         3.9          1.7         0.4     setosa}
\DocumentationTok{\#\# 7            4.6         3.4          1.4         0.3     setosa}
\DocumentationTok{\#\# 8            5.0         3.4          1.5         0.2     setosa}
\DocumentationTok{\#\# 9            4.4         2.9          1.4         0.2     setosa}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Unlike a \texttt{data.frame}, tibbles provides clarity on the data structure that it returns. When indexing with tibbles, \texttt{{[}} always return another tibble while \texttt{{[}{[}} and \texttt{\$} alway returns a vector. In contrast, single column data frames are often converted into atomic vectors in R unless \texttt{drop\ =\ FALSE} is specified.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(tb[, }\DecValTok{1}\NormalTok{])}
\DocumentationTok{\#\# [1] "tbl\_df"     "tbl"        "data.frame"}

\FunctionTok{class}\NormalTok{(tb[[}\DecValTok{1}\NormalTok{]])}
\DocumentationTok{\#\# [1] "numeric"}

\FunctionTok{class}\NormalTok{(tb}\SpecialCharTok{$}\NormalTok{Sepal.Length)}
\DocumentationTok{\#\# [1] "numeric"}

\FunctionTok{class}\NormalTok{(df[, }\DecValTok{1}\NormalTok{])}
\DocumentationTok{\#\# [1] "numeric"}

\FunctionTok{class}\NormalTok{(df[, }\DecValTok{1}\NormalTok{, }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{])}
\DocumentationTok{\#\# [1] "data.frame"}
\end{Highlighting}
\end{Shaded}

Additionally, tibbles do not do partial matching and raises a warning unless the variable specified is an exact match.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb}\SpecialCharTok{$}\NormalTok{Sepal.Lengt}
\DocumentationTok{\#\# Warning: Unknown or uninitialised column: \textasciigrave{}Sepal.Lengt\textasciigrave{}.}
\DocumentationTok{\#\# NULL}

\NormalTok{df}\SpecialCharTok{$}\NormalTok{Sepal.Lengt}
\DocumentationTok{\#\#   [1] 5.1 4.9 4.7 4.6 5.0 5.4 4.6 5.0 4.4 4.9 5.4 4.8 4.8 4.3 5.8 5.7 5.4 5.1}
\DocumentationTok{\#\#  [19] 5.7 5.1 5.4 5.1 4.6 5.1 4.8 5.0 5.0 5.2 5.2 4.7 4.8 5.4 5.2 5.5 4.9 5.0}
\DocumentationTok{\#\#  [37] 5.5 4.9 4.4 5.1 5.0 4.5 4.4 5.0 5.1 4.8 5.1 4.6 5.3 5.0 7.0 6.4 6.9 5.5}
\DocumentationTok{\#\#  [55] 6.5 5.7 6.3 4.9 6.6 5.2 5.0 5.9 6.0 6.1 5.6 6.7 5.6 5.8 6.2 5.6 5.9 6.1}
\DocumentationTok{\#\#  [73] 6.3 6.1 6.4 6.6 6.8 6.7 6.0 5.7 5.5 5.5 5.8 6.0 5.4 6.0 6.7 6.3 5.6 5.5}
\DocumentationTok{\#\#  [91] 5.5 6.1 5.8 5.0 5.6 5.7 5.7 6.2 5.1 5.7 6.3 5.8 7.1 6.3 6.5 7.6 4.9 7.3}
\DocumentationTok{\#\# [109] 6.7 7.2 6.5 6.4 6.8 5.7 5.8 6.4 6.5 7.7 7.7 6.0 6.9 5.6 7.7 6.3 6.7 7.2}
\DocumentationTok{\#\# [127] 6.2 6.1 6.4 7.2 7.4 7.9 6.4 6.3 6.1 7.7 6.3 6.4 6.0 6.9 6.7 6.9 5.8 6.8}
\DocumentationTok{\#\# [145] 6.7 6.7 6.3 6.5 6.2 5.9}
\end{Highlighting}
\end{Shaded}

You can read more about tibbles by typing vignette(``tibble'') in your console.

\hypertarget{data-table}{%
\section{data.table}\label{data-table}}

Like tibbles, \texttt{data.table}s are an enhanced version of \texttt{data.frame}s. You can create a \texttt{data.table} using the function \texttt{data.table()}. You can also coerce existing R objects into a \texttt{data.table} with \texttt{setDT()} for \texttt{data.frame}s and lists, and \texttt{as.data.table()} for other data structures. Note that \texttt{as.data.table()} also works with \texttt{data.frame}s and lists. However \texttt{setDT()} is more memory efficient because it does not create a copy of the original data frame or list but instead returns a data table by reference.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
  \AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"blue"}\NormalTok{),}
  \AttributeTok{z =} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\NormalTok{)}

\FunctionTok{class}\NormalTok{(}
  \FunctionTok{setDT}\NormalTok{(}
    \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\NormalTok{  )}
\NormalTok{)}
\DocumentationTok{\#\# [1] "data.table" "data.frame"}
\end{Highlighting}
\end{Shaded}

\texttt{data.table}s provide additional functionality through the way it is queried. The general form for working with a data table is \texttt{{[}i,\ j,\ by{]}}, which can be read as subset rows using \texttt{i}, operate on \texttt{j}, and grouped by \texttt{by}.

Lets see how this work using the \texttt{iris} example dataset.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt }\OtherTok{\textless{}{-}} \FunctionTok{as.data.table}\NormalTok{(iris)}

\FunctionTok{print}\NormalTok{(dt)}
\DocumentationTok{\#\#      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species}
\DocumentationTok{\#\#   1:          5.1         3.5          1.4         0.2    setosa}
\DocumentationTok{\#\#   2:          4.9         3.0          1.4         0.2    setosa}
\DocumentationTok{\#\#   3:          4.7         3.2          1.3         0.2    setosa}
\DocumentationTok{\#\#   4:          4.6         3.1          1.5         0.2    setosa}
\DocumentationTok{\#\#   5:          5.0         3.6          1.4         0.2    setosa}
\DocumentationTok{\#\#  {-}{-}{-}                                                            }
\DocumentationTok{\#\# 146:          6.7         3.0          5.2         2.3 virginica}
\DocumentationTok{\#\# 147:          6.3         2.5          5.0         1.9 virginica}
\DocumentationTok{\#\# 148:          6.5         3.0          5.2         2.0 virginica}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can filter the rows to only contain \texttt{Species\ ==\ "virginica}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[Species }\SpecialCharTok{==} \StringTok{"virginica"}\NormalTok{]}
\DocumentationTok{\#\#     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species}
\DocumentationTok{\#\#  1:          6.3         3.3          6.0         2.5 virginica}
\DocumentationTok{\#\#  2:          5.8         2.7          5.1         1.9 virginica}
\DocumentationTok{\#\#  3:          7.1         3.0          5.9         2.1 virginica}
\DocumentationTok{\#\#  4:          6.3         2.9          5.6         1.8 virginica}
\DocumentationTok{\#\#  5:          6.5         3.0          5.8         2.2 virginica}
\DocumentationTok{\#\#  6:          7.6         3.0          6.6         2.1 virginica}
\DocumentationTok{\#\#  7:          4.9         2.5          4.5         1.7 virginica}
\DocumentationTok{\#\#  8:          7.3         2.9          6.3         1.8 virginica}
\DocumentationTok{\#\#  9:          6.7         2.5          5.8         1.8 virginica}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can select the columns using the \texttt{j} expression. Note the change in the type of data structure when \texttt{list()} or \texttt{.()} is used.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, Sepal.Length]}
\DocumentationTok{\#\#   [1] 5.1 4.9 4.7 4.6 5.0 5.4 4.6 5.0 4.4 4.9 5.4 4.8 4.8 4.3 5.8 5.7 5.4 5.1}
\DocumentationTok{\#\#  [19] 5.7 5.1 5.4 5.1 4.6 5.1 4.8 5.0 5.0 5.2 5.2 4.7 4.8 5.4 5.2 5.5 4.9 5.0}
\DocumentationTok{\#\#  [37] 5.5 4.9 4.4 5.1 5.0 4.5 4.4 5.0 5.1 4.8 5.1 4.6 5.3 5.0 7.0 6.4 6.9 5.5}
\DocumentationTok{\#\#  [55] 6.5 5.7 6.3 4.9 6.6 5.2 5.0 5.9 6.0 6.1 5.6 6.7 5.6 5.8 6.2 5.6 5.9 6.1}
\DocumentationTok{\#\#  [73] 6.3 6.1 6.4 6.6 6.8 6.7 6.0 5.7 5.5 5.5 5.8 6.0 5.4 6.0 6.7 6.3 5.6 5.5}
\DocumentationTok{\#\#  [91] 5.5 6.1 5.8 5.0 5.6 5.7 5.7 6.2 5.1 5.7 6.3 5.8 7.1 6.3 6.5 7.6 4.9 7.3}
\DocumentationTok{\#\# [109] 6.7 7.2 6.5 6.4 6.8 5.7 5.8 6.4 6.5 7.7 7.7 6.0 6.9 5.6 7.7 6.3 6.7 7.2}
\DocumentationTok{\#\# [127] 6.2 6.1 6.4 7.2 7.4 7.9 6.4 6.3 6.1 7.7 6.3 6.4 6.0 6.9 6.7 6.9 5.8 6.8}
\DocumentationTok{\#\# [145] 6.7 6.7 6.3 6.5 6.2 5.9}

\FunctionTok{class}\NormalTok{(dt[, Sepal.Length])}
\DocumentationTok{\#\# [1] "numeric"}

\FunctionTok{class}\NormalTok{(dt[, }\FunctionTok{list}\NormalTok{(Sepal.Length)])}
\DocumentationTok{\#\# [1] "data.table" "data.frame"}

\FunctionTok{class}\NormalTok{(dt[, .(Sepal.Length)])}
\DocumentationTok{\#\# [1] "data.table" "data.frame"}
\end{Highlighting}
\end{Shaded}

You can select multiple columns with \texttt{list()} or \texttt{.()}.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{dt[, .(Sepal.Length, Species)]}
\DocumentationTok{\#\#      Sepal.Length   Species}
\DocumentationTok{\#\#   1:          5.1    setosa}
\DocumentationTok{\#\#   2:          4.9    setosa}
\DocumentationTok{\#\#   3:          4.7    setosa}
\DocumentationTok{\#\#   4:          4.6    setosa}
\DocumentationTok{\#\#   5:          5.0    setosa}
\DocumentationTok{\#\#  {-}{-}{-}                       }
\DocumentationTok{\#\# 146:          6.7 virginica}
\DocumentationTok{\#\# 147:          6.3 virginica}
\DocumentationTok{\#\# 148:          6.5 virginica}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Aside from selecting columns using \texttt{j}, you can carry out computations on \texttt{j} involving one or more columns and a subset of rows using \texttt{i}.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{dt[, }\FunctionTok{mean}\NormalTok{(Sepal.Length)]}
\DocumentationTok{\#\# [1] 5.843333}

\NormalTok{dt[, .(}
  \AttributeTok{Sepal.Length.Mean =} \FunctionTok{mean}\NormalTok{(Sepal.Length),}
  \AttributeTok{Sepal.With.Mean =} \FunctionTok{mean}\NormalTok{(Sepal.Width)}
\NormalTok{)]}
\DocumentationTok{\#\#    Sepal.Length.Mean Sepal.With.Mean}
\DocumentationTok{\#\# 1:          5.843333        3.057333}

\NormalTok{dt[}
\NormalTok{  Species }\SpecialCharTok{==} \StringTok{"virginica"} \SpecialCharTok{\&}\NormalTok{ Sepal.Length }\SpecialCharTok{\textless{}} \DecValTok{6}\NormalTok{,}
\NormalTok{  .(}
    \AttributeTok{Sepal.Length.Mean =} \FunctionTok{mean}\NormalTok{(Sepal.Length),}
    \AttributeTok{Sepal.With.Mean =} \FunctionTok{mean}\NormalTok{(Sepal.Width)}
\NormalTok{  )}
\NormalTok{]}
\DocumentationTok{\#\#    Sepal.Length.Mean Sepal.With.Mean}
\DocumentationTok{\#\# 1:          5.642857        2.714286}
\end{Highlighting}
\end{Shaded}

You can then use the \texttt{by} expression in data tables to perform computations by groups.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{dt[, .(}
  \AttributeTok{Sepal.Length.Mean =} \FunctionTok{mean}\NormalTok{(Sepal.Length),}
  \AttributeTok{Sepal.With.Mean =} \FunctionTok{mean}\NormalTok{(Sepal.Width)}
\NormalTok{),}
\NormalTok{by }\OtherTok{=}\NormalTok{ Species}
\NormalTok{]}
\DocumentationTok{\#\#       Species Sepal.Length.Mean Sepal.With.Mean}
\DocumentationTok{\#\# 1:     setosa             5.006           3.428}
\DocumentationTok{\#\# 2: versicolor             5.936           2.770}
\DocumentationTok{\#\# 3:  virginica             6.588           2.974}
\end{Highlighting}
\end{Shaded}

The \texttt{.N} variable that counts the number of instances is particularly useful when combined with \texttt{by}.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{dt[, .N, by }\OtherTok{=}\NormalTok{ Species]}
\DocumentationTok{\#\#       Species  N}
\DocumentationTok{\#\# 1:     setosa 50}
\DocumentationTok{\#\# 2: versicolor 50}
\DocumentationTok{\#\# 3:  virginica 50}
\end{Highlighting}
\end{Shaded}

You can also apply it to multiple columns using the \texttt{list()} or \texttt{.()} notation. You can read the code below as calculating the mean of \texttt{Speal.Length} and the number of instances (given by \texttt{.N}) grouped by their \texttt{Species} and whether \texttt{Sepal.Length\ \textless{}\ 6}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt[, .(}\AttributeTok{Sepal.Length.Mean =} \FunctionTok{mean}\NormalTok{(Sepal.Length), .N),}
\NormalTok{  by }\OtherTok{=}\NormalTok{ .(Species, Sepal.Length }\SpecialCharTok{\textless{}} \DecValTok{6}\NormalTok{)}
\NormalTok{]}
\DocumentationTok{\#\#       Species Sepal.Length \textless{} 6 Sepal.Length.Mean  N}
\DocumentationTok{\#\# 1:     setosa             TRUE          5.006000 50}
\DocumentationTok{\#\# 2: versicolor            FALSE          6.375000 24}
\DocumentationTok{\#\# 3: versicolor             TRUE          5.530769 26}
\DocumentationTok{\#\# 4:  virginica            FALSE          6.741860 43}
\DocumentationTok{\#\# 5:  virginica             TRUE          5.642857  7}
\end{Highlighting}
\end{Shaded}

\texttt{data.table}s add, update, and delete columns by reference to avoid redundant copies for performance improvements. You can use the \texttt{:=} operator to add, update, and delete columns in \texttt{j} by reference. There are two forms for using \texttt{:=} and they are: \texttt{{[},\ LSH\ :=\ RHS{]}} and \texttt{{[},}:=\texttt{(LHS\ =\ RHS){]}}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt }\OtherTok{\textless{}{-}} \FunctionTok{as.data.table}\NormalTok{(iris)}

\NormalTok{dt[, Sepal.Sum }\SpecialCharTok{:}\ErrorTok{=}\NormalTok{ .(Sepal.Length }\SpecialCharTok{+}\NormalTok{ Sepal.Width)]}
\FunctionTok{head}\NormalTok{(dt)}
\DocumentationTok{\#\#    Sepal.Length Sepal.Width Petal.Length Petal.Width Species Sepal.Sum}
\DocumentationTok{\#\# 1:          5.1         3.5          1.4         0.2  setosa       8.6}
\DocumentationTok{\#\# 2:          4.9         3.0          1.4         0.2  setosa       7.9}
\DocumentationTok{\#\# 3:          4.7         3.2          1.3         0.2  setosa       7.9}
\DocumentationTok{\#\# 4:          4.6         3.1          1.5         0.2  setosa       7.7}
\DocumentationTok{\#\# 5:          5.0         3.6          1.4         0.2  setosa       8.6}
\DocumentationTok{\#\# 6:          5.4         3.9          1.7         0.4  setosa       9.3}

\NormalTok{dt[, }\StringTok{\textasciigrave{}}\AttributeTok{:=}\StringTok{\textasciigrave{}}\NormalTok{(}\AttributeTok{Petal.Sum =}\NormalTok{ Petal.Length }\SpecialCharTok{+}\NormalTok{ Petal.Width)]}
\FunctionTok{head}\NormalTok{(dt)}
\DocumentationTok{\#\#    Sepal.Length Sepal.Width Petal.Length Petal.Width Species Sepal.Sum}
\DocumentationTok{\#\# 1:          5.1         3.5          1.4         0.2  setosa       8.6}
\DocumentationTok{\#\# 2:          4.9         3.0          1.4         0.2  setosa       7.9}
\DocumentationTok{\#\# 3:          4.7         3.2          1.3         0.2  setosa       7.9}
\DocumentationTok{\#\# 4:          4.6         3.1          1.5         0.2  setosa       7.7}
\DocumentationTok{\#\# 5:          5.0         3.6          1.4         0.2  setosa       8.6}
\DocumentationTok{\#\# 6:          5.4         3.9          1.7         0.4  setosa       9.3}
\DocumentationTok{\#\#    Petal.Sum}
\DocumentationTok{\#\# 1:       1.6}
\DocumentationTok{\#\# 2:       1.6}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Note that in the above code, we do not need to make any assignments back to a variable because the modification is done by reference or in place. In other words we are modifying \texttt{dt} and not a copy of \texttt{dt}. Therefore, you will also see that if you run the entire code chunk above, \texttt{dt} will contain both columns \texttt{Sepal.Sum} and \texttt{Petal.Sum}.

Since \texttt{:=} is used in \texttt{j}, it can be combined with \texttt{i} and \texttt{by} as we have seen in the earlier parts of this sub-section.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{dt[Species }\SpecialCharTok{==} \StringTok{"versicolor"} \SpecialCharTok{|}\NormalTok{ Species }\SpecialCharTok{==} \StringTok{"virginica"}\NormalTok{, Sepal.Length }\SpecialCharTok{:}\ErrorTok{=} \DecValTok{0}\NormalTok{]}
\FunctionTok{head}\NormalTok{(dt)}
\DocumentationTok{\#\#    Sepal.Length Sepal.Width Petal.Length Petal.Width Species Sepal.Sum}
\DocumentationTok{\#\# 1:          5.1         3.5          1.4         0.2  setosa       8.6}
\DocumentationTok{\#\# 2:          4.9         3.0          1.4         0.2  setosa       7.9}
\DocumentationTok{\#\# 3:          4.7         3.2          1.3         0.2  setosa       7.9}
\DocumentationTok{\#\# 4:          4.6         3.1          1.5         0.2  setosa       7.7}
\DocumentationTok{\#\# 5:          5.0         3.6          1.4         0.2  setosa       8.6}
\DocumentationTok{\#\# 6:          5.4         3.9          1.7         0.4  setosa       9.3}
\DocumentationTok{\#\#    Petal.Sum}
\DocumentationTok{\#\# 1:       1.6}
\DocumentationTok{\#\# 2:       1.6}
\NormalTok{....}

\NormalTok{dt[, Sepal.Length.Mean }\SpecialCharTok{:}\ErrorTok{=} \FunctionTok{mean}\NormalTok{(Sepal.Length),}
\NormalTok{  by }\OtherTok{=}\NormalTok{ .(Species)}
\NormalTok{]}
\FunctionTok{head}\NormalTok{(dt)}
\DocumentationTok{\#\#    Sepal.Length Sepal.Width Petal.Length Petal.Width Species Sepal.Sum}
\DocumentationTok{\#\# 1:          5.1         3.5          1.4         0.2  setosa       8.6}
\DocumentationTok{\#\# 2:          4.9         3.0          1.4         0.2  setosa       7.9}
\DocumentationTok{\#\# 3:          4.7         3.2          1.3         0.2  setosa       7.9}
\DocumentationTok{\#\# 4:          4.6         3.1          1.5         0.2  setosa       7.7}
\DocumentationTok{\#\# 5:          5.0         3.6          1.4         0.2  setosa       8.6}
\DocumentationTok{\#\# 6:          5.4         3.9          1.7         0.4  setosa       9.3}
\DocumentationTok{\#\#    Petal.Sum Sepal.Length.Mean}
\DocumentationTok{\#\# 1:       1.6             5.006}
\DocumentationTok{\#\# 2:       1.6             5.006}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can find out more about \texttt{data.table}s by typing \texttt{vignette(package\ =\ "data.table")} into the console.

\hypertarget{dates-and-times}{%
\chapter{Dates and Times}\label{dates-and-times}}

\hypertarget{prerequisites-2}{%
\section{Prerequisites}\label{prerequisites-2}}

In this chapter, we will introduce the \textbf{lubridate} package that is designed to make it easier to work with dates and times in R.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lubridate)}
\end{Highlighting}
\end{Shaded}

\hypertarget{parsing-dates-and-times}{%
\section{Parsing dates and times}\label{parsing-dates-and-times}}

You can easily transform dates and times stored as character vectors to Date or POSIXct (or date-time) objects in R using lubridate. All you need to do is specify the order of the year \texttt{y}, month \texttt{m}, and the day \texttt{d} and lubridate will automatically figure out the format.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dmy}\NormalTok{(}\StringTok{"3/12/1985"}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03"}
\FunctionTok{ymd}\NormalTok{(}\StringTok{"85/12/03"}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03"}
\FunctionTok{mdy}\NormalTok{(}\StringTok{"Dec 3rd 1985"}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03"}
\FunctionTok{ydm}\NormalTok{(}\StringTok{"85{-}3rd{-}december"}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03"}
\end{Highlighting}
\end{Shaded}

The same functions can also convert numeric vectors.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ymd}\NormalTok{(}\DecValTok{19851203}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03"}
\FunctionTok{dmy}\NormalTok{(}\DecValTok{31285}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03"}
\end{Highlighting}
\end{Shaded}

You can create Date objects with the time component using a POSIXct or date-time object simply by adding an underscore followed by the order of the hour \texttt{h}, minute \texttt{m} and second \texttt{s}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ymd\_h}\NormalTok{(}\StringTok{"1985/12/03 21"}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03 21:00:00 UTC"}
\FunctionTok{ymd\_hm}\NormalTok{(}\StringTok{"1985/12/03 21:05"}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03 21:05:00 UTC"}
\FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{"1985/12/03 21:05:30"}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03 21:05:30 UTC"}
\end{Highlighting}
\end{Shaded}

You can also specify the time zone by providing inputs to the argument \texttt{tz}. You can find out more about time zones in R by typing \texttt{?timezones} into the console.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{"1985/12/03 21:05:30"}\NormalTok{, }\AttributeTok{tz =} \StringTok{"Singapore"}\NormalTok{)}
\DocumentationTok{\#\# [1] "1985{-}12{-}03 21:05:30 +08"}
\end{Highlighting}
\end{Shaded}

Date vs date-time objects that are created using lubridate. By default, dates will be created as Date objects without the time component. You can force the creation of a date-time object by including the timezone \texttt{tz} argument.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(}\FunctionTok{ymd}\NormalTok{(}\StringTok{"1985/12/03"}\NormalTok{))}
\DocumentationTok{\#\# [1] "Date"}
\FunctionTok{class}\NormalTok{(}\FunctionTok{ymd}\NormalTok{(}\StringTok{"1985/12/03"}\NormalTok{, }\AttributeTok{tz =} \StringTok{"Singapore"}\NormalTok{))}
\DocumentationTok{\#\# [1] "POSIXct" "POSIXt"}
\FunctionTok{class}\NormalTok{(}\FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{"1985/12/03 21:05:30"}\NormalTok{))}
\DocumentationTok{\#\# [1] "POSIXct" "POSIXt"}
\end{Highlighting}
\end{Shaded}

\hypertarget{extracting-components}{%
\section{Extracting components}\label{extracting-components}}

Lubridate provides simple functions that allows you to easily get different components of a date or date-time object. These functions are especially useful when analyzing time-series data and when you want to group your data by a particular time period.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{my\_dt }\OtherTok{\textless{}{-}} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{"1985/12/03 21:05:30"}\NormalTok{)}
\FunctionTok{year}\NormalTok{(my\_dt)}
\DocumentationTok{\#\# [1] 1985}
\FunctionTok{month}\NormalTok{(my\_dt)}
\DocumentationTok{\#\# [1] 12}
\FunctionTok{day}\NormalTok{(my\_dt)}
\DocumentationTok{\#\# [1] 3}
\FunctionTok{hour}\NormalTok{(my\_dt)}
\DocumentationTok{\#\# [1] 21}
\FunctionTok{minute}\NormalTok{(my\_dt)}
\DocumentationTok{\#\# [1] 5}
\FunctionTok{second}\NormalTok{(my\_dt)}
\DocumentationTok{\#\# [1] 30}
\FunctionTok{wday}\NormalTok{(my\_dt, }\AttributeTok{label =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\# [1] Tue}
\DocumentationTok{\#\# Levels: Sun \textless{} Mon \textless{} Tue \textless{} Wed \textless{} Thu \textless{} Fri \textless{} Sat}
\end{Highlighting}
\end{Shaded}

\hypertarget{importing-data}{%
\chapter{Importing Data}\label{importing-data}}

\hypertarget{prerequisites-3}{%
\section{Prerequisites}\label{prerequisites-3}}

In this chapter, we focus on the use of the \textbf{readr} package that forms a part of the \textbf{tidyverse} package. \textbf{readr} provides a fast and easy way to parse a file because it uses a sophisticated parser that guesses the data type for each column along with the flexibility to specify what to parse. You will also need the \textbf{here} package (to easily provide relative file paths) and the \textbf{lubridate} package (to work with dates and times).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(lubridate)}
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

In this chapter we will also be using the following datasets. If the following code returns \texttt{FALSE}, you should refer to the section \protect\hyperlink{finding-your-file}{Finding your file} in the \protect\hyperlink{preface}{Preface} on where you can download the datasets.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{file.exists}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"iris.csv"}\NormalTok{))}
\FunctionTok{file.exists}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"building.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{finding-your-file}{%
\section{Finding your file}\label{finding-your-file}}

Before importing data, you need to first let R know where to find the file by providing the file path. You can provide file paths relative to the top-level directory of the current R project with the \texttt{here()} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{here}\NormalTok{()}
\DocumentationTok{\#\# [1] "/Users/adrianchong/Documents/GitHub/r4bes"}
\end{Highlighting}
\end{Shaded}

To reference a file named \texttt{iris.csv} located in the \texttt{data} folder that is located in the top-level directory of your project

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"iris.csv"}\NormalTok{)}
\DocumentationTok{\#\# [1] "/Users/adrianchong/Documents/GitHub/r4bes/data/iris.csv"}
\end{Highlighting}
\end{Shaded}

\hypertarget{parsing-a-csv-file}{%
\section{Parsing a csv file}\label{parsing-a-csv-file}}

We will focus on the \texttt{read\_csv()} function because building data are typically stored in \texttt{csv} format. You can find out more about other file formats in \href{https://readr.tidyverse.org}{readr's documentation}.

The easiest way to parse a file is by providing the file path. In most cases, it will just work as expected where \texttt{readr} correctly guesses the column specification (that gets printed to the console) and you get a tibble as specified. \href{https://readr.tidyverse.org/reference/readr_example.html}{\texttt{readr\_example()}} is a function that makes it easy to access example files to demonstrate \texttt{readr}'s capabilities.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_csv}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"iris.csv"}\NormalTok{))}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# {-}{-} Column specification {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# cols(}
\DocumentationTok{\#\#   Sepal.Length = col\_double(),}
\DocumentationTok{\#\#   Sepal.Width = col\_double(),}
\DocumentationTok{\#\#   Petal.Length = col\_double(),}
\DocumentationTok{\#\#   Petal.Width = col\_double(),}
\DocumentationTok{\#\#   Species = col\_character()}
\DocumentationTok{\#\# )}
\DocumentationTok{\#\# \# A tibble: 150 x 5}
\DocumentationTok{\#\#    Sepal.Length Sepal.Width Petal.Length Petal.Width Species}
\DocumentationTok{\#\#           \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{} \textless{}chr\textgreater{}  }
\DocumentationTok{\#\#  1          5.1         3.5          1.4         0.2 setosa }
\DocumentationTok{\#\#  2          4.9         3            1.4         0.2 setosa }
\DocumentationTok{\#\#  3          4.7         3.2          1.3         0.2 setosa }
\DocumentationTok{\#\#  4          4.6         3.1          1.5         0.2 setosa }
\DocumentationTok{\#\#  5          5           3.6          1.4         0.2 setosa }
\DocumentationTok{\#\#  6          5.4         3.9          1.7         0.4 setosa }
\DocumentationTok{\#\#  7          4.6         3.4          1.4         0.3 setosa }
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{building-data}{%
\section{Building data}\label{building-data}}

Data from buildings are often messy without a standardized format. Therefore, it is not uncommon if \texttt{readr} does not guess correctly. Parsing date/times is particularly important when working with time-series building data.

For example, with the \texttt{building.csv} dataset, you can see that there are problems parsing the \texttt{timestamp} column. Specifically, column \texttt{timestamp} was parsed as a character vector when it actually contains a date/time. The \texttt{skip} argument is particularly useful since building data often contains meta-data that you want to exclude. A character vector can also be supplied to specify the column names.

\begin{Shaded}
\begin{Highlighting}[]

\FunctionTok{read\_csv}\NormalTok{(}
  \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"building.csv"}\NormalTok{),}
  \AttributeTok{col\_names =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"datetime"}\NormalTok{,}
    \StringTok{"power"}
\NormalTok{  ),}
  \AttributeTok{skip =} \DecValTok{2}
\NormalTok{)}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# {-}{-} Column specification {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# cols(}
\DocumentationTok{\#\#   datetime = col\_character(),}
\DocumentationTok{\#\#   power = col\_number()}
\DocumentationTok{\#\# )}
\DocumentationTok{\#\# \# A tibble: 1,324 x 2}
\DocumentationTok{\#\#    datetime       power}
\DocumentationTok{\#\#    \textless{}chr\textgreater{}          \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 1/9/19 0:00 2210185.}
\DocumentationTok{\#\#  2 1/9/19 0:30 2210196.}
\DocumentationTok{\#\#  3 1/9/19 1:00 2210208.}
\DocumentationTok{\#\#  4 1/9/19 1:30 2210219 }
\DocumentationTok{\#\#  5 1/9/19 2:00 2210231 }
\DocumentationTok{\#\#  6 1/9/19 2:30 2210242.}
\DocumentationTok{\#\#  7 1/9/19 3:00 2210254.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can correct this using the \texttt{col\_types} argument to specify that column \texttt{timestamp} should be parsed as a date/time. You can view the available column specifications by typing \texttt{?cols} in your console. Typically specifying the data type would have allowed the data to be parsed correctly. In this particular dataset, there are two problems that caused the parsing to fail. First, the \texttt{timestamp} column does not follow \href{https://en.wikipedia.org/wiki/ISO_8601}{ISO8601} but date times are parsed as ISO8601 if no format specification is provided. Second, \texttt{col\_double()} is strict and does not allow for leading or trailing characters.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_csv}\NormalTok{(}
  \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"building.csv"}\NormalTok{),}
  \AttributeTok{col\_types =} \FunctionTok{cols}\NormalTok{(}
    \FunctionTok{col\_datetime}\NormalTok{(),}
    \FunctionTok{col\_double}\NormalTok{()}
\NormalTok{  ),}
  \AttributeTok{col\_names =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"datetime"}\NormalTok{,}
    \StringTok{"power"}
\NormalTok{  ),}
  \AttributeTok{skip =} \DecValTok{2}
\NormalTok{)}
\DocumentationTok{\#\# Warning: 2648 parsing failures.}
\DocumentationTok{\#\# row      col               expected       actual                                                          file}
\DocumentationTok{\#\#   1 datetime date like              1/9/19 0:00  \textquotesingle{}/Users/adrianchong/Documents/GitHub/r4bes/data/building.csv\textquotesingle{}}
\DocumentationTok{\#\#   1 power    no trailing characters 2,210,184.75 \textquotesingle{}/Users/adrianchong/Documents/GitHub/r4bes/data/building.csv\textquotesingle{}}
\DocumentationTok{\#\#   2 datetime date like              1/9/19 0:30  \textquotesingle{}/Users/adrianchong/Documents/GitHub/r4bes/data/building.csv\textquotesingle{}}
\DocumentationTok{\#\#   2 power    no trailing characters 2,210,195.75 \textquotesingle{}/Users/adrianchong/Documents/GitHub/r4bes/data/building.csv\textquotesingle{}}
\DocumentationTok{\#\#   3 datetime date like              1/9/19 1:00  \textquotesingle{}/Users/adrianchong/Documents/GitHub/r4bes/data/building.csv\textquotesingle{}}
\DocumentationTok{\#\# ... ........ ...................... ............ .............................................................}
\DocumentationTok{\#\# See problems(...) for more details.}
\DocumentationTok{\#\# \# A tibble: 1,324 x 2}
\DocumentationTok{\#\#    datetime            power}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 NA                     NA}
\DocumentationTok{\#\#  2 NA                     NA}
\DocumentationTok{\#\#  3 NA                     NA}
\DocumentationTok{\#\#  4 NA                     NA}
\DocumentationTok{\#\#  5 NA                     NA}
\DocumentationTok{\#\#  6 NA                     NA}
\DocumentationTok{\#\#  7 NA                     NA}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

To resolve this, you can explicitly provide the date/time format specification that is similar to the function \texttt{strptime()}. Type \texttt{?strptime()} for the list of character representations. However, do note that the specified format must be a complete match to the entire string. Additionally, \texttt{col\_number()} is used in place of \texttt{col\_double()} because it is more flexible and ignores non-numeric characters. In general, it is recommended to be explicit in providing column specifications to mitigate parsing errors.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_csv}\NormalTok{(}
  \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"building.csv"}\NormalTok{),}
  \AttributeTok{col\_types =} \FunctionTok{cols}\NormalTok{(}
    \FunctionTok{col\_datetime}\NormalTok{(}\AttributeTok{format =} \StringTok{"\%d/\%m/\%y \%H:\%M"}\NormalTok{),}
    \FunctionTok{col\_number}\NormalTok{()}
\NormalTok{  ),}
  \AttributeTok{col\_names =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"datetime"}\NormalTok{,}
    \StringTok{"power"}
\NormalTok{  ),}
  \AttributeTok{skip =} \DecValTok{2}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 1,324 x 2}
\DocumentationTok{\#\#    datetime               power}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                 \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2019{-}09{-}01 00:00:00 2210185.}
\DocumentationTok{\#\#  2 2019{-}09{-}01 00:30:00 2210196.}
\DocumentationTok{\#\#  3 2019{-}09{-}01 01:00:00 2210208.}
\DocumentationTok{\#\#  4 2019{-}09{-}01 01:30:00 2210219 }
\DocumentationTok{\#\#  5 2019{-}09{-}01 02:00:00 2210231 }
\DocumentationTok{\#\#  6 2019{-}09{-}01 02:30:00 2210242.}
\DocumentationTok{\#\#  7 2019{-}09{-}01 03:00:00 2210254.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{regular-expressions}{%
\chapter{Regular expressions}\label{regular-expressions}}

\emph{Regular expressions} are patterns that are used to match combinations of characters in a string. Before we begin, just a cautionary note that if your regular expressions are becoming too complex, perhaps it is time to step back and think about whether it is necessary and if they can be represented multiple expressions that are easier to understand.

\hypertarget{prerequisites-4}{%
\section{Prerequisites}\label{prerequisites-4}}

The functions \texttt{str\_view()} and \texttt{str\_view\_all()} from the \textbf{stringr} package (part of tidyverse) will be used to learn regular expressions interactively. \texttt{str\_view()} shows the first match while \texttt{str\_view\_all()} shows all the matches.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\hypertarget{basic-matches}{%
\section{Basic matches}\label{basic-matches}}

The most basic form of matching is to match exact strings

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"abc ABC}\SpecialCharTok{\textbackslash{}n}\StringTok{123. !?}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{()\{\}"}\NormalTok{)}
\FunctionTok{writeLines}\NormalTok{(x)}
\DocumentationTok{\#\# abc ABC}
\DocumentationTok{\#\# 123. !?\textbackslash{}()\{\}}

\FunctionTok{str\_view}\NormalTok{(x, }\StringTok{"abc"}\NormalTok{)}
\DocumentationTok{\#\# PhantomJS not found. You can install it with webshot::install\_phantomjs(). If it is installed, please make sure the phantomjs executable can be found via the PATH variable.}
\end{Highlighting}
\end{Shaded}

\hypertarget{character-classes}{%
\section{Character classes}\label{character-classes}}

Character classes allows you to specify a list of characters for matching.

A bracket \texttt{{[}...{]}} can be used to specify a list of character. Therefore, it will match any characters that was specified within the brackets. If a caret \texttt{\^{}} is added to the start of the list of characters, it will match any characters that are NOT in the list. You can also specify a range expression using a hyphen \texttt{-} between two characters.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_view\_all}\NormalTok{(x, }\StringTok{"[bcde]"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can also specify character classes using pre-defined names of these classes with a bracket expression.

\begin{longtable}[]{@{}cl@{}}
\toprule
Regex & What it matches \\
\midrule
\endhead
{[}:alnum:{]} & letters and numbers \\
{[}:alpha:{]} & letters \\
{[}:upper:{]} & uppercase letters \\
{[}:lower:{]} & lowercase letters \\
{[}:digit:{]} & numbers \\
{[}:punct:{]} & punctuations \\
{[}:space:{]} & space characters \\
\bottomrule
\end{longtable}

Try out the other named classes using the function \texttt{str\_view\_all()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_view\_all}\NormalTok{(x, }\StringTok{"[:alnum:]"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

There are also special metacharacters you can use to match entire classes of characters.

\begin{longtable}[]{@{}cl@{}}
\toprule
Regex & What it matches \\
\midrule
\endhead
\texttt{.} & any character except newline \texttt{"\textbackslash{}n"} \\
\texttt{\textbackslash{}d} & digit \\
\texttt{\textbackslash{}D} & non-digit \\
\texttt{\textbackslash{}s} & whitespace \\
\texttt{\textbackslash{}S} & non-whitespace \\
\texttt{\textbackslash{}t} & tab \\
\texttt{\textbackslash{}n} & newline \\
\texttt{\textbackslash{}w} & ``word'' i.e., letters (a-z and A-Z), digits (0-9) or (\_) \\
\texttt{\textbackslash{}W} & non-``word'' \\
\bottomrule
\end{longtable}

Note that to include a \texttt{\textbackslash{}} in a regular expression, you need to escape it using \texttt{\textbackslash{}\textbackslash{}}. This is explained in the next subsection on escaping .

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_view\_all}\NormalTok{(x, }\StringTok{"."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{regex-escape}{%
\section{Escaping}\label{regex-escape}}

In regular expressions, the backslash \texttt{\textbackslash{}} is used as an \emph{escape} character and is used to ``escape'' any special characters that comes after the backslash. However, in R, the same backslashes \texttt{\textbackslash{}} are also used as an \emph{escape} character in strings. For example, the string \texttt{"abc\ ABC\ 123.\textbackslash{}n!?\textbackslash{}\textbackslash{}()\{\}"} is used to represent the characters \texttt{abc\ ABC\ 123.\textbackslash{}n!?\textbackslash{}()\{\}}. You will see that there is any additional backslash \texttt{\textbackslash{}} in the string representation. This is because \texttt{\textbackslash{}} is a special character for strings in R. Therefore, to represent a backslash \texttt{\textbackslash{}} in a string, another backslash needs to be added to escape the special representation of a \texttt{\textbackslash{}} in strings. This means that to create a string containing "", you need to write \texttt{"\textbackslash{}\textbackslash{}"}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"abc ABC}\SpecialCharTok{\textbackslash{}n}\StringTok{123. !?}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{()\{\}"}\NormalTok{)}
\FunctionTok{writeLines}\NormalTok{(x)}
\DocumentationTok{\#\# abc ABC}
\DocumentationTok{\#\# 123. !?\textbackslash{}()\{\}}
\end{Highlighting}
\end{Shaded}

Therefore, to create any regular expressions that contains a backslash, you would need to use a string that contains another backslash \texttt{\textbackslash{}} to escape the backslash \texttt{\textbackslash{}} that forms a part of the regular expression.

For example, how would you create a regular expression to match the character \texttt{"."} if it is defined to match any character except newline. You would need to escape it with \texttt{\textbackslash{}.}. However, the backslash is a special character in a string. Therefore you need the string \texttt{"\textbackslash{}\textbackslash{}."} to represent the regular expression \texttt{\textbackslash{}.}. The same logic is applied when representing metacharacters such as \texttt{\textbackslash{}d}, \texttt{\textbackslash{}D}, \texttt{\textbackslash{}w}, \texttt{\textbackslash{}W}, etc. You need to use ``\textbackslash{}'' to represent \texttt{\textbackslash{}} in regular expressions.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_view\_all}\NormalTok{(x, }\StringTok{"."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

To represent a backslash \texttt{\textbackslash{}} as a regular expression, two levels of escape would be required!

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_view}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{anchors}{%
\section{Anchors}\label{anchors}}

Regular expressions will match any part of a string unless you use anchors to specify positions such as the start or end of the string. Instead of characters, anchors are used to specify position.

\begin{longtable}[]{@{}cl@{}}
\toprule
Regex & Position \\
\midrule
\endhead
\texttt{\^{}} & start of string \\
\texttt{\$} & end of string \\
\texttt{\textbackslash{}b} & word boundaries \\
\texttt{\textbackslash{}B} & non-word boundaries \\
\bottomrule
\end{longtable}

You can use \texttt{\^{}} to match the start of a string and \texttt{\$} to match the end of a string. For a complete match, you could anchor a regular expression with \texttt{\^{}...\$}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_view\_all}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"apple"}\NormalTok{, }\StringTok{"apple pie"}\NormalTok{, }\StringTok{"juicy apple"}\NormalTok{), }\StringTok{"apple"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\texttt{\textbackslash{}b} is used to match a position known as word boundary. You can use \texttt{\textbackslash{}b} to match the start or end of a word. You can think of \texttt{\textbackslash{}B} as the inverse of \texttt{\textbackslash{}b} and basically it matches any position that \texttt{\textbackslash{}b} does not.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_view\_all}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"apple"}\NormalTok{, }\StringTok{"pineapple"}\NormalTok{, }\StringTok{"juicy apple"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{bapple}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{b"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{quantifies}{%
\section{Quantifies}\label{quantifies}}

You can use quantifiers to specify the number of times a pattern matches.

\begin{longtable}[]{@{}cl@{}}
\toprule
Regex & Number of times \\
\midrule
\endhead
\texttt{+} & one or more \\
\texttt{*} & zero or more \\
\texttt{?} & zero or one \\
\texttt{\{m\}} & exactly \texttt{m} \\
\texttt{\{m,\}} & at least \texttt{m} (\texttt{m} or more) \\
\texttt{\{m,n\}} & between \texttt{m} and \texttt{n} (both inclusive) \\
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_view}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"abb"}\NormalTok{, }\StringTok{"abbb"}\NormalTok{), }\StringTok{"ab+"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

By default, quantifies are applied to a single character. You can use \texttt{(...)} to apply quantifies to more than one character.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_view}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"ab"}\NormalTok{, }\StringTok{"abab"}\NormalTok{, }\StringTok{"ababab"}\NormalTok{), }\StringTok{"ab+"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{functions}{%
\chapter{Functions}\label{functions}}

Writing functions is a simple way to automate commonly used code in a more general way. Therefore, you should write a function when you realized that you are copying and pasting a code block more than once. Particularly, you will see the power of functions as we start writing functions to define building energy efficient measures that we wish to apply to the building energy simulation.

Additionally, using functions helps you to avoid making mistakes that happen all too often when copying and pasting code. Additionally, as your requirements change, you only need to update the code in one place (i.e., within the function) instead of searching and updating pieces of code, which is again error-prone.

\hypertarget{prerequisites-5}{%
\section{Prerequisites}\label{prerequisites-5}}

We will use base R code to illustrate creating user-defined functions. Therefore, no additional packages are required.

\hypertarget{user-defined-function}{%
\section{User-defined function}\label{user-defined-function}}

The code block below shows the syntax for creating an R user-defined function using the \texttt{function} keyword. In general, a function
* Function name (\texttt{function\_name}): This is the name of the function that you will be creating and the name that you will use to call the function. Following section \ref{style}, function names will use \texttt{snake\_case} and be reflective of what it does.
* Function arguments (\texttt{arg1}, \texttt{arg2}, \texttt{...}): These are inputs to the function that will be used by the code that you place inside the function.
* Function body: You place your code inside the body of a function that is enclosed by braces \texttt{\{Function\ body\}}
* Return statement: Unlike other programming languages, it is not necessary to include the \texttt{return()} statement in R. R automatically returns the last line of the body of the function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{function\_name }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(arg1, arg2, ...)\{}
\NormalTok{  Function body}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{examples}{%
\section{Examples}\label{examples}}

The Coefficient of Variation of the Root-Mean-Square Error (CVRMSE) (equation \eqref{eq:cvrmse}) and Normalized mean bias error (NMBE) (equation \eqref{eq:nmbe}) are two of the most widely used indices when evaluating how well an energy models describes the variability in measured data \citep{ashrae_ashrae_2014}. As an example, we demonstrate how these equations would translate to a user-defined function in R.

\begin{equation} 
  \sqrt{\frac{\sum_{i=1}^{n} \left(y_i - \hat{y}_i\right)}{(n-p)}} \Big/ \bar{y}
  \label{eq:cvrmse}
\end{equation}

\begin{equation} 
  \frac{\sum_{i=1}^{n} \left(y_i - \hat{y}_i\right)}{(n-p)\times\bar{y}}
  \label{eq:nmbe}
\end{equation}

where \(n\) is the number of observations; \(y_i\) is the \(i\)th observation; \(\hat{y_i}\) is the \(i\)th prediction; \(\bar{y}\) is the mean of the observed values.

You can use a function to compute CVRMSE as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cvrmse }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(meas, pred, }\AttributeTok{p =} \DecValTok{1}\NormalTok{) \{}
\NormalTok{  se }\OtherTok{\textless{}{-}}\NormalTok{ (meas }\SpecialCharTok{{-}}\NormalTok{ pred)}\SpecialCharTok{\^{}}\DecValTok{2}
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(se)}
  \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{sum}\NormalTok{(se) }\SpecialCharTok{/}\NormalTok{ (n }\SpecialCharTok{{-}}\NormalTok{ p)) }\SpecialCharTok{/} \FunctionTok{mean}\NormalTok{(meas) }\CommentTok{\# last line automatically returned}
\NormalTok{\}}

\FunctionTok{cvrmse}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{6}\NormalTok{))}
\DocumentationTok{\#\# [1] 1.322876}
\end{Highlighting}
\end{Shaded}

You can use a function to compute NMBE as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nmbe }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(meas, pred, }\AttributeTok{p =} \DecValTok{1}\NormalTok{) \{}
\NormalTok{  be }\OtherTok{\textless{}{-}}\NormalTok{ (meas }\SpecialCharTok{{-}}\NormalTok{ pred)}
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(be)}
\NormalTok{  (}\FunctionTok{sum}\NormalTok{(be) }\SpecialCharTok{/}\NormalTok{ (n }\SpecialCharTok{{-}}\NormalTok{ p)) }\SpecialCharTok{/} \FunctionTok{mean}\NormalTok{(meas) }\CommentTok{\# last line automatically returned}
\NormalTok{\}}
\FunctionTok{nmbe}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{6}\NormalTok{))}
\DocumentationTok{\#\# [1] {-}1.5}
\end{Highlighting}
\end{Shaded}

\hypertarget{manipulate}{%
\chapter{Manipulating Data}\label{manipulate}}

Data-preprocessing is an important step in any data science process. Rarely will you receive data that is in the exact form that you need. More often than not, you would need to pre-process the data by transforming and manipulating them so that they are easier to work with. This will be the focus in this chapter.

\hypertarget{prerequisites-6}{%
\section{Prerequisites}\label{prerequisites-6}}

In this chapter we focus on the use of the \textbf{dplyr} package that forms a core part of the \textbf{tidyverse} package. \textbf{dplyr} provides function that alleviates the challenges of data manipulation.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(lubridate)}
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

To explore the basic data manipulation capabilities of dplyr package, we will use the \texttt{building\_meter} dataset. If the following code returns \texttt{FALSE}, you should refer to the section \protect\hyperlink{finding-your-file}{Finding your file} in the \protect\hyperlink{preface}{Preface} on where you can download the datasets.

that can be downloaded from XXX. This dataset contains 8,760 time-series observations of typical building meter measurements that is simulated using the Department of Energy's (DOE) reference building energy model for medium sized offices \citep{deru_us_2011}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bldg }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"building\_meter.csv"}\NormalTok{))}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# {-}{-} Column specification {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# cols(}
\DocumentationTok{\#\#   \textasciigrave{}Date/Time\textasciigrave{} = col\_datetime(format = ""),}
\DocumentationTok{\#\#   \textasciigrave{}Cooling:Electricity [J](Hourly)\textasciigrave{} = col\_double(),}
\DocumentationTok{\#\#   \textasciigrave{}Heating:NaturalGas [J](Hourly)\textasciigrave{} = col\_double(),}
\DocumentationTok{\#\#   \textasciigrave{}Heating:Electricity [J](Hourly)\textasciigrave{} = col\_double(),}
\DocumentationTok{\#\#   \textasciigrave{}InteriorLights:Electricity [J](Hourly)\textasciigrave{} = col\_double(),}
\DocumentationTok{\#\#   \textasciigrave{}ExteriorLights:Electricity [J](Hourly)\textasciigrave{} = col\_double(),}
\DocumentationTok{\#\#   \textasciigrave{}InteriorEquipment:Electricity [J](Hourly)\textasciigrave{} = col\_double(),}
\DocumentationTok{\#\#   \textasciigrave{}Fans:Electricity [J](Hourly)\textasciigrave{} = col\_double(),}
\DocumentationTok{\#\#   \textasciigrave{}Pumps:Electricity [J](Hourly)\textasciigrave{} = col\_double(),}
\DocumentationTok{\#\#   \textasciigrave{}WaterSystems:NaturalGas [J](Hourly)\textasciigrave{} = col\_double()}
\DocumentationTok{\#\# )}
\NormalTok{bldg}
\DocumentationTok{\#\# \# A tibble: 8,760 x 10}
\DocumentationTok{\#\#    \textasciigrave{}Date/Time\textasciigrave{}         \textasciigrave{}Cooling:Electrici\textasciitilde{} \textasciigrave{}Heating:NaturalG\textasciitilde{} \textasciigrave{}Heating:Electric\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00                   0          13517796.         182286476.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00                   0          17717617.         177367416.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00                   0          25310615.         235785509 }
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00                   0          20001989.         184762495.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00                   0          27925599.         245249657.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00                   0          21886933.         190670331.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00                   0          29745424.         252272477.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Spaces make it difficult to

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_name }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(}\FunctionTok{names}\NormalTok{(bldg), }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{W}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{W?"}\NormalTok{, }\StringTok{"\_"}\NormalTok{)}
\FunctionTok{names}\NormalTok{(bldg) }\OtherTok{\textless{}{-}} \FunctionTok{str\_remove\_all}\NormalTok{(new\_name, }\StringTok{"\_Hourly\_"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-transformation}{%
\section{Data transformation}\label{data-transformation}}

The \href{https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf}{cheat sheet for dplyr} provides a good summary of data transformation functions covered in this chapter.

\begin{itemize}
\tightlist
\item
  \texttt{select()}: To select columns based on their names.
\item
  \texttt{filter()}: To subset rows based on their values.
\item
  \texttt{mutate()}: To add new variables whose values are a function of existing variables.
\item
  \texttt{arrange()}: To sort the dataset based on the values of selected columns
\item
  \texttt{summarise()}:
\item
  \texttt{join.R}: generic functions that joins two tables together
\end{itemize}

\hypertarget{select}{%
\subsection{\texorpdfstring{\texttt{select()}}{select()}}\label{select}}

You can use the function \texttt{select()} to choose the variables to retain in the dataset based on their names. It is not uncommon to get datasets with hundred or thousands of variables. An example is when working with data from the building management system. Under these scenarios, it is often very useful to narrow down the dataset to contain only the variables of interest. \texttt{select()} allows you to do this very easily, to zoom in on the variables or columns of interest.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(bldg, Date\_Time, Cooling\_Electricity\_J, Heating\_Electricity\_J)}
\DocumentationTok{\#\# \# A tibble: 8,760 x 3}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricity\_J Heating\_Electricity\_J}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                              \textless{}dbl\textgreater{}                 \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00                     0            182286476.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00                     0            177367416.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00                     0            235785509 }
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00                     0            184762495.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00                     0            245249657.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00                     0            190670331.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00                     0            252272477.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can also optionally rename columns with the \texttt{select()} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(bldg,}
  \AttributeTok{datetime =}\NormalTok{ Date\_Time,}
  \AttributeTok{cooling =}\NormalTok{ Cooling\_Electricity\_J,}
  \AttributeTok{heating =}\NormalTok{ Heating\_Electricity\_J}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 8,760 x 3}
\DocumentationTok{\#\#    datetime            cooling    heating}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00       0 182286476.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00       0 177367416.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00       0 235785509 }
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00       0 184762495.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00       0 245249657.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00       0 190670331.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00       0 252272477.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Additionally, tidyverse provides helper functions that lets you select columns by matching patterns in their names. For the following selection helper functions, a character vector is provided for the match. If \texttt{length()} of the character vector is larger than 1, the logical union (OR \texttt{\textbar{}} operator) is taken.

\begin{itemize}
\tightlist
\item
  \texttt{starts\_with()}: Select columns that starts with a specific character vector
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(bldg, }\FunctionTok{starts\_with}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"Heating"}\NormalTok{, }\StringTok{"Cooling"}\NormalTok{)))}
\DocumentationTok{\#\# \# A tibble: 8,760 x 3}
\DocumentationTok{\#\#    Heating\_NaturalGas\_J Heating\_Electricity\_J Cooling\_Electricity\_J}
\DocumentationTok{\#\#                   \textless{}dbl\textgreater{}                 \textless{}dbl\textgreater{}                 \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1            13517796.            182286476.                     0}
\DocumentationTok{\#\#  2            17717617.            177367416.                     0}
\DocumentationTok{\#\#  3            25310615.            235785509                      0}
\DocumentationTok{\#\#  4            20001989.            184762495.                     0}
\DocumentationTok{\#\#  5            27925599.            245249657.                     0}
\DocumentationTok{\#\#  6            21886933.            190670331.                     0}
\DocumentationTok{\#\#  7            29745424.            252272477.                     0}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{ends\_with()}: Select columns that ends with a specific character vector
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(bldg, }\FunctionTok{ends\_with}\NormalTok{(}\StringTok{"Time"}\NormalTok{))}
\DocumentationTok{\#\# \# A tibble: 8,760 x 1}
\DocumentationTok{\#\#    Date\_Time          }
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}             }
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00}
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{contains()}: Select columns that contains a specific character vector
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(}
\NormalTok{  bldg,}
  \FunctionTok{contains}\NormalTok{(}
    \FunctionTok{c}\NormalTok{(}
      \StringTok{"Time"}\NormalTok{,}
      \StringTok{"electricity"}
\NormalTok{    )}
\NormalTok{  )}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 8,760 x 8}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electrici\textasciitilde{} Heating\_Electrici\textasciitilde{} InteriorLights\_Ele\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                           \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}               \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00                  0         182286476.            9649498.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00                  0         177367416.            9649498.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00                  0         235785509             9649498.}
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00                  0         184762495.            9649498.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00                  0         245249657.            9649498.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00                  0         190670331.            9649498.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00                  0         252272477.            9649498.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{matches()}: Select columns that matches a regular expression. \texttt{rename()} is a dplyr function that allows you to change the names of individual columns using \texttt{new\_name} = \texttt{old\_name}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg\_ex }\OtherTok{\textless{}{-}} \StringTok{"[dD]ate.?[tT]ime"}

\FunctionTok{select}\NormalTok{(bldg, }\FunctionTok{matches}\NormalTok{(reg\_ex, }\AttributeTok{ignore.case =} \ConstantTok{FALSE}\NormalTok{))}
\DocumentationTok{\#\# \# A tibble: 8,760 x 1}
\DocumentationTok{\#\#    Date\_Time          }
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}             }
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00}
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00}
\NormalTok{....}

\NormalTok{bldg\_rename\_a }\OtherTok{\textless{}{-}} \FunctionTok{rename}\NormalTok{(bldg, }\StringTok{\textasciigrave{}}\AttributeTok{Date/Time}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{\textasciigrave{}}\AttributeTok{Date\_Time}\StringTok{\textasciigrave{}}\NormalTok{)}
\FunctionTok{select}\NormalTok{(bldg\_rename\_a, }\FunctionTok{matches}\NormalTok{(reg\_ex, }\AttributeTok{ignore.case =} \ConstantTok{FALSE}\NormalTok{))}
\DocumentationTok{\#\# \# A tibble: 8,760 x 1}
\DocumentationTok{\#\#    \textasciigrave{}Date/Time\textasciigrave{}        }
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}             }
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00}
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00}
\NormalTok{....}


\NormalTok{bldg\_rename\_b }\OtherTok{\textless{}{-}} \FunctionTok{rename}\NormalTok{(bldg, }\StringTok{\textasciigrave{}}\AttributeTok{datetime}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{\textasciigrave{}}\AttributeTok{Date\_Time}\StringTok{\textasciigrave{}}\NormalTok{)}
\FunctionTok{select}\NormalTok{(bldg\_rename\_b, }\FunctionTok{matches}\NormalTok{(reg\_ex, }\AttributeTok{ignore.case =} \ConstantTok{FALSE}\NormalTok{))}
\DocumentationTok{\#\# \# A tibble: 8,760 x 1}
\DocumentationTok{\#\#    datetime           }
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}             }
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00}
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{all\_of()} and \texttt{any\_of()}: You can also select variables from a character vector using the selection helper functions \texttt{all\_of()} and \texttt{any\_of()}. The key difference is that \texttt{all\_of()} is used for strict selection where an error is thrown for variable names that do not exist. In contrast, \texttt{any\_of()} does not check for missing variable names, and thus is often used to ensure a specific column is removed.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Heating\_NaturalGas\_J"}\NormalTok{, }\StringTok{"WaterSystems\_NaturalGas\_J"}\NormalTok{)}
\FunctionTok{select}\NormalTok{(bldg, }\FunctionTok{all\_of}\NormalTok{(vars))}
\DocumentationTok{\#\# \# A tibble: 8,760 x 2}
\DocumentationTok{\#\#    Heating\_NaturalGas\_J WaterSystems\_NaturalGas\_J}
\DocumentationTok{\#\#                   \textless{}dbl\textgreater{}                     \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1            13517796.                    72000 }
\DocumentationTok{\#\#  2            17717617.                    72000 }
\DocumentationTok{\#\#  3            25310615.                  3970732.}
\DocumentationTok{\#\#  4            20001989.                    72000 }
\DocumentationTok{\#\#  5            27925599.                  3970995.}
\DocumentationTok{\#\#  6            21886933.                    72000 }
\DocumentationTok{\#\#  7            29745424.                  3970782.}
\NormalTok{....}

\FunctionTok{select}\NormalTok{(bldg, }\SpecialCharTok{{-}}\FunctionTok{any\_of}\NormalTok{(vars))}
\DocumentationTok{\#\# \# A tibble: 8,760 x 8}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electrici\textasciitilde{} Heating\_Electrici\textasciitilde{} InteriorLights\_Ele\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                           \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}               \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00                  0         182286476.            9649498.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00                  0         177367416.            9649498.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00                  0         235785509             9649498.}
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00                  0         184762495.            9649498.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00                  0         245249657.            9649498.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00                  0         190670331.            9649498.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00                  0         252272477.            9649498.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{where()} is a very useful selection helper function when you want to apply a function (that returns \texttt{TRUE} or \texttt{FALSE}) to all columns and select only those columns where the function returns \texttt{TRUE}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(bldg, }\FunctionTok{where}\NormalTok{(is.numeric))}
\DocumentationTok{\#\# \# A tibble: 8,760 x 9}
\DocumentationTok{\#\#    Cooling\_Electrici\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{} InteriorLights\_Elec\textasciitilde{}}
\DocumentationTok{\#\#                 \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}                \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1                  0          13517796.         182286476.             9649498.}
\DocumentationTok{\#\#  2                  0          17717617.         177367416.             9649498.}
\DocumentationTok{\#\#  3                  0          25310615.         235785509              9649498.}
\DocumentationTok{\#\#  4                  0          20001989.         184762495.             9649498.}
\DocumentationTok{\#\#  5                  0          27925599.         245249657.             9649498.}
\DocumentationTok{\#\#  6                  0          21886933.         190670331.             9649498.}
\DocumentationTok{\#\#  7                  0          29745424.         252272477.             9649498.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can also define the function to be applied within \texttt{where()}

\begin{Shaded}
\begin{Highlighting}[]

\FunctionTok{select}\NormalTok{(}
\NormalTok{  bldg,}
  \FunctionTok{where}\NormalTok{(}
    \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{is.numeric}\NormalTok{(x)}
\NormalTok{  )}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 8,760 x 9}
\DocumentationTok{\#\#    Cooling\_Electrici\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{} InteriorLights\_Elec\textasciitilde{}}
\DocumentationTok{\#\#                 \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}                \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1                  0          13517796.         182286476.             9649498.}
\DocumentationTok{\#\#  2                  0          17717617.         177367416.             9649498.}
\DocumentationTok{\#\#  3                  0          25310615.         235785509              9649498.}
\DocumentationTok{\#\#  4                  0          20001989.         184762495.             9649498.}
\DocumentationTok{\#\#  5                  0          27925599.         245249657.             9649498.}
\DocumentationTok{\#\#  6                  0          21886933.         190670331.             9649498.}
\DocumentationTok{\#\#  7                  0          29745424.         252272477.             9649498.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{filter}{%
\subsection{\texorpdfstring{\texttt{filter()}}{filter()}}\label{filter}}

You can use \texttt{filter()} to subset rows based on their values. dplyr's \texttt{filter()} function retains rows that return \texttt{TRUE} for all the conditions specified. The first argument is the data frame and the subsequent arguments are the conditions that are used to subset the observations. In other words, multiple arguments to \texttt{filter()} are combined by the \texttt{\&} (and) logical operator. To work with other logical operators such as \texttt{\textbar{}} (or) and \texttt{!} (not), you would have to combine them within a single argument.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(bldg, Cooling\_Electricity\_J }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 2,678 x 10}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}02{-}11 15:00:00            4354833.                  0          91807743.}
\DocumentationTok{\#\#  2 2020{-}02{-}11 16:00:00            2387624.                  0          94118327.}
\DocumentationTok{\#\#  3 2020{-}02{-}23 09:00:00            7606370.                  0         102607149.}
\DocumentationTok{\#\#  4 2020{-}02{-}23 10:00:00           21074975.                  0          76304715.}
\DocumentationTok{\#\#  5 2020{-}02{-}23 11:00:00           23052733.                  0          63182232.}
\DocumentationTok{\#\#  6 2020{-}02{-}23 12:00:00           23185185.                  0          53130886.}
\DocumentationTok{\#\#  7 2020{-}02{-}23 13:00:00           20501352.                  0          68037068.}
\NormalTok{....}
\FunctionTok{filter}\NormalTok{(bldg, InteriorLights\_Electricity\_J }\SpecialCharTok{\textgreater{}} \DecValTok{100000000}\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 2,520 x 10}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}02 09:00:00                   0         128483630.         473529413.}
\DocumentationTok{\#\#  2 2020{-}01{-}02 10:00:00                   0         109562756.         398893378.}
\DocumentationTok{\#\#  3 2020{-}01{-}02 11:00:00                   0          88363562.         350234124.}
\DocumentationTok{\#\#  4 2020{-}01{-}02 12:00:00                   0          75198754.         305357974 }
\DocumentationTok{\#\#  5 2020{-}01{-}02 13:00:00                   0          70573992.         300958898.}
\DocumentationTok{\#\#  6 2020{-}01{-}02 14:00:00                   0          84277786.         249050033.}
\DocumentationTok{\#\#  7 2020{-}01{-}02 15:00:00                   0          99713290.         238506555.}
\NormalTok{....}

\FunctionTok{filter}\NormalTok{(}
\NormalTok{  bldg, Cooling\_Electricity\_J }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{,}
\NormalTok{  Cooling\_Electricity\_J }\SpecialCharTok{\textless{}} \DecValTok{4000000} \SpecialCharTok{|}
\NormalTok{    Cooling\_Electricity\_J }\SpecialCharTok{\textgreater{}} \DecValTok{22000000}\NormalTok{,}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 2,428 x 10}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}02{-}11 16:00:00            2387624.                  0          94118327.}
\DocumentationTok{\#\#  2 2020{-}02{-}23 11:00:00           23052733.                  0          63182232.}
\DocumentationTok{\#\#  3 2020{-}02{-}23 12:00:00           23185185.                  0          53130886.}
\DocumentationTok{\#\#  4 2020{-}02{-}23 20:00:00            1387715.                  0         101207501.}
\DocumentationTok{\#\#  5 2020{-}03{-}10 12:00:00           25148879.                  0          17802883.}
\DocumentationTok{\#\#  6 2020{-}03{-}10 13:00:00           31261163.                  0          15048079.}
\DocumentationTok{\#\#  7 2020{-}03{-}10 14:00:00           30172661.                  0           1791300.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Often, the ability to subset observations based on their timestamp is a very useful feature when working with timeseries data

\begin{Shaded}
\begin{Highlighting}[]

\FunctionTok{filter}\NormalTok{(bldg, }\FunctionTok{month}\NormalTok{(Date\_Time) }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, }\FunctionTok{day}\NormalTok{(Date\_Time) }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 24 x 10}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00                   0          13517796.         182286476.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00                   0          17717617.         177367416.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00                   0          25310615.         235785509 }
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00                   0          20001989.         184762495.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00                   0          27925599.         245249657.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00                   0          21886933.         190670331.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00                   0          29745424.         252272477.}
\NormalTok{....}
\FunctionTok{filter}\NormalTok{(bldg, }\FunctionTok{day}\NormalTok{(Date\_Time) }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 287 x 10}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00                   0          13517796.         182286476.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00                   0          17717617.         177367416.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00                   0          25310615.         235785509 }
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00                   0          20001989.         184762495.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00                   0          27925599.         245249657.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00                   0          21886933.         190670331.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00                   0          29745424.         252272477.}
\NormalTok{....}
\FunctionTok{filter}\NormalTok{(bldg, }\FunctionTok{month}\NormalTok{(Date\_Time) }\SpecialCharTok{\textgreater{}} \DecValTok{4}\NormalTok{, }\FunctionTok{month}\NormalTok{(Date\_Time) }\SpecialCharTok{\textless{}} \DecValTok{10}\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 3,672 x 10}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}05{-}01 00:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  2 2020{-}05{-}01 01:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  3 2020{-}05{-}01 02:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  4 2020{-}05{-}01 03:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  5 2020{-}05{-}01 04:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  6 2020{-}05{-}01 05:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  7 2020{-}05{-}01 06:00:00                  0                   0         252935532.}
\NormalTok{....}
\FunctionTok{filter}\NormalTok{(bldg, }\FunctionTok{month}\NormalTok{(Date\_Time) }\SpecialCharTok{\textgreater{}} \DecValTok{4} \SpecialCharTok{\&} \FunctionTok{month}\NormalTok{(Date\_Time) }\SpecialCharTok{\textless{}} \DecValTok{10}\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 3,672 x 10}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}05{-}01 00:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  2 2020{-}05{-}01 01:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  3 2020{-}05{-}01 02:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  4 2020{-}05{-}01 03:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  5 2020{-}05{-}01 04:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  6 2020{-}05{-}01 05:00:00                  0                   0                 0 }
\DocumentationTok{\#\#  7 2020{-}05{-}01 06:00:00                  0                   0         252935532.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can also combine \texttt{filter()} with \texttt{grepl()} to subset rows using regular expressions.

\hypertarget{arrange}{%
\subsection{\texorpdfstring{\texttt{arrange()}}{arrange()}}\label{arrange}}

You can use \texttt{arrange()} to sort the dataset based on the values of selected columns. The first argument is the data frame and the second is the column name to sort the data frame by. If more than one column name is provided, subsequent column names will be used to break ties in the preceeding columns.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(bldg, Cooling\_Electricity\_J)}
\DocumentationTok{\#\# \# A tibble: 8,760 x 10}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00                   0          13517796.         182286476.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00                   0          17717617.         177367416.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00                   0          25310615.         235785509 }
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00                   0          20001989.         184762495.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00                   0          27925599.         245249657.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00                   0          21886933.         190670331.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00                   0          29745424.         252272477.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can use \texttt{desc()} to order a column in descending order

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(bldg, }\FunctionTok{desc}\NormalTok{(Cooling\_Electricity\_J))}
\DocumentationTok{\#\# \# A tibble: 8,760 x 10}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}07{-}19 16:00:00          356330907.                  0                  0}
\DocumentationTok{\#\#  2 2020{-}07{-}19 15:00:00          349038364.                  0                  0}
\DocumentationTok{\#\#  3 2020{-}07{-}18 16:00:00          339376366.                  0                  0}
\DocumentationTok{\#\#  4 2020{-}07{-}19 17:00:00          338918865.                  0                  0}
\DocumentationTok{\#\#  5 2020{-}07{-}17 15:00:00          337245696.                  0                  0}
\DocumentationTok{\#\#  6 2020{-}07{-}18 14:00:00          336127683.                  0                  0}
\DocumentationTok{\#\#  7 2020{-}07{-}17 16:00:00          335013419.                  0                  0}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{mutate}{%
\subsection{\texorpdfstring{\texttt{mutate()}}{mutate()}}\label{mutate}}

You can use \texttt{mutate()} to add new variables whose values are a function of existing variables (Note that you can also refer to newly created variables). The newly created variables will be added to the end of the dataset.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mutate}\NormalTok{(bldg,}
  \AttributeTok{Total\_Heating\_J =}\NormalTok{ Heating\_NaturalGas\_J }\SpecialCharTok{+}\NormalTok{ Heating\_Electricity\_J,}
  \AttributeTok{Cooling\_Heating\_kWh =}\NormalTok{ (Total\_Heating\_J }\SpecialCharTok{+}\NormalTok{ Cooling\_Electricity\_J) }\SpecialCharTok{*} \FloatTok{2.77778e{-}7}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 8,760 x 12}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00                   0          13517796.         182286476.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00                   0          17717617.         177367416.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00                   0          25310615.         235785509 }
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00                   0          20001989.         184762495.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00                   0          27925599.         245249657.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00                   0          21886933.         190670331.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00                   0          29745424.         252272477.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can use \texttt{transmute()} if you only want to keep the new variables in your dataset.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{transmute}\NormalTok{(bldg,}
  \AttributeTok{Total\_Heating\_J =}\NormalTok{ Heating\_NaturalGas\_J }\SpecialCharTok{+}\NormalTok{ Heating\_Electricity\_J,}
  \AttributeTok{Cooling\_Heating\_kWh =}\NormalTok{ (Total\_Heating\_J }\SpecialCharTok{+}\NormalTok{ Cooling\_Electricity\_J) }\SpecialCharTok{*} \FloatTok{2.77778e{-}7}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 8,760 x 2}
\DocumentationTok{\#\#    Total\_Heating\_J Cooling\_Heating\_kWh}
\DocumentationTok{\#\#              \textless{}dbl\textgreater{}               \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1      195804272.                54.4}
\DocumentationTok{\#\#  2      195085034.                54.2}
\DocumentationTok{\#\#  3      261096124.                72.5}
\DocumentationTok{\#\#  4      204764484.                56.9}
\DocumentationTok{\#\#  5      273175257.                75.9}
\DocumentationTok{\#\#  6      212557265.                59.0}
\DocumentationTok{\#\#  7      282017901.                78.3}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Useful mutate functions include
- Arithmetic operators (\texttt{+}, \texttt{-}, *\texttt{,}/\texttt{,\ etc.)\ and\ logarithms\ (}log()\texttt{,}log2()\texttt{,\ etc.)\ -}lead()\texttt{and}lag()\texttt{,\ allowing\ you\ to\ create\ lead\ and\ lag\ variables\ that\ are\ useful\ especially\ when\ working\ with\ timeseries\ data.\ -}if\_else()\texttt{and}case\_when()`

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heat }\OtherTok{\textless{}{-}} \FunctionTok{transmute}\NormalTok{(bldg,}
  \AttributeTok{Total\_Heating\_J =}\NormalTok{ Heating\_NaturalGas\_J }\SpecialCharTok{+}\NormalTok{ Heating\_Electricity\_J}
\NormalTok{)}

\FunctionTok{mutate}\NormalTok{(}
\NormalTok{  heat,}
  \AttributeTok{lag\_1 =} \FunctionTok{lag}\NormalTok{(Total\_Heating\_J),}
  \AttributeTok{lag\_2 =} \FunctionTok{lag}\NormalTok{(lag\_1),}
  \AttributeTok{lag\_3 =} \FunctionTok{lag}\NormalTok{(Total\_Heating\_J, }\DecValTok{3}\NormalTok{)}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 8,760 x 4}
\DocumentationTok{\#\#    Total\_Heating\_J      lag\_1      lag\_2      lag\_3}
\DocumentationTok{\#\#              \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{}      \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1      195804272.        NA         NA         NA }
\DocumentationTok{\#\#  2      195085034. 195804272.        NA         NA }
\DocumentationTok{\#\#  3      261096124. 195085034. 195804272.        NA }
\DocumentationTok{\#\#  4      204764484. 261096124. 195085034. 195804272.}
\DocumentationTok{\#\#  5      273175257. 204764484. 261096124. 195085034.}
\DocumentationTok{\#\#  6      212557265. 273175257. 204764484. 261096124.}
\DocumentationTok{\#\#  7      282017901. 212557265. 273175257. 204764484.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

TODO: Example of use of \texttt{if\_else()} and \texttt{case\_when()} in \texttt{mutate()} pipe

\hypertarget{summarise-and-group_by}{%
\subsection{\texorpdfstring{\texttt{summarise()} and \texttt{group\_by()}}{summarise() and group\_by()}}\label{summarise-and-group_by}}

\texttt{summarise()} or \texttt{summarize()} collapse a data frame into one row for each combination of grouping variables. Therefore, it is not very useful by itself.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summarise}\NormalTok{(bldg,}
  \AttributeTok{Heating\_Total =} \FunctionTok{sum}\NormalTok{(Heating\_Electricity\_J),}
  \AttributeTok{Heating\_Avg =} \FunctionTok{mean}\NormalTok{(Heating\_Electricity\_J),}
  \AttributeTok{Heating\_Peak =} \FunctionTok{max}\NormalTok{(Heating\_Electricity\_J)}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 1 x 3}
\DocumentationTok{\#\#   Heating\_Total Heating\_Avg Heating\_Peak}
\DocumentationTok{\#\#           \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}}
\DocumentationTok{\#\# 1 508713824519.   58072354.   1002989103}
\end{Highlighting}
\end{Shaded}

However, \texttt{summarise()} combined with \texttt{group\_by()} will allow you to easily summarise data based on individual groups.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bldg\_month }\OtherTok{\textless{}{-}} \FunctionTok{mutate}\NormalTok{(bldg,}
  \AttributeTok{Year =} \FunctionTok{year}\NormalTok{(Date\_Time),}
  \AttributeTok{Month =} \FunctionTok{month}\NormalTok{(Date\_Time)}
\NormalTok{)}

\NormalTok{bldg\_by\_month }\OtherTok{\textless{}{-}} \FunctionTok{group\_by}\NormalTok{(bldg\_month, Year, Month)}

\FunctionTok{summarise}\NormalTok{(bldg\_by\_month,}
  \AttributeTok{Heating\_Total =} \FunctionTok{sum}\NormalTok{(Heating\_Electricity\_J),}
  \AttributeTok{Heating\_Avg =} \FunctionTok{mean}\NormalTok{(Heating\_Electricity\_J),}
  \AttributeTok{Heating\_Peak =} \FunctionTok{max}\NormalTok{(Heating\_Electricity\_J)}
\NormalTok{)}
\DocumentationTok{\#\# \textasciigrave{}summarise()\textasciigrave{} has grouped output by \textquotesingle{}Year\textquotesingle{}. You can override using the \textasciigrave{}.groups\textasciigrave{} argument.}
\DocumentationTok{\#\# \# A tibble: 13 x 5}
\DocumentationTok{\#\# \# Groups:   Year [2]}
\DocumentationTok{\#\#     Year Month Heating\_Total Heating\_Avg Heating\_Peak}
\DocumentationTok{\#\#    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}         \textless{}dbl\textgreater{}       \textless{}dbl\textgreater{}        \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1  2020     1 124527837066.  167601396.   978585992.}
\DocumentationTok{\#\#  2  2020     2  89836688374.  133486907.  1002989103 }
\DocumentationTok{\#\#  3  2020     3  55674915533.   74932592.   795581602.}
\DocumentationTok{\#\#  4  2020     4  32036849861.   44495625.   639342141.}
\DocumentationTok{\#\#  5  2020     5   7726081874.   10384519.   252935532.}
\DocumentationTok{\#\#  6  2020     6    624415414.     867244.    39920827.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{across}{%
\subsection{\texorpdfstring{\texttt{across()}}{across()}}\label{across}}

\texttt{across()} makes it possible to apply functions across multiple columns within the functions \texttt{summarise()} and \texttt{mutate()}, using the semantics in \texttt{filter()} (see section \ref{select}) that makes it easy to refer to columns based on their names.

\begin{Shaded}
\begin{Highlighting}[]

\FunctionTok{mutate}\NormalTok{(bldg,}
  \AttributeTok{total =} \FunctionTok{rowSums}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)))}
\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 8,760 x 11}
\DocumentationTok{\#\#    Date\_Time           Cooling\_Electricit\textasciitilde{} Heating\_NaturalGa\textasciitilde{} Heating\_Electrici\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}                            \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}              \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2020{-}01{-}01 01:00:00                   0          13517796.         182286476.}
\DocumentationTok{\#\#  2 2020{-}01{-}01 02:00:00                   0          17717617.         177367416.}
\DocumentationTok{\#\#  3 2020{-}01{-}01 03:00:00                   0          25310615.         235785509 }
\DocumentationTok{\#\#  4 2020{-}01{-}01 04:00:00                   0          20001989.         184762495.}
\DocumentationTok{\#\#  5 2020{-}01{-}01 05:00:00                   0          27925599.         245249657.}
\DocumentationTok{\#\#  6 2020{-}01{-}01 06:00:00                   0          21886933.         190670331.}
\DocumentationTok{\#\#  7 2020{-}01{-}01 07:00:00                   0          29745424.         252272477.}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You may also pass a list of functions to be applied to each of the selected columns.

\begin{Shaded}
\begin{Highlighting}[]

\FunctionTok{summarise}\NormalTok{(}
\NormalTok{  bldg\_by\_month,}
  \FunctionTok{across}\NormalTok{(}
    \FunctionTok{contains}\NormalTok{(}\StringTok{"electricity"}\NormalTok{),}
    \FunctionTok{list}\NormalTok{(}\AttributeTok{Total =}\NormalTok{ sum, }\AttributeTok{Avg =}\NormalTok{ mean, }\AttributeTok{Peak =}\NormalTok{ max)}
\NormalTok{  )}
\NormalTok{)}
\DocumentationTok{\#\# \textasciigrave{}summarise()\textasciigrave{} has grouped output by \textquotesingle{}Year\textquotesingle{}. You can override using the \textasciigrave{}.groups\textasciigrave{} argument.}
\DocumentationTok{\#\# \# A tibble: 13 x 23}
\DocumentationTok{\#\# \# Groups:   Year [2]}
\DocumentationTok{\#\#     Year Month Cooling\_Electricity\_J\textasciitilde{} Cooling\_Electricity\textasciitilde{} Cooling\_Electricity\_\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}                  \textless{}dbl\textgreater{}                \textless{}dbl\textgreater{}                 \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1  2020     1                     0                    0                     0 }
\DocumentationTok{\#\#  2  2020     2             181014017.              268966.             23185185.}
\DocumentationTok{\#\#  3  2020     3             775169988.             1043297.             79053134.}
\DocumentationTok{\#\#  4  2020     4           11551697867.            16044025.            226399417.}
\DocumentationTok{\#\#  5  2020     5           22952133253.            30849641.            191404162.}
\DocumentationTok{\#\#  6  2020     6           53405646191.            74174509.            302585966 }
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{pipes}{%
\section{Pipes}\label{pipes}}

The \texttt{\%\textgreater{}\%} is a forward pipe operator from the \texttt{magrittr} package that comes loaded with the \texttt{tidyverse} package. The pipe operator \texttt{\%\textgreater{}\%} is a very handy that allows operations to be performed sequentially. In general, you can think of it as sending the output of one function as an input to the next .

With the pipe operator,

Instead of many intermediary steps

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{first\_output }\OtherTok{\textless{}{-}} \FunctionTok{first}\NormalTok{(data)}
\NormalTok{second\_output }\OtherTok{\textless{}{-}} \FunctionTok{second}\NormalTok{(first\_output)}
\NormalTok{final\_result }\OtherTok{\textless{}{-}} \FunctionTok{third}\NormalTok{(second\_output)}
\end{Highlighting}
\end{Shaded}

You can connect multiple operators sequentially using the pipe operator

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{final\_result }\OtherTok{\textless{}{-}} \FunctionTok{first}\NormalTok{(data) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{second}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{third}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Figure \ref{fig:pipe} shows what is happening graphically.

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{figures/pipe} 

}

\caption{Piping data from one function to the next sequentially}\label{fig:pipe}
\end{figure}

An example using the \texttt{bldg} dataset.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{bldg }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(Date\_Time, }\FunctionTok{contains}\NormalTok{(}\StringTok{"Heating"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{Month =} \FunctionTok{month}\NormalTok{(Date\_Time),}
    \AttributeTok{Total\_Heating\_J =} \FunctionTok{rowSums}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)))}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Month) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\FunctionTok{across}\NormalTok{(}
    \FunctionTok{where}\NormalTok{(is.numeric),}
    \FunctionTok{list}\NormalTok{(}\AttributeTok{Total =}\NormalTok{ sum, }\AttributeTok{Peak =}\NormalTok{ max)}
\NormalTok{  ))}
\DocumentationTok{\#\# \# A tibble: 12 x 7}
\DocumentationTok{\#\#    Month Heating\_NaturalG\textasciitilde{} Heating\_NaturalG\textasciitilde{} Heating\_Electric\textasciitilde{} Heating\_Electric\textasciitilde{}}
\DocumentationTok{\#\#    \textless{}dbl\textgreater{}             \textless{}dbl\textgreater{}             \textless{}dbl\textgreater{}             \textless{}dbl\textgreater{}             \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1     1      59660445562.        527825997.     124648935250.        978585992.}
\DocumentationTok{\#\#  2     2      41029360544.        530570172.      89836688374.       1002989103 }
\DocumentationTok{\#\#  3     3       9377325423.        230991815.      55674915533.        795581602.}
\DocumentationTok{\#\#  4     4       3352997015.        156525821       32036849861.        639342141.}
\DocumentationTok{\#\#  5     5          2144014.          2144014.       7726081874.        252935532.}
\DocumentationTok{\#\#  6     6                0                 0         624415414.         39920827.}
\DocumentationTok{\#\#  7     7                0                 0         128302310.         16757642 }
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{part-get-started}{%
\part{Get Started}\label{part-get-started}}

\hypertarget{get-started}{%
\chapter{Introduction}\label{get-started}}

The goal of this part of the book is to get you started working with EnergyPlus in R as quickly as possible. In this part of the book, you will learn how to get your model into R and run the simulation (Chapter \ref{parse}). You will then learn how to extract predifined annual summary reports and manipulate them so that the focus is placed on the important variables and observations (Chapter \ref{summary}). Finally, we provide a gentle introduction to visualizing the data from the summary reports in R (Chapter \ref{visualize}).

Understanding the details of EnergyPlus inputs and outputs and how they are structured are an important part of building energy simulation. We will come back to that in the next part of the book once we have gotten you started up with the basics.

\hypertarget{parse}{%
\chapter{Parse then simulate}\label{parse}}

\hypertarget{prerequisites-7}{%
\section{Prerequisites}\label{prerequisites-7}}

In this chapter we will introduce the \textbf{eplusr} package that was designed to interface with EnergyPlus and ease the application of data driven analytics. If you like to learn more about the underlying theory of how data is structured under the hood, you might enjoy the \emph{eplusr} paper published in the Journal Energy and Buildings \citep{jia_eplusr_2021}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(eplusr)}
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

In this book, you will learn using the U.S. Department of Energy (DOE) Commercial Reference Building for medium office energy model \citep{deru_us_2011}. We use the DOE reference building because it is well established and widely used. More importantly, it is publicly available and comes distributed with EnergyPlus as example files, making the examples and code in this book easier to follow and reproduce.

For your convenience, the model can be found at \texttt{./data/idf/RefBldgMediumOfficeNew2004\_Chicago.idf} relative to the project root folder. Likewise, the weather file that we will be using can be found at \texttt{./data/epw/USA\_IL\_Chicago-OHare.Intl.AP.725300\_TMY3.epw} relative to the project root folder.

\hypertarget{key-energyplus-files}{%
\section{Key EnergyPlus files}\label{key-energyplus-files}}

Before starting to work with EnergyPlus, there are three main EnergyPlus files that you should know: the input data dictionary (IDD), the input data file (IDF), and the EnergyPlus weather file (EPW). All three files are ASCII files also know as text files. The IDD lists all possible objects in EnergyPlus along with their respective input requirements. The IDF provides a description of the building to be simulated. The EPW contains the hourly or sub-hourly weather data (i.e., the boundary conditions) needed for the simulation.

\hypertarget{parsing-the-model}{%
\section{Parsing the model}\label{parsing-the-model}}

Before starting, you need to first tell R where EnergyPlus is located.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{use\_eplus}\NormalTok{(}\StringTok{"/Applications/EnergyPlus{-}9{-}4{-}0"}\NormalTok{)}
\DocumentationTok{\#\# Configure data of EnergyPlus v9.4.0 located at \textquotesingle{}/Applications/EnergyPlus{-}9{-}4{-}0\textquotesingle{} already exists. No Updating performed.}
\end{Highlighting}
\end{Shaded}

To get started, you need to first be familiar with the three basic classes (\texttt{Idf}, \texttt{Epw}, and the \texttt{EplusJob}) of the eplusr package.

The \texttt{Idf} class is used to represent the EnergyPlus model. It contains methods that allows you to easily query and modify the model. You can use the \texttt{read\_idf()} function to parse the EnergyPlus model into R by providing the file path to the EnergyPlus IDF file. You can use the function \texttt{here()} to easily reference the file path relative to the project root folder.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_idf }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"idf"}\NormalTok{, }\StringTok{"RefBldgMediumOfficeNew2004\_Chicago.idf"}\NormalTok{)}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{read\_idf}\NormalTok{(path\_idf)}
\DocumentationTok{\#\# IDD v9.4.0 has not been parsed before.}
\DocumentationTok{\#\# Try to locate \textquotesingle{}Energy+.idd\textquotesingle{} in EnergyPlus v9.4.0 installation folder \textquotesingle{}/Applications/EnergyPlus{-}9{-}4{-}0\textquotesingle{}.}
\DocumentationTok{\#\# IDD file found: \textquotesingle{}/Applications/EnergyPlus{-}9{-}4{-}0/Energy+.idd\textquotesingle{}.}
\DocumentationTok{\#\# Start parsing...}
\DocumentationTok{\#\# Parsing completed.}
\end{Highlighting}
\end{Shaded}

The \texttt{Epw} class is used to represent the weather data that will be used for the simulation. You can use the \texttt{read\_epw()} function to parse an EPW weather file into R by providing the file path to the EnergyPlus EPW file. Likewise, the function \texttt{here()} is used to easily reference the file path relative to the project root folder.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_epw }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"epw"}\NormalTok{, }\StringTok{"USA\_IL\_Chicago{-}OHare.Intl.AP.725300\_TMY3.epw"}\NormalTok{)}
\NormalTok{epw }\OtherTok{\textless{}{-}} \FunctionTok{read\_epw}\NormalTok{(path\_epw)}
\end{Highlighting}
\end{Shaded}

The \texttt{EplusJob} is used extract the simulation results. When you run the model, a \texttt{EplusJob} object is returned. One way to run the model is to use the \texttt{\$run()} method of the \texttt{Idf} class, and provide the weather file in the form of an \texttt{epw} object.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{job }\OtherTok{\textless{}{-}}\NormalTok{ model}\SpecialCharTok{$}\FunctionTok{run}\NormalTok{(}\AttributeTok{weather =}\NormalTok{ epw)}
\end{Highlighting}
\end{Shaded}

\hypertarget{simulating-the-model}{%
\section{Simulating the model}\label{simulating-the-model}}

You should check the SimulationControl and RunPeriod objects in EnergyPlus before simulating the model. The SimulationControl object allows the user to specify the type of simulations that will be performed. You can view this object in R by navigating to and opening the \texttt{RefBldgMediumOfficeNew2004\_Chicago.idf} file in R followed by searching for the string \texttt{SimulationControl} (Figure \ref{fig:sim-control}). If the value for the \texttt{Run\ Simulation\ for\ Weather\ File\ Run\ Periods} field is \texttt{NO} as illustrated in Figure \ref{fig:sim-control}, the simulation will be \textbf{not} be run on for the weather file run periods (Figure \ref{fig:run-period}). In other words, if you want to run the simulation based on the provided epw weather file for the period specify by the RunPeriod object, check that this field is set to \texttt{YES}.

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{figures/sim_control} 

}

\caption{SimulationControl object in EnergyPlus.}\label{fig:sim-control}
\end{figure}

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{figures/run_period} 

}

\caption{RunPeriod object in EnergyPlus.}\label{fig:run-period}
\end{figure}

You can use the \texttt{run()} method of the Idf class to run the simulation using EnergyPlus. You can choose the weather file to run the simulation by specifying an \texttt{Epw} object or a file path of an \texttt{.epw} file to the \texttt{weather} argument. You can also specify a directory to save the simulation results using the \texttt{dir} argument. By default, the folder of your Idf file is used to save the simulation results.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{job }\OtherTok{\textless{}{-}}\NormalTok{ model}\SpecialCharTok{$}\FunctionTok{run}\NormalTok{(}\AttributeTok{weather =}\NormalTok{ epw,}
                 \AttributeTok{dir =} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"idf"}\NormalTok{, }\StringTok{"run"}\NormalTok{, }\StringTok{"test\_run.idf"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

If you do not want to save the simulation results locally, you can first save the model to a temporary directory using the function \texttt{tempdir()} before running the simulation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{save}\NormalTok{(}\FunctionTok{file.path}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"model.idf"}\NormalTok{))}
\NormalTok{job }\OtherTok{\textless{}{-}}\NormalTok{ model}\SpecialCharTok{$}\FunctionTok{run}\NormalTok{(epw)}
\DocumentationTok{\#\# EnergyPlus Starting}
\DocumentationTok{\#\# EnergyPlus, Version 9.4.0{-}998c4b761e, YMD=2021.08.21 15:19}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Could not find platform independent libraries \textless{}prefix\textgreater{}}
\DocumentationTok{\#\# Could not find platform dependent libraries \textless{}exec\_prefix\textgreater{}}
\DocumentationTok{\#\# Consider setting $PYTHONHOME to \textless{}prefix\textgreater{}[:\textless{}exec\_prefix\textgreater{}]}
\DocumentationTok{\#\# Initializing Response Factors}
\DocumentationTok{\#\# Calculating CTFs for "STEEL FRAME NON{-}RES EXT WALL"}
\DocumentationTok{\#\# Calculating CTFs for "IEAD NON{-}RES ROOF"}
\DocumentationTok{\#\# Calculating CTFs for "EXT{-}SLAB"}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{summary}{%
\chapter{Summary reports}\label{summary}}

\hypertarget{prerequisites-8}{%
\section{Prerequisites}\label{prerequisites-8}}

In this chapter we will focus on how to set and get EnergyPlus simulation outputs using the eplusr package. We will illustrate the manipulation of simulation data using tidyverse, and use ggplot2 to visualize the simulation data

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(eplusr)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(RColorBrewer)}
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

We will be working with the IDF and EPW file that pertains to the U.S. Department of Energy (DOE) Commercial Reference Building and Chicago's TMY3 respectively.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_idf }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"idf"}\NormalTok{, }\StringTok{"RefBldgMediumOfficeNew2004\_Chicago.idf"}\NormalTok{)}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{read\_idf}\NormalTok{(path\_idf)}

\NormalTok{path\_epw }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"epw"}\NormalTok{, }\StringTok{"USA\_IL\_Chicago{-}OHare.Intl.AP.725300\_TMY3.epw"}\NormalTok{)}
\NormalTok{epw }\OtherTok{\textless{}{-}} \FunctionTok{read\_epw}\NormalTok{(path\_epw)}
\end{Highlighting}
\end{Shaded}

\hypertarget{output-summary-reports}{%
\section{Output summary reports}\label{output-summary-reports}}

To output the summary reports from EnergyPlus, you need to first run the simulation. The object \texttt{job} in the code below belongs to the \texttt{EplusJob} class. If you set \texttt{dir\ =\ NULL}, the simulation results will not be saved into a temporary directory but instead in the folder containing the IDF file. Do that and you will find the summary report in a html file as illustrated in Figure \ref{fig:tabular-data}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{job }\OtherTok{\textless{}{-}}\NormalTok{ model}\SpecialCharTok{$}\FunctionTok{run}\NormalTok{(epw, }\AttributeTok{dir =} \FunctionTok{tempdir}\NormalTok{())}
\DocumentationTok{\#\# EnergyPlus Starting}
\DocumentationTok{\#\# EnergyPlus, Version 9.4.0{-}998c4b761e, YMD=2021.08.21 15:19}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Could not find platform independent libraries \textless{}prefix\textgreater{}}
\DocumentationTok{\#\# Could not find platform dependent libraries \textless{}exec\_prefix\textgreater{}}
\DocumentationTok{\#\# Consider setting $PYTHONHOME to \textless{}prefix\textgreater{}[:\textless{}exec\_prefix\textgreater{}]}
\DocumentationTok{\#\# Initializing Response Factors}
\DocumentationTok{\#\# Calculating CTFs for "STEEL FRAME NON{-}RES EXT WALL"}
\DocumentationTok{\#\# Calculating CTFs for "IEAD NON{-}RES ROOF"}
\DocumentationTok{\#\# Calculating CTFs for "EXT{-}SLAB"}
\NormalTok{....}
\FunctionTok{class}\NormalTok{(job)}
\DocumentationTok{\#\# [1] "EplusJob" "R6"}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{figures/tabular_data} 

}

\caption{Report summary html file output from EnergyPlus}\label{fig:tabular-data}
\end{figure}

In eplusr, the \texttt{EplusJob} class provides different methods to extract simulation results. To bring the summary reports into R, you can use the \texttt{tabular\_data()} method, which extracts all the EnergyPlus summary reports into a R \texttt{data.table}.

The data table consists of the following nine columns.

\begin{itemize}
\tightlist
\item
  case: Name of the simulation case. The case variable is useful for filtering the simulation results when running multiple parametric simulations. However, since we are only running one simulation in this example there is only one unique case.
\item
  index: Row index for the table
\item
  report\_name: Names of the summary report that the observation belongs to
\item
  report\_for: The context that the summary report is for.
\item
  table\_name: The name of the table within the report that the observation belongs to.
\item
  column\_name: The name of the column within a table that the observation belongs to.
\item
  row\_name: The name of the row within a table that the observation belongs to.
\item
  units: The unit of the observation.
\item
  value: The value of the observation. Note that by default, this is stored as a character vector.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report }\OtherTok{\textless{}{-}}\NormalTok{ job}\SpecialCharTok{$}\FunctionTok{tabular\_data}\NormalTok{()}
\FunctionTok{colnames}\NormalTok{(report)}
\DocumentationTok{\#\# [1] "case"        "index"       "report\_name" "report\_for"  "table\_name" }
\DocumentationTok{\#\# [6] "column\_name" "row\_name"    "units"       "value"}
\end{Highlighting}
\end{Shaded}

To illustrate, refer back to Figure \ref{fig:tabular-data} on what the arguments \texttt{report\_name}, \texttt{table\_name}, \texttt{column\_name}, \texttt{row\_name}, \texttt{units}, and \texttt{value} would correspond to in the html summary report. You can easily retrieve the \texttt{Total\ Site\ Energy} in \texttt{Energy\ Per\ Total\ Building\ Area} from the \texttt{Site\ and\ Source\ Energy} table in the \texttt{AnnualBuildingUtilityPerformanceSummary} report. Note that there are no whitespaces when specifying the \texttt{report\_name}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_example }\OtherTok{\textless{}{-}}\NormalTok{ report }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(report\_name }\SpecialCharTok{==} \StringTok{"AnnualBuildingUtilityPerformanceSummary"}\NormalTok{, }
\NormalTok{           table\_name }\SpecialCharTok{==} \StringTok{"Site and Source Energy"}\NormalTok{,}
\NormalTok{           column\_name }\SpecialCharTok{==} \StringTok{"Energy Per Total Building Area"}\NormalTok{,}
\NormalTok{           row\_name }\SpecialCharTok{==} \StringTok{"Total Site Energy"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Other examples as follows.

You can retrieve end use energy consumption data and arrange them in descending value.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_end\_use }\OtherTok{\textless{}{-}}\NormalTok{ report }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(table\_name }\SpecialCharTok{==} \StringTok{"End Uses"}\NormalTok{, }
           \FunctionTok{grepl}\NormalTok{(}\StringTok{"Electricity|Natural Gas"}\NormalTok{, column\_name, }\AttributeTok{ignore.case =} \ConstantTok{TRUE}\NormalTok{),}
           \SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"total"}\NormalTok{, row\_name, }\AttributeTok{ignore.case =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{value =} \FunctionTok{as.numeric}\NormalTok{(value)}\SpecialCharTok{*}\FloatTok{277.778}\NormalTok{,}
           \AttributeTok{units =} \StringTok{"kWh"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(row\_name, column\_name, units, value) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{rename}\NormalTok{(}\AttributeTok{category =}\NormalTok{ row\_name, }\AttributeTok{fuel =}\NormalTok{ column\_name) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(value)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{drop\_na}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

You can retrieve normalized metrics and group them by their fuel type.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_norm }\OtherTok{\textless{}{-}}\NormalTok{ report }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(table\_name }\SpecialCharTok{==} \StringTok{"Utility Use Per Conditioned Floor Area"}\NormalTok{,}
\NormalTok{           row\_name }\SpecialCharTok{!=} \StringTok{"Total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{value =} \FunctionTok{as.numeric}\NormalTok{(value) }\SpecialCharTok{*} \FloatTok{0.2777777777777778}\NormalTok{,}
           \AttributeTok{units =} \StringTok{"kWh/m2"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(value }\SpecialCharTok{\textgreater{}} \FloatTok{0.0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(}\AttributeTok{category =}\NormalTok{ row\_name, }\AttributeTok{fuel =}\NormalTok{ column\_name, units, value) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(category) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarise}\NormalTok{(}\AttributeTok{total =} \FunctionTok{sum}\NormalTok{(value))}
\end{Highlighting}
\end{Shaded}

You can also retrieve details of the model inputs from the summary reports.

Opaque exterior of the building envelope.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_op\_ext }\OtherTok{\textless{}{-}}\NormalTok{ report }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(table\_name }\SpecialCharTok{==} \StringTok{"Opaque Exterior"}\NormalTok{,}
           \FunctionTok{grepl}\NormalTok{(}\StringTok{"Azimuth|U{-}Factor with Film"}\NormalTok{, column\_name)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{value =} \FunctionTok{as.numeric}\NormalTok{(value)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(row\_name, column\_name, units, value) }
\end{Highlighting}
\end{Shaded}

Exterior fenestration of the building envelope.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_ext\_fenestration }\OtherTok{\textless{}{-}}\NormalTok{ report }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(table\_name }\SpecialCharTok{==} \StringTok{"Exterior Fenestration"}\NormalTok{,}
           \SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"total"}\NormalTok{, row\_name, }\AttributeTok{ignore.case =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{value =} \FunctionTok{as.numeric}\NormalTok{(value)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(value }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(row\_name, column\_name, units, value)}
\DocumentationTok{\#\# Warning in mask$eval\_all\_mutate(quo): NAs introduced by coercion}
\end{Highlighting}
\end{Shaded}

You can refer to the section \emph{``Output:Table:SummaryReports''} in EnergyPlus's \emph{``Output Details and Examples''} documentation for the list of available reports.

\hypertarget{visualize}{%
\chapter{Visualize}\label{visualize}}

\hypertarget{prerequisites-9}{%
\section{Prerequisites}\label{prerequisites-9}}

In this chapter, you will use the \textbf{eplusr} package to interface with EnergyPlus via R, the \textbf{tidyverse} package to manipulate the simulation results, and the \textbf{here} package to specify relative file paths.

Additionally, we will introduce \textbf{ggplot2}, an input-tidy visualization package that is based on the the grammar of graphics \citep{wilkinson_grammar_2012}. We will also introduce \textbf{RColorBrewer} package that contains predefined color palettes that make it easy to pick the right one when creating graphics in R.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(eplusr)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(here)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(RColorBrewer)}
\end{Highlighting}
\end{Shaded}

In this chapter, you will also be working with the U.S. Department of Energy (DOE) Commercial Reference Building for medium office energy model \citep{deru_us_2011} and the third and latest typical meteorological (TMY3) weather data for Chicago. You will first parse the IDf and EPW to R and run the simulation to extract the simulation results.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_idf }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"idf"}\NormalTok{, }\StringTok{"RefBldgMediumOfficeNew2004\_Chicago.idf"}\NormalTok{)}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{read\_idf}\NormalTok{(path\_idf)}

\NormalTok{path\_epw }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"epw"}\NormalTok{, }\StringTok{"USA\_IL\_Chicago{-}OHare.Intl.AP.725300\_TMY3.epw"}\NormalTok{)}
\NormalTok{epw }\OtherTok{\textless{}{-}} \FunctionTok{read\_epw}\NormalTok{(path\_epw)}

\NormalTok{job }\OtherTok{\textless{}{-}}\NormalTok{ model}\SpecialCharTok{$}\FunctionTok{run}\NormalTok{(}\AttributeTok{weather =}\NormalTok{ epw)}
\DocumentationTok{\#\# EnergyPlus Starting}
\DocumentationTok{\#\# EnergyPlus, Version 9.4.0{-}998c4b761e, YMD=2021.08.21 15:20}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Could not find platform independent libraries \textless{}prefix\textgreater{}}
\DocumentationTok{\#\# Could not find platform dependent libraries \textless{}exec\_prefix\textgreater{}}
\DocumentationTok{\#\# Consider setting $PYTHONHOME to \textless{}prefix\textgreater{}[:\textless{}exec\_prefix\textgreater{}]}
\DocumentationTok{\#\# Initializing Response Factors}
\DocumentationTok{\#\# Calculating CTFs for "STEEL FRAME NON{-}RES EXT WALL"}
\DocumentationTok{\#\# Calculating CTFs for "IEAD NON{-}RES ROOF"}
\DocumentationTok{\#\# Calculating CTFs for "EXT{-}SLAB"}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{colors}{%
\section{Colors}\label{colors}}

Choosing the right color scheme is an important aspect of data visualization because of the effects they might have on our relative visual perception of luminance. Fortunately, R has pre-defined color pallettes that make all this super easy. All you have to do is to select the appropriates ones. In this chapter, we will be using the pre-defined color palletes in the RColorBrewer package. In general, you will want to use palettes that are colorblind friendly.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{display.brewer.all}\NormalTok{(}\AttributeTok{colorblindFriendly =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{r4bes_files/figure-latex/unnamed-chunk-113-1.pdf}
In general, there are three types of color palettes: sequential, diverging, and qualitative.

When representing gradients (such as temperature data), you want to use \emph{sequential} color palletes that are perceptually uniform as the color progresses from low to high.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{display.brewer.all}\NormalTok{(}\AttributeTok{type=}\StringTok{"seq"}\NormalTok{, }\AttributeTok{colorblindFriendly=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{r4bes_files/figure-latex/unnamed-chunk-114-1.pdf}

You will want to use \emph{diverging} color palletes that uses a neutral mid-point that diverges at perceptually equal steps to both ends of the data. An example is using the \texttt{RdBu} color pallette to represent temperature data that diverges between cold and hot.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{display.brewer.all}\NormalTok{(}\AttributeTok{type=}\StringTok{"div"}\NormalTok{, }\AttributeTok{colorblindFriendly=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics[height=0.4\textheight]{r4bes_files/figure-latex/unnamed-chunk-115-1}

You will want to map categorical variables to \emph{qualitative} color palettes that are perceptually uniform and not have any variables standing out perceptually due to it's color. For instance, when visualizing the energy usage intensity of different buildings, you would want the colors used to represent each building to be easily distinguishable but at the same time not have one stand out from another even though they are numerically equivalent.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{display.brewer.all}\NormalTok{(}\AttributeTok{type=}\StringTok{"qual"}\NormalTok{, }\AttributeTok{colorblindFriendly=}\ConstantTok{TRUE}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics[height=0.2\textheight]{r4bes_files/figure-latex/unnamed-chunk-116-1}

\hypertarget{ggplot}{%
\section{\texorpdfstring{\texttt{ggplot()}}{ggplot()}}\label{ggplot}}

\hypertarget{functions-and-components}{%
\subsection{Functions and Components}\label{functions-and-components}}

All plots created by ggplot2 begins with a \texttt{ggplot()} function that initializes a ggplot plot object that can be used to specify how variables in the data are mapped to the ``aesthetics'' of the visualization. The function has two key arguements. The first argument \texttt{data} is the data frame that will be used for the plot. The second argument \texttt{mapping} is used to specify how variables in the data are mapped to the ``aesthetics'' of the visualization. The function \texttt{aes()} is a quoting function (i.e., the inputs are evaluated in the context of the data). This means that you can name the variables of the data frame directly within the \texttt{aes()} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =} \SpecialCharTok{\textless{}}\NormalTok{DATA}\SpecialCharTok{\textgreater{}}\NormalTok{, }\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\SpecialCharTok{\textless{}}\NormalTok{x, y, ...}\SpecialCharTok{\textgreater{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

You can then specify the graph by adding one or more of the following components with \texttt{+}

\begin{itemize}
\tightlist
\item
  A layer that comprises of geometric objects or \emph{geom}, statistical transformation or \emph{stat}, and \emph{position} adjustments. Typically, a layer will be created using a \texttt{geom\_\textless{}function\textgreater{}()}
\item
  \emph{scale}s that map data values to visual properties such as color, fill, shape, and size.
\item
  A \emph{coord}inate system that specifies how the coordinates of the data maps to the plot. Typically, Cartesian coordinates are used. However, other coordinate systems includes polar coordinates and map projections.
\item
  \emph{facet}s that divides the data into subsets based on one or more discrete variables. These subsets of data are then displayed as subplots on the plot.
\item
  A \emph{theme} that can be used to customize the non-data components of the plot such as titles, labels, fonts, background, gridlines, and legends.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =} \SpecialCharTok{\textless{}}\NormalTok{DATA}\SpecialCharTok{\textgreater{}}\NormalTok{, }\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\SpecialCharTok{\textless{}}\NormalTok{x, y, ...}\SpecialCharTok{\textgreater{}}\NormalTok{)) }\SpecialCharTok{+}
    \ErrorTok{\textless{}}\NormalTok{GEOM\_FUNCTION}\SpecialCharTok{\textgreater{}}\NormalTok{(}\AttributeTok{stat =} \SpecialCharTok{\textless{}}\NormalTok{STAT}\SpecialCharTok{\textgreater{}}\NormalTok{, }\AttributeTok{position =} \SpecialCharTok{\textless{}}\NormalTok{POSITION}\SpecialCharTok{\textgreater{}}\NormalTok{) }\SpecialCharTok{+}
    \ErrorTok{\textless{}}\NormalTok{COORD\_FUNCTION}\SpecialCharTok{\textgreater{}}\NormalTok{(...) }\SpecialCharTok{+}
    \ErrorTok{\textless{}}\NormalTok{SCALE\_FUNCTION}\SpecialCharTok{\textgreater{}}\NormalTok{(...) }\SpecialCharTok{+}
    \ErrorTok{\textless{}}\NormalTok{FACET\_FUNCTION}\SpecialCharTok{\textgreater{}}\NormalTok{(...) }\SpecialCharTok{+}
    \ErrorTok{\textless{}}\NormalTok{THEME\_FUNCTION}\SpecialCharTok{\textgreater{}}\NormalTok{(...)}
\end{Highlighting}
\end{Shaded}

You will see the use of \texttt{ggplot()} and the above mentioned components more concretely as we go through the visualization recipes in the subsequent sections.

\hypertarget{a-simple-example}{%
\subsection{A simple example}\label{a-simple-example}}

Bar graphs are a common way to visualize building simulation end use data. In this section, we will illustrate the use of ggplot and its various components using using the \texttt{report\_end\_use} data frame that was created in the preceding section.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report }\OtherTok{\textless{}{-}}\NormalTok{ job}\SpecialCharTok{$}\FunctionTok{tabular\_data}\NormalTok{()}

\NormalTok{report\_end\_use }\OtherTok{\textless{}{-}}\NormalTok{ report }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(table\_name }\SpecialCharTok{==} \StringTok{"End Uses"}\NormalTok{, }
           \FunctionTok{grepl}\NormalTok{(}\StringTok{"Electricity|Natural Gas"}\NormalTok{, column\_name, }\AttributeTok{ignore.case =} \ConstantTok{TRUE}\NormalTok{),}
           \SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"total"}\NormalTok{, row\_name, }\AttributeTok{ignore.case =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{value =} \FunctionTok{as.numeric}\NormalTok{(value)}\SpecialCharTok{*}\FloatTok{277.778}\NormalTok{,}
           \AttributeTok{units =} \StringTok{"kWh"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(row\_name, column\_name, units, value) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{rename}\NormalTok{(}\AttributeTok{category =}\NormalTok{ row\_name, }\AttributeTok{fuel =}\NormalTok{ column\_name) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(value)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{drop\_na}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

You can create bar graphs by adding \texttt{geom\_bar()}. By default, \texttt{stat\ =\ bin} in \texttt{geom\_bar()} which gives the count in each \texttt{x}. However, when the data contains \texttt{y} values, you would want to use \texttt{stat\ =\ "identity"}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ report\_end\_use, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ category, }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ fuel)) }\SpecialCharTok{+}
    \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{r4bes_files/figure-latex/unnamed-chunk-120-1.pdf}

By default, the bar charts would be stacked. In this scenario, we only have two groups of fuel, electricity and natural gas. However, when there are many groups, stacked bar charts can be difficult to visualize. You can place them side by side instead using \texttt{position\ =\ position\_dodge()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ report\_end\_use, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ category, }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ fuel)) }\SpecialCharTok{+}
    \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{, }\AttributeTok{position =} \FunctionTok{position\_dodge}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\includegraphics{r4bes_files/figure-latex/unnamed-chunk-121-1.pdf}

You can use scale to change the fill of the bar chart. The \texttt{scale\_*\_brewer()} functions provides an easy way to specify palettes from the rcolorbrewer package in ggplot.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ report\_end\_use, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ category, }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ fuel)) }\SpecialCharTok{+}
    \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
    \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set2"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{r4bes_files/figure-latex/unnamed-chunk-122-1.pdf}

You can flip how the data coordinates maps to plot to get horizontal bar plots with \texttt{coord\_filp()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ report\_end\_use, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ category, }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ fuel)) }\SpecialCharTok{+}
    \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{, }\AttributeTok{position =} \FunctionTok{position\_dodge}\NormalTok{()) }\SpecialCharTok{+} 
    \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{coord\_flip}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{r4bes_files/figure-latex/unnamed-chunk-123-1.pdf}

You can divide the plot into various \emph{facet}s by subsetting the plot based onone or more discrete variables. In this example, we divide the plot row wise based on fuel type using \texttt{facet\_grid()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ report\_end\_use, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ category, }\AttributeTok{y =}\NormalTok{ value)) }\SpecialCharTok{+}
    \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{, }\AttributeTok{position =} \FunctionTok{position\_dodge}\NormalTok{()) }\SpecialCharTok{+} 
    \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{facet\_grid}\NormalTok{(}\AttributeTok{rows =} \FunctionTok{vars}\NormalTok{(fuel))}
\end{Highlighting}
\end{Shaded}

\includegraphics{r4bes_files/figure-latex/unnamed-chunk-124-1.pdf}

As you probably have noticed. The x-axis labels are not legible due to overlapping when plotting the data as vertical bar charts.

You can use \texttt{theme()} and \texttt{element\_text()} to change how the x-axis labels appear. In this case we are rotating it counter-clockwise by 90 degrees (\texttt{angle\ =\ 90}), vertically center justify the text (\texttt{vjust\ =\ 0.5}), and horizontally right justify the text (\texttt{hjust\ =\ 1}). For \texttt{vjust} and \texttt{hjust}, 0 and 1 refers to left and right justify respectively.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ report\_end\_use, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ category, }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ fuel)) }\SpecialCharTok{+}
    \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
    \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{90}\NormalTok{, }\AttributeTok{vjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{hjust=}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{r4bes_files/figure-latex/unnamed-chunk-125-1.pdf}

You can also use \texttt{theme()} together with various \texttt{element\_*} functions to control elements of the plot title, legend, axis labels, borders, background, etc. You can find out more about the possible arguments to each \texttt{element\_function()} by typing \texttt{?margin} into your console. \texttt{element\_*} functions are used with \texttt{theme()} to specify the non-data components of the plot. There are four element functions and they are:

\begin{itemize}
\tightlist
\item
  \texttt{element\_blank()}: to assign a blank
\item
  \texttt{element\_rect()}: for specifying borders and background
\item
  \texttt{element\_line()}: for specifying lines
\item
  \texttt{element\_text()}: for specifying text
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ report\_end\_use, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ category, }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ fuel)) }\SpecialCharTok{+}
    \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
    \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"End Use"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{90}\NormalTok{, }\AttributeTok{vjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{hjust=}\DecValTok{1}\NormalTok{),}
          \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{face =} \StringTok{"bold"}\NormalTok{, }
                                    \AttributeTok{colour =} \StringTok{"red"}\NormalTok{,}
                                    \AttributeTok{size =} \DecValTok{20}\NormalTok{),}
          \AttributeTok{axis.line =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }
                                   \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{()),}
          \AttributeTok{plot.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"grey"}\NormalTok{),}
          \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{() }\CommentTok{\# remove legend title}
\NormalTok{          )}
\end{Highlighting}
\end{Shaded}

\includegraphics{r4bes_files/figure-latex/unnamed-chunk-126-1.pdf}

\hypertarget{part-inputs-and-outputs}{%
\part{Inputs and Outputs}\label{part-inputs-and-outputs}}

\hypertarget{input-output}{%
\chapter{Introduction}\label{input-output}}

In this part of the book, you will learn EnergyPlus's input data structure (Chapter \ref{input}), and how to programmatically query and modify them in R (Chapter \ref{modify}). We will also point you to the corresponding EnergyPlus reference documentation that will help you gain a better understanding of the inner workings of EnergyPlus. Understanding the inputs to a model is important as the proverb ``garbage in, garbage out'' clearly spells out. You can have the best data science workflows but your simulation results would only be as good the quality of your model and it's inputs.

Subsequently, you will learn how to extract the more detailed output files (Chapter \ref{output}). You will work with time-series simulation results and explore them using R's data transformation and data visualization capabilities (Chapter \ref{explore}).

\hypertarget{input}{%
\chapter{Model Input Structure}\label{input}}

\hypertarget{prerequisites-10}{%
\section{Prerequisites}\label{prerequisites-10}}

In this chapter, we will use the \textbf{eplusr} package to extract various inputs in an EnergyPlus model, and through this, learn how the inputs in EnergyPlus are structured.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(eplusr)}
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

We will be working with the IDF and EPW file that pertains to the U.S. Department of Energy (DOE) Commercial Reference Building and Chicago's TMY3 respectively.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_idf }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"idf"}\NormalTok{, }\StringTok{"RefBldgMediumOfficeNew2004\_Chicago.idf"}\NormalTok{)}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{read\_idf}\NormalTok{(path\_idf)}

\NormalTok{path\_epw }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"epw"}\NormalTok{, }\StringTok{"USA\_IL\_Chicago{-}OHare.Intl.AP.725300\_TMY3.epw"}\NormalTok{)}
\NormalTok{epw }\OtherTok{\textless{}{-}} \FunctionTok{read\_epw}\NormalTok{(path\_epw)}
\end{Highlighting}
\end{Shaded}

\hypertarget{energyplus-documentation}{%
\section{EnergyPlus Documentation}\label{energyplus-documentation}}

Although the focus of this chapter is to elucidate how the model inputs are structured to facilitate querying and modifying them, it is also important to understand what each input means. Fortunately, EnergyPlus is well documented and these documentation comes downloaded with any installation of EnergyPlus. You will find these documents within EnergyPlus's installation folder.By default, EnergyPlus will be installed in \texttt{C:\textbackslash{}EnergyPlusVX-Y-0} on Windows, \texttt{/usr/local/EnergyPlus-X-Y-0} on Linux and \texttt{/Applications/EnergyPlus-X-Y-0} on macOS).

I would highly recommend referring to the EnergyPlus input output reference (\texttt{{[}EnergyPlus\ installation\ folder{]}\ \textgreater{}\ Documentation\ \textgreater{}\ InputOutputReference.pdf}), which provides a thorough description of every field for every input object in EnergyPlus.

For those who find that the input output reference does not satisfy your inquisitive mind, I would recommend reading the EnergyPlus engineering reference (\texttt{{[}EnergyPlus\ installation\ folder{]}\ \textgreater{}\ Documentation\ \textgreater{}\ EngineeringReference.pdf}), which provides insights into the theoretical basis behind various EnergyPlus calculations.

\hypertarget{energyplus-input-structure}{%
\section{EnergyPlus input structure}\label{energyplus-input-structure}}

In EnergyPlus, the inputs to the model can be categorized hierarchically where the top level is known as the class groups (Figure \ref{fig:group-class-field}). Each class group consists of multiple input classes that are identifiable by their class names. Each class is then defined by fields that may or may not be required. Required fields as it's name suggest are field that must have a value. If the field is left blank and there are no pre-defined default values, an error will be raised when the simulation is run.

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{figures/group_class_field} 

}

\caption{Hierarchical model inputs organizational structure.}\label{fig:group-class-field}
\end{figure}

Figure \ref{fig:input-structure} illustrates this using the class group \texttt{Surface\ Construction\ Elements} in EnergyPlus. The \texttt{Surface\ Construction\ Elements} class groups consists of several classes that include the \texttt{Material:NoMass}, \texttt{Material:AirGap}, and the \texttt{WindowMaterial:SimpleGalzingSystem} class amongst others. Each class is then defined by their respective fields. For example, the \texttt{WindowMaterial:SimpleGalzingSystem} class is defined by a unique \texttt{Name}, the \texttt{U-Factor}, \texttt{SHGC} or Solar Heat gain Coefficient, and the `Visible Transmittance of the glazing system.

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{figures/input_structure} 

}

\caption{Categorization of EnergyPlus inputs}\label{fig:input-structure}
\end{figure}

\hypertarget{class-vs-object}{%
\section{Class vs Object}\label{class-vs-object}}

In this book, we make a distinction between classes and objects following the terminologies of object-oriented programming (OOP). The difference between classes and objects is subtle yet conceptually simple. You can think of a class as a blueprint or template for creating objects. The created objects are therefore instances of the class. For example, when modeling glazing systems from the perspective of running an energy simulation, the thermal properties of the glazing system would be required for the calculations. Different glazing systems would have different thermal properties, which include the U-factor, solar heat gain coefficient (SHGC), and visible transmittance (\(T_{vis}\)). However, these properties although having different values, are a common characteristic across different glazing systems. Therefore, a glazing system class with the variables U-factor, SHGC, and \(T_{vis}\) can be used as a template to create various glazing objects.

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{figures/class_object} 

}

\caption{Figure shows how three different glazing objects can be created from a glazing class, which acts as the template.}\label{fig:class-object}
\end{figure}

\hypertarget{model-query}{%
\section{Model Query}\label{model-query}}

\hypertarget{idf-class-methods}{%
\subsection{\texorpdfstring{\texttt{Idf} class methods}{Idf class methods}}\label{idf-class-methods}}

Since the EnergyPlus model is organized hierarchically, we will demonstrate how to query the model hierarchically using the methods in the \texttt{Idf} class.

\begin{longtable}[]{@{}ll@{}}
\toprule
\texttt{Idf} Class Method & What it does \\
\midrule
\endhead
\texttt{\$group\_name()} & Query the names of class groups \\
\texttt{\$class\_name()} & Query the names of classes \\
\texttt{\$object\_name()} & Query the names of objects in one or more classes \\
\texttt{\$objects()} & Query one or more objects using their names \\
\bottomrule
\end{longtable}

You can see what class groups exists in your model with the \texttt{\$group\_name()} method

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{group\_name}\NormalTok{()}
\DocumentationTok{\#\#  [1] "Simulation Parameters"              "Location and Climate"              }
\DocumentationTok{\#\#  [3] "Schedules"                          "Surface Construction Elements"     }
\DocumentationTok{\#\#  [5] "Thermal Zones and Surfaces"         "Internal Gains"                    }
\DocumentationTok{\#\#  [7] "Zone Airflow"                       "Exterior Equipment"                }
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can also view the list of classes in the model grouped by their corresponding class group.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{class\_name}\NormalTok{(}\AttributeTok{by\_group =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\# $\textasciigrave{}Simulation Parameters\textasciigrave{}}
\DocumentationTok{\#\#  [1] "Version"                            "SimulationControl"                 }
\DocumentationTok{\#\#  [3] "Building"                           "ShadowCalculation"                 }
\DocumentationTok{\#\#  [5] "SurfaceConvectionAlgorithm:Inside"  "SurfaceConvectionAlgorithm:Outside"}
\DocumentationTok{\#\#  [7] "HeatBalanceAlgorithm"               "ZoneAirHeatBalanceAlgorithm"       }
\DocumentationTok{\#\#  [9] "Timestep"                           "ConvergenceLimits"                 }
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $\textasciigrave{}Location and Climate\textasciigrave{}}
\DocumentationTok{\#\# [1] "Site:Location"                         }
\DocumentationTok{\#\# [2] "SizingPeriod:DesignDay"                }
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can also view the list of objects that have been defined in a particular class in the model using the \texttt{\$object\_name()} method. The example from the code chunk below tells us that there are currently two materials (\texttt{CP02\ CARPET\ PAD} and \texttt{MAT-AIR-WALL}) that have been created using the \texttt{Material:NoMass} class. You can think of these classes as templates for creating objects that defines your model as explained in the previous sub-section. In this particular example, the two material objects \texttt{CP02\ CARPET\ PAD} and \texttt{MAT-AIR-WALL} are instances in the model that have been defined based on the \texttt{Material:NoMass} class.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{object\_name}\NormalTok{(}\StringTok{"Material:NoMass"}\NormalTok{)}
\DocumentationTok{\#\# $\textasciigrave{}Material:NoMass\textasciigrave{}}
\DocumentationTok{\#\# [1] "CP02 CARPET PAD" "MAT{-}AIR{-}WALL"}
\end{Highlighting}
\end{Shaded}

You can also query multiple classes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{object\_name}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"Material"}\NormalTok{, }\StringTok{"Construction"}\NormalTok{))}
\DocumentationTok{\#\# $Material}
\DocumentationTok{\#\#  [1] "Steel Frame NonRes Wall Insulation" "IEAD NonRes Roof Insulation"       }
\DocumentationTok{\#\#  [3] "Std Wood 6inch"                     "Wood Siding"                       }
\DocumentationTok{\#\#  [5] "1/2IN Gypsum"                       "1IN Stucco"                        }
\DocumentationTok{\#\#  [7] "8IN CONCRETE HW"                    "Metal Siding"                      }
\DocumentationTok{\#\#  [9] "HW CONCRETE"                        "Roof Membrane"                     }
\DocumentationTok{\#\# [11] "Metal Decking"                      "Metal Roofing"                     }
\DocumentationTok{\#\# [13] "MAT{-}CC05 4 HW CONCRETE"             "Std AC02"                          }
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $Construction}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Finally, you can also query individual objects using the \texttt{\$objects()} method.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{objects}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"Steel Frame Non{-}res Ext Wall"}\NormalTok{, }\StringTok{"IEAD Non{-}res Roof"}\NormalTok{))}
\DocumentationTok{\#\# $\textasciigrave{}Steel Frame Non{-}res Ext Wall\textasciigrave{}}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Construction\textquotesingle{}\textgreater{} [ID:37] \textasciigrave{}Steel Frame Non{-}res Ext Wall\textasciigrave{}}
\DocumentationTok{\#\# {-}{-} COMMENTS {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# ! ***OPAQUE CONSTRUCTIONS AND MATERIALS***}
\DocumentationTok{\#\# ! Exterior Walls}
\DocumentationTok{\#\# {-}{-} VALUES {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# Class: \textless{}Construction\textgreater{}}
\DocumentationTok{\#\# ├─ 1*: "Steel Frame Non{-}res Ext Wall",  !{-} Name}
\DocumentationTok{\#\# │─ 2*: "Wood Siding",      !{-} Outside Layer}
\DocumentationTok{\#\# │─ 3 : "Steel Frame NonRes Wall Insulation",  !{-} Layer 2}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{operator}{%
\subsection{\texorpdfstring{\texttt{\$} operator}{\$ operator}}\label{operator}}

Since the model is stored as a named list in R, you can use the \texttt{\$} operator to also query elements by name. For instance, you can access the objects defined using the \texttt{Material:NoMass} class with \texttt{\$Material:NoMass}. Since class, object, and field names in an EnergyPlus often violets the variable naming restrictions in R (e.g., containing special characters such as \texttt{:}, white spaces, etc.), the identifiers need to be placed within a set of single back quotes \texttt{\textasciigrave{}} to tell R that this is a variable name.

With \texttt{\$\textasciigrave{}Material:NoMass\textasciigrave{}} will list all the objects in the \texttt{Material:NoMass} class.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Material:NoMass}\StringTok{\textasciigrave{}}
\DocumentationTok{\#\# $\textasciigrave{}CP02 CARPET PAD\textasciigrave{}}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Material:NoMass\textquotesingle{}\textgreater{} [ID:56] \textasciigrave{}CP02 CARPET PAD\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Material:NoMass\textgreater{}}
\DocumentationTok{\#\# ├─ 1*: "CP02 CARPET PAD", !{-} Name}
\DocumentationTok{\#\# │─ 2*: "VeryRough",       !{-} Roughness}
\DocumentationTok{\#\# │─ 3*: 0.2165,            !{-} Thermal Resistance \{m2{-}K/W\}}
\DocumentationTok{\#\# │─ 4 : 0.9,               !{-} Thermal Absorptance}
\DocumentationTok{\#\# │─ 5 : 0.7,               !{-} Solar Absorptance}
\DocumentationTok{\#\# └─ 6 : 0.8;               !{-} Visible Absorptance}
\DocumentationTok{\#\# }
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Since the model is stored hierarchically, you can chain them by adding another \texttt{\$} to access and modify lower levels. Using the same example, you will be able to retrieve the \texttt{CP02\ CARPET\ PAD} object with \texttt{\$\textasciigrave{}Material:NoMass\textasciigrave{}\$\textasciigrave{}CP02\ CARPET\ PAD\textasciigrave{}}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Material:NoMass}\StringTok{\textasciigrave{}}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{CP02 CARPET PAD}\StringTok{\textasciigrave{}}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Material:NoMass\textquotesingle{}\textgreater{} [ID:56] \textasciigrave{}CP02 CARPET PAD\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Material:NoMass\textgreater{}}
\DocumentationTok{\#\# ├─ 1*: "CP02 CARPET PAD", !{-} Name}
\DocumentationTok{\#\# │─ 2*: "VeryRough",       !{-} Roughness}
\DocumentationTok{\#\# │─ 3*: 0.2165,            !{-} Thermal Resistance \{m2{-}K/W\}}
\DocumentationTok{\#\# │─ 4 : 0.9,               !{-} Thermal Absorptance}
\DocumentationTok{\#\# │─ 5 : 0.7,               !{-} Solar Absorptance}
\DocumentationTok{\#\# └─ 6 : 0.8;               !{-} Visible Absorptance}
\end{Highlighting}
\end{Shaded}

Likewise, you could go further down the hierarchy and extract the value of a particular field of an object by further chaining with another \texttt{\$}. The example below shows that the \texttt{Thermal\ Resistance} value of the \texttt{CP02\ CARPET\ PAD} object that was defined using the \texttt{Material:NoMass} class is \texttt{0.2165}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Material:NoMass}\StringTok{\textasciigrave{}}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{CP02 CARPET PAD}\StringTok{\textasciigrave{}}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Thermal Resistance}\StringTok{\textasciigrave{}}
\DocumentationTok{\#\# [1] 0.2165}
\end{Highlighting}
\end{Shaded}

You can use the \texttt{definition} method that returns the fields needed as inputs to define a particular class
Now, compare the output from the code chunk below with Figure \ref{fig:input-structure}. The required fields are indicated by \texttt{eplusr} using an asterix \texttt{*}. Using the \texttt{Material:NoMass} class as an example (Figure \ref{fig:idd-nomass}), the same information can be obtained from the IDD file (\texttt{Energy+.idd}) where the required fields are indicated with the \texttt{\textbackslash{}required-field} tag. The definitions of the different tags can be found at the begining of the IDD file.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{definition}\NormalTok{(}\StringTok{"Material:NoMass"}\NormalTok{)}
\DocumentationTok{\#\# \textless{}IddObject: \textquotesingle{}Material:NoMass\textquotesingle{}\textgreater{}}
\DocumentationTok{\#\# {-}{-} MEMO {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\#   "Regular materials properties described whose principal description is R (Thermal Resistance)"}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# {-}{-} PROPERTIES {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\#   * Group: \textquotesingle{}Surface Construction Elements\textquotesingle{}}
\DocumentationTok{\#\#   * Unique: FALSE}
\DocumentationTok{\#\#   * Required: FALSE}
\DocumentationTok{\#\#   * Total fields: 6}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# {-}{-} FIELDS {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\#   1*: Name}
\DocumentationTok{\#\#   2*: Roughness}
\DocumentationTok{\#\#   3*: Thermal Resistance}
\DocumentationTok{\#\#   4 : Thermal Absorptance}
\DocumentationTok{\#\#   5 : Solar Absorptance}
\DocumentationTok{\#\#   6 : Visible Absorptance}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=19.03in]{figures/idd_nomass} 

}

\caption{Screen capture of the definition of the Material:NoMass class from the EnergyPlus IDD file (`Energy+.idd`)}\label{fig:idd-nomass}
\end{figure}

\hypertarget{object-interdependencies}{%
\section{Object interdependencies}\label{object-interdependencies}}

The inter-dependencies between different objects is a challenging aspect when working with energy models. It is important to note that changing an object not only affects the object but also the objects that reference it. A classic example is the relationship between the building's thermal zones, surfaces, construction, and materials. A single building energy model comprises of one or more thermal zones and each thermal zone has it's boundaries defined by several surfaces. Each surface is then assigned one construction where each layer of the construction is a material that is defined based on it's thermal properties.

Using the construction \texttt{Steel\ Frame\ Non-res\ Ext\ Wall} as an example. You can see that it references the materials \texttt{Wood\ Siding}, \texttt{Steel\ Frame\ NonRes\ Wall\ Insulation}, and \texttt{1/2IN\ Gypsum}. Likewise, it is referenced by the surfaces \texttt{Steel\ Frame\ Non-res\ Ext\ Wall}, \texttt{Perimeter\_bot\_Plenum\_Wall\_North}, \ldots, \texttt{Perimeter\_top\_ZN\_4\_Wall\_West}. Therefore, changing the thermal properties of either of the three materials \texttt{Wood\ Siding}, \texttt{Steel\ Frame\ NonRes\ Wall\ Insulation}, and \texttt{1/2IN\ Gypsum} would change the thermal properties of the \texttt{Steel\ Frame\ Non-res\ Ext\ Wall} Construction and subsequently all the surfaces that references it. On a different note, changing an object's name would also require updating all the fields in the model that references the object. In this example, changing \texttt{Steel\ Frame\ Non-res\ Ext\ Wall} to \texttt{Steel\ Frame\ Non-res\ Wall} would require updating all the \texttt{Construction\ Name} field in the surfaces that references it, otherwise, a severe error would be raised when the simulation is run.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{object\_relation}\NormalTok{(}\StringTok{"Steel Frame Non{-}res Ext Wall"}\NormalTok{)}
\DocumentationTok{\#\# {-}{-} Refer to Others {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\#  Class: \textless{}Construction\textgreater{}}
\DocumentationTok{\#\#  └─ Object [ID:37] \textless{}Steel Frame Non{-}res Ext Wall\textgreater{}}
\DocumentationTok{\#\#     ├─ 2: "Wood Siding", !{-} Outside Layer}
\DocumentationTok{\#\#     │  v\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#     │  └─ Class: \textless{}Material\textgreater{}}
\DocumentationTok{\#\#     │     └─ Object [ID:50] \textless{}Wood Siding\textgreater{}}
\DocumentationTok{\#\#     │        └─ 1: "Wood Siding"; !{-} Name}
\DocumentationTok{\#\#     │  }
\DocumentationTok{\#\#     ├─ 3: "Steel Frame NonRes Wall Insulation",  !{-} Layer 2}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

In EnergyPlus, each object may be referenced by other

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{object\_relation}\NormalTok{(}\StringTok{"Window Non{-}res Fixed"}\NormalTok{)}
\DocumentationTok{\#\# {-}{-} Refer to Others {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\#  Class: \textless{}Construction\textgreater{}}
\DocumentationTok{\#\#  └─ Object [ID:45] \textless{}Window Non{-}res Fixed\textgreater{}}
\DocumentationTok{\#\#      └─ 2: "NonRes Fixed Assembly Window";  !{-} Outside Layer}
\DocumentationTok{\#\#         v\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#         └─ Class: \textless{}WindowMaterial:SimpleGlazingSystem\textgreater{}}
\DocumentationTok{\#\#            └─ Object [ID:46] \textless{}NonRes Fixed Assembly Window\textgreater{}}
\DocumentationTok{\#\#               └─ 1: "NonRes Fixed Assembly Window";  !{-} Name}
\DocumentationTok{\#\#     }
\DocumentationTok{\#\# }
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{modify}{%
\chapter{Modify model inputs}\label{modify}}

In this chapter, you will learn how modify the model inputs.

\hypertarget{prerequisites-11}{%
\section{Prerequisites}\label{prerequisites-11}}

In this chapter, we will use the \textbf{eplusr} package to query and modify various inputs in an EnergyPlus model. We will also combine what you have learned about data manipulation (with the \textbf{tidyverse} package) to make it easier to work with the simulation inputs.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(eplusr)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

We will be working with the IDF and EPW file that pertains to the U.S. Department of Energy (DOE) Commercial Reference Building and Chicago's TMY3 respectively.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_idf }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"idf"}\NormalTok{, }\StringTok{"RefBldgMediumOfficeNew2004\_Chicago.idf"}\NormalTok{)}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{read\_idf}\NormalTok{(path\_idf)}

\NormalTok{path\_epw }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"epw"}\NormalTok{, }\StringTok{"USA\_IL\_Chicago{-}OHare.Intl.AP.725300\_TMY3.epw"}\NormalTok{)}
\NormalTok{epw }\OtherTok{\textless{}{-}} \FunctionTok{read\_epw}\NormalTok{(path\_epw)}
\end{Highlighting}
\end{Shaded}

\hypertarget{extract-and-modify}{%
\section{Extract and Modify}\label{extract-and-modify}}

Changing the values of the existing objects in the model is an important functionality in the application of data exploration and data science to EnergyPlus. There are many approaches to extract and modify an EnergyPlus model using eplusr. In this chapter we focus on

\begin{itemize}
\item
  Directly extracting and modifying the field values of a single object using the \texttt{{[}{[}} or \texttt{\$} operator.
\item
  Extracting and modifying multiple objects using the methods in the \texttt{Idf} class. Type \texttt{?Idf} in your console to see the \texttt{Idf} class methods.
\end{itemize}

\hypertarget{single-object}{%
\subsection{Single object}\label{single-object}}

Like how you can access the field values of the model using the \texttt{\$} operator, you can likewise modify them simply by accessing and then replace the current value by assigning a different value. For instance, you can change the \texttt{Thermal\ Resistance} field value of the \texttt{CP02\ CARPET\ PAD} object to \texttt{0.5} using the \texttt{\textless{}-} operator to assign \texttt{0.5} to the field \texttt{Thermal\ Resistance}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Material:NoMass}\StringTok{\textasciigrave{}}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{CP02 CARPET PAD}\StringTok{\textasciigrave{}}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Thermal Resistance}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \FloatTok{0.5}
\NormalTok{model}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Material:NoMass}\StringTok{\textasciigrave{}}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{CP02 CARPET PAD}\StringTok{\textasciigrave{}}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Material:NoMass\textquotesingle{}\textgreater{} [ID:56] \textasciigrave{}CP02 CARPET PAD\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Material:NoMass\textgreater{}}
\DocumentationTok{\#\# ├─ 1*: "CP02 CARPET PAD", !{-} Name}
\DocumentationTok{\#\# │─ 2*: "VeryRough",       !{-} Roughness}
\DocumentationTok{\#\# │─ 3*: 0.5,               !{-} Thermal Resistance \{m2{-}K/W\}}
\DocumentationTok{\#\# │─ 4 : 0.9,               !{-} Thermal Absorptance}
\DocumentationTok{\#\# │─ 5 : 0.7,               !{-} Solar Absorptance}
\DocumentationTok{\#\# └─ 6 : 0.8;               !{-} Visible Absorptance}
\end{Highlighting}
\end{Shaded}

Another example showing how you can modify the lighting power density (field name: \texttt{Watts\_per\_Zone\_Floor\_Area}) of a particular zone (object name: Perimeter\_bot\_ZN\_1\_Lights) from \texttt{10.76} (current value) to \texttt{15} (new value).

Existing field values of the object \texttt{Perimeter\_bot\_ZN\_1\_Lights}, an instance of the \texttt{Lights} class.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\NormalTok{Lights}\SpecialCharTok{$}\NormalTok{Perimeter\_bot\_ZN\_1\_Lights}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Lights\textquotesingle{}\textgreater{} [ID:240] \textasciigrave{}Perimeter\_bot\_ZN\_1\_Lights\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Lights\textgreater{}}
\DocumentationTok{\#\# ├─ 01*: "Perimeter\_bot\_ZN\_1\_Lights",  !{-} Name}
\DocumentationTok{\#\# │─ 02*: "Perimeter\_bot\_ZN\_1",  !{-} Zone or ZoneList Name}
\DocumentationTok{\#\# │─ 03*: "BLDG\_LIGHT\_SCH",   !{-} Schedule Name}
\DocumentationTok{\#\# │─ 04 : "Watts/Area",       !{-} Design Level Calculation Method}
\DocumentationTok{\#\# │─ 05 : \textless{}Blank\textgreater{},            !{-} Lighting Level \{W\}}
\DocumentationTok{\#\# │─ 06 : 10.76,              !{-} Watts per Zone Floor Area \{W/m2\}}
\DocumentationTok{\#\# │─ 07 : \textless{}Blank\textgreater{},            !{-} Watts per Person \{W/person\}}
\DocumentationTok{\#\# │─ 08 : 0.4,                !{-} Return Air Fraction}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Changing the value of the field \texttt{Watts\_per\_Zone\_Floor\_Area} from it's existing value of \texttt{10.76} to \texttt{15}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\NormalTok{Lights}\SpecialCharTok{$}\NormalTok{Perimeter\_bot\_ZN\_1\_Lights}\SpecialCharTok{$}\NormalTok{Watts\_per\_Zone\_Floor\_Area }\OtherTok{\textless{}{-}} \DecValTok{15}
\NormalTok{model}\SpecialCharTok{$}\NormalTok{Lights}\SpecialCharTok{$}\NormalTok{Perimeter\_bot\_ZN\_1\_Lights}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Lights\textquotesingle{}\textgreater{} [ID:240] \textasciigrave{}Perimeter\_bot\_ZN\_1\_Lights\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Lights\textgreater{}}
\DocumentationTok{\#\# ├─ 01*: "Perimeter\_bot\_ZN\_1\_Lights",  !{-} Name}
\DocumentationTok{\#\# │─ 02*: "Perimeter\_bot\_ZN\_1",  !{-} Zone or ZoneList Name}
\DocumentationTok{\#\# │─ 03*: "BLDG\_LIGHT\_SCH",   !{-} Schedule Name}
\DocumentationTok{\#\# │─ 04 : "Watts/Area",       !{-} Design Level Calculation Method}
\DocumentationTok{\#\# │─ 05 : \textless{}Blank\textgreater{},            !{-} Lighting Level \{W\}}
\DocumentationTok{\#\# │─ 06 : 15,                 !{-} Watts per Zone Floor Area \{W/m2\}}
\DocumentationTok{\#\# │─ 07 : \textless{}Blank\textgreater{},            !{-} Watts per Person \{W/person\}}
\DocumentationTok{\#\# │─ 08 : 0.4,                !{-} Return Air Fraction}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{multiple-objects}{%
\subsection{Multiple objects}\label{multiple-objects}}

Methods to extract data:

\begin{longtable}[]{@{}ll@{}}
\toprule
Methods & Description \\
\midrule
\endhead
\texttt{\$to\_table()} & Extract specified objects of the model to data.frames \\
\texttt{\$to\_string()} & Extract specified objects of the model to strings \\
\bottomrule
\end{longtable}

You can extract the EnergyPlus objects of interest into a R data frame using the \texttt{\$to\_table} method in the \texttt{Idf} class. If no arguments are provided to the method, the entire EnergyPlus model is converted to a data frame.

The data frame consists of the following six columns.

\begin{itemize}
\tightlist
\item
  id (integer): Integer identifiers of the EnergyPlus objects.
\item
  name (character): Names of the EnergyPlus objects.
\item
  class (character): The class that the EnergyPlus object belongs to.
\item
  index (integer): Row index for the field of a particular EnergyPlus object.
\item
  field (character): The name of the column within a table that the observation belongs to.
\item
  value (character): The value of the field.
\end{itemize}

Take a minute now to open the EnergyPlus IDF file (\texttt{"RefBldgMediumOfficeNew2004\_Chicago.idf"}). Compare the text file with the data frame below, and identify where the values for the columns \texttt{class}, \texttt{name}, and \texttt{field} would correspond to in the IDF text file. You will also notice that some of the EnergyPlus classes such as \texttt{Version} and \texttt{SimulationControl} do not have a \texttt{name} field, which explains why it is stored as \texttt{NA} in the data frame.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{to\_table}\NormalTok{()}
\DocumentationTok{\#\#        id name             class index}
\DocumentationTok{\#\#    1:   1 \textless{}NA\textgreater{}           Version     1}
\DocumentationTok{\#\#    2:   2 \textless{}NA\textgreater{} SimulationControl     1}
\DocumentationTok{\#\#    3:   2 \textless{}NA\textgreater{} SimulationControl     2}
\DocumentationTok{\#\#    4:   2 \textless{}NA\textgreater{} SimulationControl     3}
\DocumentationTok{\#\#    5:   2 \textless{}NA\textgreater{} SimulationControl     4}
\DocumentationTok{\#\#   {-}{-}{-}                                 }
\DocumentationTok{\#\# 7839: 681 \textless{}NA\textgreater{}       FuelFactors    32}
\DocumentationTok{\#\# 7840: 681 \textless{}NA\textgreater{}       FuelFactors    33}
\DocumentationTok{\#\# 7841: 681 \textless{}NA\textgreater{}       FuelFactors    34}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Subset by Class
\end{itemize}

Working with the entire model can be difficult due to the large number of rows. You can extract all the objects belonging to a class by supplying a character vector of class names that are of interest to the argument \texttt{class}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{to\_table}\NormalTok{(}\AttributeTok{class =} \FunctionTok{c}\NormalTok{(}\StringTok{"Construction"}\NormalTok{, }\StringTok{"Lights"}\NormalTok{))}
\DocumentationTok{\#\#       id                         name        class index}
\DocumentationTok{\#\#   1:  37 Steel Frame Non{-}res Ext Wall Construction     1}
\DocumentationTok{\#\#   2:  37 Steel Frame Non{-}res Ext Wall Construction     2}
\DocumentationTok{\#\#   3:  37 Steel Frame Non{-}res Ext Wall Construction     3}
\DocumentationTok{\#\#   4:  37 Steel Frame Non{-}res Ext Wall Construction     4}
\DocumentationTok{\#\#   5:  39            IEAD Non{-}res Roof Construction     1}
\DocumentationTok{\#\#  {-}{-}{-}                                                    }
\DocumentationTok{\#\# 217: 251    Perimeter\_top\_ZN\_4\_Lights       Lights     9}
\DocumentationTok{\#\# 218: 251    Perimeter\_top\_ZN\_4\_Lights       Lights    10}
\DocumentationTok{\#\# 219: 251    Perimeter\_top\_ZN\_4\_Lights       Lights    11}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can also extract particular objects from different classes by supplying a character vector of object names to the argument \texttt{which}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{to\_table}\NormalTok{(}\AttributeTok{which =} \FunctionTok{c}\NormalTok{(}\StringTok{"Wood Siding"}\NormalTok{, }
                         \StringTok{"Steel Frame NonRes Wall Insulation"}\NormalTok{, }
                         \StringTok{"1/2IN Gypsum"}\NormalTok{))}
\DocumentationTok{\#\#     id                               name    class index               field}
\DocumentationTok{\#\#  1: 50                        Wood Siding Material     1                Name}
\DocumentationTok{\#\#  2: 50                        Wood Siding Material     2           Roughness}
\DocumentationTok{\#\#  3: 50                        Wood Siding Material     3           Thickness}
\DocumentationTok{\#\#  4: 50                        Wood Siding Material     4        Conductivity}
\DocumentationTok{\#\#  5: 50                        Wood Siding Material     5             Density}
\DocumentationTok{\#\#  6: 50                        Wood Siding Material     6       Specific Heat}
\DocumentationTok{\#\#  7: 50                        Wood Siding Material     7 Thermal Absorptance}
\DocumentationTok{\#\#  8: 50                        Wood Siding Material     8   Solar Absorptance}
\DocumentationTok{\#\#  9: 50                        Wood Siding Material     9 Visible Absorptance}
\NormalTok{....}

\NormalTok{model}\SpecialCharTok{$}\FunctionTok{to\_table}\NormalTok{(}\AttributeTok{which =} \FunctionTok{c}\NormalTok{(}\StringTok{"Perimeter\_bot\_ZN\_1\_Lights"}\NormalTok{))}
\DocumentationTok{\#\#      id                      name  class index}
\DocumentationTok{\#\#  1: 240 Perimeter\_bot\_ZN\_1\_Lights Lights     1}
\DocumentationTok{\#\#  2: 240 Perimeter\_bot\_ZN\_1\_Lights Lights     2}
\DocumentationTok{\#\#  3: 240 Perimeter\_bot\_ZN\_1\_Lights Lights     3}
\DocumentationTok{\#\#  4: 240 Perimeter\_bot\_ZN\_1\_Lights Lights     4}
\DocumentationTok{\#\#  5: 240 Perimeter\_bot\_ZN\_1\_Lights Lights     5}
\DocumentationTok{\#\#  6: 240 Perimeter\_bot\_ZN\_1\_Lights Lights     6}
\DocumentationTok{\#\#  7: 240 Perimeter\_bot\_ZN\_1\_Lights Lights     7}
\DocumentationTok{\#\#  8: 240 Perimeter\_bot\_ZN\_1\_Lights Lights     8}
\DocumentationTok{\#\#  9: 240 Perimeter\_bot\_ZN\_1\_Lights Lights     9}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

Once the EnergyPlus objects are in a \texttt{data.frame} format, you can take advantage of the \texttt{tidyverse} library to easily manipulate and modify their values. For example, you can use the \texttt{filter()} function to subset the data frame to retain rows of interest and the \texttt{dplyr::mutate()} function to modify values within columns.

In the example below, we first extract all objects in the \texttt{Lights} class from the EnergyPlus model. We then filter the data frame to contain only the field \texttt{"Watts\ per\ Zone\ Floor\ Area"}, which is used to specify the lighting power density in \(W/m^2\) in EnergyPlus. Lastly, we change the lighting power density of all the objects in the \texttt{Lights} class from \(10.76 W/m^2\) to \(15 W/m^2\).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lights\_df }\OtherTok{\textless{}{-}}\NormalTok{ model}\SpecialCharTok{$}\FunctionTok{to\_table}\NormalTok{(}\AttributeTok{class =} \FunctionTok{c}\NormalTok{(}\StringTok{"Lights"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{value =} \FunctionTok{if\_else}\NormalTok{(field }\SpecialCharTok{==} \StringTok{"Watts per Zone Floor Area"}\NormalTok{, }\CommentTok{\# condition}
                         \StringTok{"15"}\NormalTok{, }\CommentTok{\# value if TRUE}
\NormalTok{                         value) }\CommentTok{\# value if FALSE}
\NormalTok{         )}


\NormalTok{lights\_df}
\DocumentationTok{\#\#       id                      name  class index}
\DocumentationTok{\#\#   1: 237        Core\_bottom\_Lights Lights     1}
\DocumentationTok{\#\#   2: 237        Core\_bottom\_Lights Lights     2}
\DocumentationTok{\#\#   3: 237        Core\_bottom\_Lights Lights     3}
\DocumentationTok{\#\#   4: 237        Core\_bottom\_Lights Lights     4}
\DocumentationTok{\#\#   5: 237        Core\_bottom\_Lights Lights     5}
\DocumentationTok{\#\#  {-}{-}{-}                                           }
\DocumentationTok{\#\# 191: 251 Perimeter\_top\_ZN\_4\_Lights Lights     9}
\DocumentationTok{\#\# 192: 251 Perimeter\_top\_ZN\_4\_Lights Lights    10}
\DocumentationTok{\#\# 193: 251 Perimeter\_top\_ZN\_4\_Lights Lights    11}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

However, notice that you are not modifying the model just by changing the values of the data frame. This is not surprising since the extracted data frame is a copy of the model and not the model itself.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Lights}\StringTok{\textasciigrave{}}
\DocumentationTok{\#\# $Core\_bottom\_Lights}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Lights\textquotesingle{}\textgreater{} [ID:237] \textasciigrave{}Core\_bottom\_Lights\textasciigrave{}}
\DocumentationTok{\#\# {-}{-} COMMENTS {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# ! ***LIGHTS***}
\DocumentationTok{\#\# {-}{-} VALUES {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# Class: \textless{}Lights\textgreater{}}
\DocumentationTok{\#\# ├─ 01*: "Core\_bottom\_Lights",  !{-} Name}
\DocumentationTok{\#\# │─ 02*: "Core\_bottom",      !{-} Zone or ZoneList Name}
\DocumentationTok{\#\# │─ 03*: "BLDG\_LIGHT\_SCH",   !{-} Schedule Name}
\DocumentationTok{\#\# │─ 04 : "Watts/Area",       !{-} Design Level Calculation Method}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

To modify the model, you need to use the \texttt{\$update()} method in the \texttt{Idf} class, which can take the modified data frame as an argument.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{update}\NormalTok{(lights\_df)}
\DocumentationTok{\#\# $Core\_bottom\_Lights}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Lights\textquotesingle{}\textgreater{} [ID:237] \textasciigrave{}Core\_bottom\_Lights\textasciigrave{}}
\DocumentationTok{\#\# {-}{-} COMMENTS {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# ! ***LIGHTS***}
\DocumentationTok{\#\# {-}{-} VALUES {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# Class: \textless{}Lights\textgreater{}}
\DocumentationTok{\#\# ├─ 01*: "Core\_bottom\_Lights",  !{-} Name}
\DocumentationTok{\#\# │─ 02*: "Core\_bottom",      !{-} Zone or ZoneList Name}
\DocumentationTok{\#\# │─ 03*: "BLDG\_LIGHT\_SCH",   !{-} Schedule Name}
\DocumentationTok{\#\# │─ 04 : "Watts/Area",       !{-} Design Level Calculation Method}
\NormalTok{....}
\NormalTok{model}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Lights}\StringTok{\textasciigrave{}}
\DocumentationTok{\#\# $Core\_bottom\_Lights}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Lights\textquotesingle{}\textgreater{} [ID:237] \textasciigrave{}Core\_bottom\_Lights\textasciigrave{}}
\DocumentationTok{\#\# {-}{-} COMMENTS {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# ! ***LIGHTS***}
\DocumentationTok{\#\# {-}{-} VALUES {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\# Class: \textless{}Lights\textgreater{}}
\DocumentationTok{\#\# ├─ 01*: "Core\_bottom\_Lights",  !{-} Name}
\DocumentationTok{\#\# │─ 02*: "Core\_bottom",      !{-} Zone or ZoneList Name}
\DocumentationTok{\#\# │─ 03*: "BLDG\_LIGHT\_SCH",   !{-} Schedule Name}
\DocumentationTok{\#\# │─ 04 : "Watts/Area",       !{-} Design Level Calculation Method}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Subset by Objects
\end{itemize}

You can also extract data from the EnergyPlus model based on the object names by supplying the object names to the argument \texttt{which} of the \texttt{\$to\_table()} method. In the example that follows, we will show you how to do this by changing the thermal properties of the external wall construction.

First, you can find out which \texttt{Construction} objects make up the external wall by scanning objects from the \texttt{BuildingSurface:Detailed} class, which describes all the surfaces of the model. In general, the external wall surfaces would be those that are of \texttt{Surface\ Type\ ==\ Wall} and \texttt{Outside\ Boundary\ Conditions\ ==\ Outdoors} (i.e., the surface is exposed to outside temperature conditions). In this model, the external wall is made up of the \texttt{Steel\ Frame\ Non-res\ Ext\ Wall} object of the \texttt{Construction} class.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ext\_wall\_surf }\OtherTok{\textless{}{-}}\NormalTok{ model}\SpecialCharTok{$}\FunctionTok{to\_table}\NormalTok{(}\AttributeTok{class =} \FunctionTok{c}\NormalTok{(}\StringTok{"BuildingSurface:Detailed"}\NormalTok{), }\AttributeTok{wide =}\ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{Surface Type}\StringTok{\textasciigrave{}} \SpecialCharTok{==} \StringTok{"Wall"}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{Outside Boundary Condition}\StringTok{\textasciigrave{}} \SpecialCharTok{==} \StringTok{"Outdoors"}\NormalTok{)}

\FunctionTok{unique}\NormalTok{(ext\_wall\_surf}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Construction Name}\StringTok{\textasciigrave{}}\NormalTok{)}
\DocumentationTok{\#\# [1] "Steel Frame Non{-}res Ext Wall"}
\end{Highlighting}
\end{Shaded}

The object \texttt{Steel\ Frame\ Non-res\ Ext\ Wall} comprises of three materials (\texttt{Wood\ Siding}, \texttt{Steel\ Frame\ NonRes\ Wall\ Insulation}, and \texttt{1/2IN\ Gypsum}) that are modeled using the class \texttt{Material}. To modify the thermal properties of the external wall, you would need to modify the inputs of either of these three materials.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{object\_relation}\NormalTok{(}\StringTok{"Steel Frame Non{-}res Ext Wall"}\NormalTok{)}
\DocumentationTok{\#\# {-}{-} Refer to Others {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\#  Class: \textless{}Construction\textgreater{}}
\DocumentationTok{\#\#  └─ Object [ID:37] \textless{}Steel Frame Non{-}res Ext Wall\textgreater{}}
\DocumentationTok{\#\#     ├─ 2: "Wood Siding", !{-} Outside Layer}
\DocumentationTok{\#\#     │  v\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#     │  └─ Class: \textless{}Material\textgreater{}}
\DocumentationTok{\#\#     │     └─ Object [ID:50] \textless{}Wood Siding\textgreater{}}
\DocumentationTok{\#\#     │        └─ 1: "Wood Siding"; !{-} Name}
\DocumentationTok{\#\#     │  }
\DocumentationTok{\#\#     ├─ 3: "Steel Frame NonRes Wall Insulation",  !{-} Layer 2}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

We first extract these three materials from the model.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ext\_wall\_mat }\OtherTok{\textless{}{-}}\NormalTok{ model}\SpecialCharTok{$}\FunctionTok{to\_table}\NormalTok{(}\AttributeTok{which =} \FunctionTok{c}\NormalTok{(}\StringTok{"Wood Siding"}\NormalTok{,}
                                         \StringTok{"Steel Frame NonRes Wall Insulation"}\NormalTok{,}
                                         \StringTok{"1/2IN Gypsum"}\NormalTok{))}
\NormalTok{ext\_wall\_mat}
\DocumentationTok{\#\#     id                               name    class index               field}
\DocumentationTok{\#\#  1: 50                        Wood Siding Material     1                Name}
\DocumentationTok{\#\#  2: 50                        Wood Siding Material     2           Roughness}
\DocumentationTok{\#\#  3: 50                        Wood Siding Material     3           Thickness}
\DocumentationTok{\#\#  4: 50                        Wood Siding Material     4        Conductivity}
\DocumentationTok{\#\#  5: 50                        Wood Siding Material     5             Density}
\DocumentationTok{\#\#  6: 50                        Wood Siding Material     6       Specific Heat}
\DocumentationTok{\#\#  7: 50                        Wood Siding Material     7 Thermal Absorptance}
\DocumentationTok{\#\#  8: 50                        Wood Siding Material     8   Solar Absorptance}
\DocumentationTok{\#\#  9: 50                        Wood Siding Material     9 Visible Absorptance}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

You can then modify the extracted information in the \texttt{data.frame}. Here, we increase the \texttt{Conductivity} of the \texttt{1/2IN\ Gypsum} from \texttt{0.16} to \texttt{0.20}, and double the \texttt{Thickness} of the wall insultion (\texttt{Steel\ Frame\ NonRes\ Wall\ Insulation}).

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{ext\_wall\_mat[name }\SpecialCharTok{==} \StringTok{"1/2IN Gypsum"} \SpecialCharTok{\&}\NormalTok{ field }\SpecialCharTok{==} \StringTok{"Conductivity"}\NormalTok{]}\SpecialCharTok{$}\NormalTok{value }\OtherTok{\textless{}{-}} \StringTok{"0.20"}

\NormalTok{ext\_wall\_mat[name }\SpecialCharTok{==} \StringTok{"Steel Frame NonRes Wall Insulation"} \SpecialCharTok{\&} 
\NormalTok{               field }\SpecialCharTok{==} \StringTok{"Thickness"}\NormalTok{]}\SpecialCharTok{$}\NormalTok{value }\OtherTok{\textless{}{-}} \StringTok{"0.174"}
\end{Highlighting}
\end{Shaded}

Subsequently, you can update the model using the modified \texttt{data.frame} with the \texttt{\$update()} method in the \texttt{Idf} class.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model}\SpecialCharTok{$}\FunctionTok{update}\NormalTok{(ext\_wall\_mat)}
\DocumentationTok{\#\# $\textasciigrave{}Wood Siding\textasciigrave{}}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Material\textquotesingle{}\textgreater{} [ID:50] \textasciigrave{}Wood Siding\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Material\textgreater{}}
\DocumentationTok{\#\# ├─ 1*: "Wood Siding",  !{-} Name}
\DocumentationTok{\#\# │─ 2*: "MediumSmooth", !{-} Roughness}
\DocumentationTok{\#\# │─ 3*: 0.01,           !{-} Thickness \{m\}}
\DocumentationTok{\#\# │─ 4*: 0.11,           !{-} Conductivity \{W/m{-}K\}}
\DocumentationTok{\#\# │─ 5*: 544.62,         !{-} Density \{kg/m3\}}
\DocumentationTok{\#\# │─ 6*: 1210,           !{-} Specific Heat \{J/kg{-}K\}}
\DocumentationTok{\#\# │─ 7 : 0.9,            !{-} Thermal Absorptance}
\NormalTok{....}

\NormalTok{model}\SpecialCharTok{$}\NormalTok{Material}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{1/2IN Gypsum}\StringTok{\textasciigrave{}}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Material\textquotesingle{}\textgreater{} [ID:51] \textasciigrave{}1/2IN Gypsum\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Material\textgreater{}}
\DocumentationTok{\#\# ├─ 1*: "1/2IN Gypsum", !{-} Name}
\DocumentationTok{\#\# │─ 2*: "Smooth",       !{-} Roughness}
\DocumentationTok{\#\# │─ 3*: 0.0127,         !{-} Thickness \{m\}}
\DocumentationTok{\#\# │─ 4*: 0.2,            !{-} Conductivity \{W/m{-}K\}}
\DocumentationTok{\#\# │─ 5*: 784.9,          !{-} Density \{kg/m3\}}
\DocumentationTok{\#\# │─ 6*: 830,            !{-} Specific Heat \{J/kg{-}K\}}
\DocumentationTok{\#\# │─ 7 : 0.9,            !{-} Thermal Absorptance}
\DocumentationTok{\#\# │─ 8 : 0.92,           !{-} Solar Absorptance}
\NormalTok{....}

\NormalTok{model}\SpecialCharTok{$}\NormalTok{Material}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Steel Frame NonRes Wall Insulation}\StringTok{\textasciigrave{}}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Material\textquotesingle{}\textgreater{} [ID:38] \textasciigrave{}Steel Frame NonRes Wall Insulation\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Material\textgreater{}}
\DocumentationTok{\#\# ├─ 1*: "Steel Frame NonRes Wall Insulation",  !{-} Name}
\DocumentationTok{\#\# │─ 2*: "MediumRough",      !{-} Roughness}
\DocumentationTok{\#\# │─ 3*: 0.174,              !{-} Thickness \{m\}}
\DocumentationTok{\#\# │─ 4*: 0.049,              !{-} Conductivity \{W/m{-}K\}}
\DocumentationTok{\#\# │─ 5*: 265,                !{-} Density \{kg/m3\}}
\DocumentationTok{\#\# │─ 6*: 836.8,              !{-} Specific Heat \{J/kg{-}K\}}
\DocumentationTok{\#\# │─ 7 : 0.9,                !{-} Thermal Absorptance}
\DocumentationTok{\#\# │─ 8 : 0.7,                !{-} Solar Absorptance}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

\hypertarget{create-new-objects}{%
\section{Create new objects}\label{create-new-objects}}

\hypertarget{add}{%
\subsection{add}\label{add}}

You can add new objects to the model using the \texttt{\$add()} method in the \texttt{Idf} class. The \texttt{\$add()} method takes as it's first argument is a nested named list of the form. Note that \texttt{\textless{}CLASS\ NAME\textgreater{}} is case-sensitive while \texttt{\textless{}FIELD\ NAME\textgreater{}} is not.

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{\textasciigrave{}}\AttributeTok{list(\textless{}CLASS NAME\textgreater{} = list(\textless{}FIELD NAME\textgreater{} = \textless{}FIELD VALUE\textgreater{}))}\StringTok{\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

Suppose you want to add a new material to your model, which you can define using EnergyPlus's \texttt{Material} class. Figure \ref{fig:idd-material} can be translated to tell us that the \texttt{Material} class consists of the following fields

\begin{itemize}
\tightlist
\item
  \texttt{Name} is a required field of type \texttt{alpha} (i.e., a string)
\item
  \texttt{Roughness} is a required field of type \texttt{choice} and the possible choices are \texttt{VeryRough}, \texttt{Rough}, \texttt{MediumRou.gh}, \texttt{MediumSmooth}, \texttt{Smooth}, and \texttt{VerySmooth}.
\item
  \texttt{Thickness} is a required field with unit of measurement meters. It is a \texttt{real} number and must be \(>=0\)
\item
  \texttt{Conductivity} is a required field with unit of measurement \(W/m.K\). It is a \texttt{real} number and must be \(>=0\)
\item
  \texttt{Density} is a required field with unit of measurement \(kg/m^3\). It is a \texttt{real} number and must be \(>=0\)
\item
  \texttt{Specific\ Heat} is a required field with unit of measurement \(J/kg.K\). It is a \texttt{real} number and must be \(>=100\)
\item
  \texttt{Thermal\ Absorptance} is \emph{not} a required field. It is a \texttt{real} number, has a default value of 0.9 if not specified, and must be between 0 and 0.99999.
\item
  \texttt{Solar\ Absorptance} is \emph{not} a required field. It is a \texttt{real} number, has a default value of 0.7 if not specified, and must be between 0 and 0.99999.
\item
  \texttt{Visible\ Absorptance} is \emph{not} a required field. It is a \texttt{real} number, has a default value of 0.7 if not specified, and must be between 0 and 0.99999.
\end{itemize}

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{figures/idd_material} 

}

\caption{Definition of EnergyPlus Material class based on the IDD.}\label{fig:idd-material}
\end{figure}

Based on the definitions provided in the IDD, you can define and add a new 100mm brick object. By default, all empty fields will be filled with default values specified in the IDD. As mentioned earlier, note that the class name (\texttt{Material} in this example) is case-sensitive, while the field names (\texttt{Name}, \texttt{Roughness}, \texttt{Thickness}, etc.) are case-insensitive.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_mat }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{Material =} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{Name =} \StringTok{"100mm brick"}\NormalTok{,}
    \AttributeTok{ROUGHness =} \StringTok{"Rough"}\NormalTok{,}
    \AttributeTok{thickness =} \FloatTok{0.10}\NormalTok{,}
    \AttributeTok{conducTIVITY =} \FloatTok{0.89}\NormalTok{,}
    \AttributeTok{density =} \DecValTok{1920}\NormalTok{,}
    \StringTok{\textasciigrave{}}\AttributeTok{Specific Heat}\StringTok{\textasciigrave{}} \OtherTok{=} \DecValTok{790}
\NormalTok{  ),}
  \AttributeTok{Material =} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{name =} \StringTok{"spandrel glass"}\NormalTok{,}
    \AttributeTok{roughness =} \StringTok{"smooth"}\NormalTok{,}
    \AttributeTok{thickness =} \FloatTok{0.006}\NormalTok{,}
    \AttributeTok{conductivity =} \FloatTok{0.99}\NormalTok{,}
    \AttributeTok{density =} \DecValTok{2528}\NormalTok{,}
    \StringTok{\textasciigrave{}}\AttributeTok{Specific Heat}\StringTok{\textasciigrave{}} \OtherTok{=} \DecValTok{880}
\NormalTok{  ))}

\NormalTok{model}\SpecialCharTok{$}\FunctionTok{add}\NormalTok{(new\_mat)}
\DocumentationTok{\#\# $\textasciigrave{}100mm brick\textasciigrave{}}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Material\textquotesingle{}\textgreater{} [ID:682] \textasciigrave{}100mm brick\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Material\textgreater{}}
\DocumentationTok{\#\# ├─ 1*: "100mm brick", !{-} Name}
\DocumentationTok{\#\# │─ 2*: "Rough",       !{-} Roughness}
\DocumentationTok{\#\# │─ 3*: 0.1,           !{-} Thickness \{m\}}
\DocumentationTok{\#\# │─ 4*: 0.89,          !{-} Conductivity \{W/m{-}K\}}
\DocumentationTok{\#\# │─ 5*: 1920,          !{-} Density \{kg/m3\}}
\DocumentationTok{\#\# └─ 6*: 790;           !{-} Specific Heat \{J/kg{-}K\}}
\DocumentationTok{\#\# }
\NormalTok{....}

\NormalTok{model}\SpecialCharTok{$}\FunctionTok{objects}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"100mm brick"}\NormalTok{, }\StringTok{"spandrel glass"}\NormalTok{))}
\DocumentationTok{\#\# $\textasciigrave{}100mm brick\textasciigrave{}}
\DocumentationTok{\#\# \textless{}IdfObject: \textquotesingle{}Material\textquotesingle{}\textgreater{} [ID:682] \textasciigrave{}100mm brick\textasciigrave{}}
\DocumentationTok{\#\# Class: \textless{}Material\textgreater{}}
\DocumentationTok{\#\# ├─ 1*: "100mm brick", !{-} Name}
\DocumentationTok{\#\# │─ 2*: "Rough",       !{-} Roughness}
\DocumentationTok{\#\# │─ 3*: 0.1,           !{-} Thickness \{m\}}
\DocumentationTok{\#\# │─ 4*: 0.89,          !{-} Conductivity \{W/m{-}K\}}
\DocumentationTok{\#\# │─ 5*: 1920,          !{-} Density \{kg/m3\}}
\DocumentationTok{\#\# └─ 6*: 790;           !{-} Specific Heat \{J/kg{-}K\}}
\DocumentationTok{\#\# }
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

By default, all empty fields will be filled with default values specified in the IDD and the object would be defined using only the minimum number of fields. You change change this by setting with \texttt{.default\ =\ FALSE} (no default values used) and \texttt{.all\ =\ TRUE} (all fields are added).

\hypertarget{duplicate}{%
\subsection{duplicate}\label{duplicate}}

\hypertarget{output}{%
\chapter{Detailed output}\label{output}}

\hypertarget{prerequisites-12}{%
\section{Prerequisites}\label{prerequisites-12}}

In this chapter we will focus on how to set and get EnergyPlus simulation outputs using the eplusr package. We will illustrate the manipulation of simulation data using tidyverse, and use ggplot2 to visualize the simulation data

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(eplusr)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

We will be working with the IDF and EPW file that pertains to the U.S. Department of Energy (DOE) Commercial Reference Building and Chicago's TMY3 respectively.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_idf }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"idf"}\NormalTok{, }\StringTok{"RefBldgMediumOfficeNew2004\_Chicago.idf"}\NormalTok{)}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{read\_idf}\NormalTok{(path\_idf)}

\NormalTok{path\_epw }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"epw"}\NormalTok{, }\StringTok{"USA\_IL\_Chicago{-}OHare.Intl.AP.725300\_TMY3.epw"}\NormalTok{)}
\NormalTok{epw }\OtherTok{\textless{}{-}} \FunctionTok{read\_epw}\NormalTok{(path\_epw)}
\end{Highlighting}
\end{Shaded}

\hypertarget{meters}{%
\section{Meters}\label{meters}}

EnergyPlus allows you to specify meters to retrieve the simulation outputs. However, to know what meters are available (for output) in your model, you must first run the simulation. You can then retrieve the list of available meters with the function \texttt{read\_mdd()}, which returns a five column \texttt{data.table}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mdd }\OtherTok{\textless{}{-}}\NormalTok{ job}\SpecialCharTok{$}\FunctionTok{read\_mdd}\NormalTok{()}
\NormalTok{mdd}
\DocumentationTok{\#\# == EnergyPlus Meter Data Dictionary File =======================================}
\DocumentationTok{\#\#   * EnergyPlus version: 9.4.0 (998c4b761e)}
\DocumentationTok{\#\#   * Simulation started: 2021{-}08{-}21 15:20:00}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# {-}{-} Details {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\DocumentationTok{\#\#      index reported\_time\_step report\_type}
\DocumentationTok{\#\#   1:     1               Zone       Meter}
\DocumentationTok{\#\#   2:     2               Zone       Meter}
\DocumentationTok{\#\#   3:     3               Zone       Meter}
\DocumentationTok{\#\#   4:     4               Zone       Meter}
\NormalTok{....}
\end{Highlighting}
\end{Shaded}

After

\hypertarget{variables}{%
\section{Variables}\label{variables}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{preprocess\_idf }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(idf, meters, variables) \{}
    \CommentTok{\# make sure weather file input is respected}
\NormalTok{    idf}\SpecialCharTok{$}\NormalTok{SimulationControl}\SpecialCharTok{$}\NormalTok{Run\_Simulation\_for\_Weather\_File\_Run\_Periods }\OtherTok{\textless{}{-}} \StringTok{"Yes"}

    \CommentTok{\# make sure energy consumption is presented in kWh}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(idf}\SpecialCharTok{$}\NormalTok{OutputControl\_Table\_Style)) \{}
\NormalTok{        idf}\SpecialCharTok{$}\FunctionTok{add}\NormalTok{(}\AttributeTok{OutputControl\_Table\_Style =} \FunctionTok{list}\NormalTok{(}\StringTok{"HTML"}\NormalTok{, }\StringTok{"JtoKWH"}\NormalTok{))}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        idf}\SpecialCharTok{$}\NormalTok{OutputControl\_Table\_Style}\SpecialCharTok{$}\NormalTok{Unit\_Conversion }\OtherTok{\textless{}{-}} \StringTok{"JtoKWH"}
\NormalTok{    \}}

    \CommentTok{\# remove all existing meter and variable outputs}
    \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(idf}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Output:Meter}\StringTok{\textasciigrave{}}\NormalTok{))\{}
\NormalTok{        idf}\SpecialCharTok{$}\NormalTok{Output\_Meter }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{    \}}
    
    \CommentTok{\# remove all existing meter and variable outputs}
    \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(idf}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Output:Table:Monthly}\StringTok{\textasciigrave{}}\NormalTok{))\{}
\NormalTok{        idf}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Output:Table:Monthly}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{    \}}

    \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(idf}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Output:Variable}\StringTok{\textasciigrave{}}\NormalTok{))\{}
\NormalTok{        idf}\SpecialCharTok{$}\NormalTok{Output\_Variable }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{    \}}

    \CommentTok{\# add meter outputs to get hourly time{-}series energy consumption}
\NormalTok{    idf}\SpecialCharTok{$}\FunctionTok{add}\NormalTok{(}\AttributeTok{Output\_Meter :=}\NormalTok{ meters)}

    \CommentTok{\# add variable outputs to get hourly zone air temperature}
\NormalTok{    idf}\SpecialCharTok{$}\FunctionTok{add}\NormalTok{(}\AttributeTok{Output\_Variable :=}\NormalTok{ variables)}

    \CommentTok{\# make sure the modified model is returned}
    \FunctionTok{return}\NormalTok{(idf)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{meters }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{key\_name =} \FunctionTok{c}\NormalTok{(}
        \StringTok{"Cooling:Electricity"}\NormalTok{,}
        \StringTok{"Heating:NaturalGas"}\NormalTok{,}
        \StringTok{"Heating:Electricity"}\NormalTok{,}
        \StringTok{"InteriorLights:Electricity"}\NormalTok{,}
        \StringTok{"ExteriorLights:Electricity"}\NormalTok{,}
        \StringTok{"InteriorEquipment:Electricity"}\NormalTok{,}
        \StringTok{"Fans:Electricity"}\NormalTok{,}
        \StringTok{"Pumps:Electricity"}\NormalTok{,}
        \StringTok{"WaterSystems:NaturalGas"}
\NormalTok{    ),}
    \AttributeTok{Reporting\_Frequency =} \StringTok{"Hourly"}
\NormalTok{)}

\NormalTok{variables }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{key\_value =} \StringTok{"*"}\NormalTok{,}
    \AttributeTok{Variable\_Name =} \FunctionTok{c}\NormalTok{(}
        \StringTok{"Zone Mean Air Temperature"}
\NormalTok{    ),}
    \AttributeTok{Reporting\_Frequency =} \StringTok{"Hourly"}
\NormalTok{)}

\CommentTok{\#model \textless{}{-} preprocess\_idf(model, meters, variables)}

\CommentTok{\#model$save(here("data/idf/model\_preprocessed.idf"), overwrite = TRUE)}
\CommentTok{\#job \textless{}{-} model$run(path\_epw)}
\end{Highlighting}
\end{Shaded}

\hypertarget{explore}{%
\chapter{Model Exploration}\label{explore}}

\hypertarget{prerequisites-13}{%
\section{Prerequisites}\label{prerequisites-13}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(eplusr)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

We will be working with the IDF and EPW file that pertains to the U.S. Department of Energy (DOE) Commercial Reference Building and Chicago's TMY3 respectively.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path\_idf }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"idf"}\NormalTok{, }\StringTok{"RefBldgMediumOfficeNew2004\_Chicago.idf"}\NormalTok{)}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{read\_idf}\NormalTok{(path\_idf)}

\NormalTok{path\_epw }\OtherTok{\textless{}{-}} \FunctionTok{here}\NormalTok{(}\StringTok{"data"}\NormalTok{, }\StringTok{"epw"}\NormalTok{, }\StringTok{"USA\_IL\_Chicago{-}OHare.Intl.AP.725300\_TMY3.epw"}\NormalTok{)}
\NormalTok{epw }\OtherTok{\textless{}{-}} \FunctionTok{read\_epw}\NormalTok{(path\_epw)}
\end{Highlighting}
\end{Shaded}

\hypertarget{part-program}{%
\part{Program}\label{part-program}}

\hypertarget{program}{%
\chapter{Introduction}\label{program}}

\hypertarget{energy-efficient-measures}{%
\chapter{Energy Efficient Measures}\label{energy-efficient-measures}}

\hypertarget{parametric-simulations}{%
\chapter{Parametric simulations}\label{parametric-simulations}}

\hypertarget{part-advanced}{%
\part{Advanced}\label{part-advanced}}

\hypertarget{advanced}{%
\chapter{Introduction}\label{advanced}}

\hypertarget{sensitivity-analysis}{%
\chapter{Sensitivity analysis}\label{sensitivity-analysis}}

William of Occam to seek an economical description of natural phenomena and avoid excessive models that are overparameterized. Principal of Parisimony.

\hypertarget{optimization}{%
\chapter{Optimization}\label{optimization}}

\hypertarget{calibration}{%
\chapter{Calibration}\label{calibration}}

Taking reference to the quotation of statistician George Box that ``All models are wrong, but some are useful''

\hypertarget{part-reproduce}{%
\part{Reproduce}\label{part-reproduce}}

\hypertarget{reproduce}{%
\chapter{Introduction}\label{reproduce}}

\hypertarget{r-markdown}{%
\chapter{R Markdown}\label{r-markdown}}

\hypertarget{containers}{%
\chapter{Containers}\label{containers}}

  \bibliography{book.bib,packages.bib}

\end{document}
